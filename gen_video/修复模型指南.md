# 修复模型指南

## 使用 proxychains4 代理下载

### 1. 修复 Kolors-base（缺失 1 个文件）

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
source /vepfs-dev/shawn/venv/py312/bin/activate

# 使用 proxychains4
proxychains4 python 修复模型下载脚本.py --model kolors

# 或使用镜像
python 修复模型下载脚本.py --model kolors --use-mirror
```

### 2. 修复 SD3.5 Large Turbo（重新下载标准格式）

```bash
# 使用 proxychains4
proxychains4 python 修复模型下载脚本.py --model sd3-turbo

# 或使用镜像
python 修复模型下载脚本.py --model sd3-turbo --use-mirror
```

### 3. 修复 Hunyuan-DiT（重新下载标准格式）

```bash
# 使用 proxychains4
proxychains4 python 修复模型下载脚本.py --model hunyuan-dit

# 或使用镜像
python 修复模型下载脚本.py --model hunyuan-dit --use-mirror
```

### 4. 修复所有模型

```bash
# 使用 proxychains4
proxychains4 python 修复模型下载脚本.py --model all

# 或使用镜像
python 修复模型下载脚本.py --model all --use-mirror
```

---

## 直接使用 Python 脚本（带 proxychains4）

### 修复 Kolors-base

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
source /vepfs-dev/shawn/venv/py312/bin/activate

proxychains4 python << 'EOF'
from huggingface_hub import hf_hub_download
from pathlib import Path

repo_id = "Kwai-Kolors/Kolors-base"
filename = "text_encoder/pytorch_model-00002-of-00007.bin"
local_dir = Path("/vepfs-dev/shawn/vid/fanren/gen_video/models/kolors-base")

downloaded_path = hf_hub_download(
    repo_id=repo_id,
    filename=filename,
    local_dir=str(local_dir),
    local_dir_use_symlinks=False,
    resume_download=True
)

print(f"✅ 下载成功: {downloaded_path}")
EOF
```

---

## 使用镜像（无需代理）

如果 proxychains4 有问题，可以使用 HuggingFace 镜像：

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
source /vepfs-dev/shawn/venv/py312/bin/activate

# 设置镜像环境变量
export HF_ENDPOINT=https://hf-mirror.com

# 运行修复脚本
python 修复模型下载脚本.py --model kolors --use-mirror
```

---

## 验证修复结果

修复后，运行验证脚本：

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
source /vepfs-dev/shawn/venv/py312/bin/activate
python test_model_loading.py
```

---

## 问题排查

### 如果 proxychains4 连接失败

1. 检查 proxychains4 配置：
   ```bash
   cat /etc/proxychains4.conf | grep -A 5 "strict_chain"
   ```

2. 测试代理连接：
   ```bash
   proxychains4 curl -I https://huggingface.co
   ```

3. 使用镜像替代：
   ```bash
   export HF_ENDPOINT=https://hf-mirror.com
   python 修复模型下载脚本.py --model kolors --use-mirror
   ```

### 如果下载中断

脚本支持断点续传，直接重新运行即可：
```bash
proxychains4 python 修复模型下载脚本.py --model kolors
```

