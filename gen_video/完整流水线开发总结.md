# å®Œæ•´æµæ°´çº¿å¼€å‘æ€»ç»“

## å·²å®Œæˆçš„åŠŸèƒ½

### 1. âœ… é£æ ¼é…ç½®ç³»ç»Ÿ

**åŠŸèƒ½**ï¼š
- æ”¯æŒåœ¨é…ç½®æ–‡ä»¶ã€è„šæœ¬JSONå’Œå‰ç«¯APIä¸­é…ç½®é£æ ¼
- 5ç§é¢„å®šä¹‰é£æ ¼ï¼šscientific, commercial, dramatic, realistic, xianxia
- é£æ ¼éªŒè¯å·¥å…·ï¼š`gen_video/utils/style_validator.py`
- APIæ¥å£ï¼š`GET /api/v1/styles` è·å–å¯ç”¨é£æ ¼åˆ—è¡¨

**é…ç½®ä½ç½®**ï¼š
- `config.yaml`: `hunyuanvideo.style_templates`
- è„šæœ¬JSON: `scene.visual.style` æˆ– `scene.style`
- API: `VideoScene.style` æˆ– `VideoScene.visual.style`

### 2. âœ… HunyuanVideoé›†æˆ

**åŠŸèƒ½**ï¼š
- æ”¯æŒHunyuanVideo 1.5ç‰ˆæœ¬ï¼ˆ480på’Œ720pï¼‰
- æ˜¾å­˜ä¼˜åŒ–ï¼šCPU offload, attention slicing, gradient checkpointing, VAE tiling
- æ˜¾å­˜é™åˆ¶ï¼š`max_memory_fraction` é˜²æ­¢ä¸€æ¬¡æ€§åˆ†é…å®Œæ˜¾å­˜
- è¯¦ç»†çš„promptæ„å»ºï¼šæ ¹æ®åœºæ™¯ä¿¡æ¯è‡ªåŠ¨æ„å»ºè¯¦ç»†prompt

**é…ç½®**ï¼š
- æ¨¡å‹è·¯å¾„ï¼š`hunyuanvideo.model_path`
- æ˜¾å­˜é™åˆ¶ï¼š`hunyuanvideo.max_memory_fraction` (é»˜è®¤0.4)
- Attentionåˆ‡ç‰‡ï¼š`hunyuanvideo.attention_slice_size` (é»˜è®¤1)

### 3. âœ… Promptæ„å»ºç³»ç»Ÿ

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨ä»åœºæ™¯ä¿¡æ¯æ„å»ºè¯¦ç»†prompt
- æ”¯æŒé£æ ¼æ¨¡æ¿åº”ç”¨
- æ”¯æŒè¿åŠ¨æè¿°ï¼ˆmotion_intensity, camera_motionï¼‰
- å‚è€ƒHunyuanVideoå®˜æ–¹ç¤ºä¾‹æ ¼å¼

**æ–¹æ³•**ï¼š
- `_build_detailed_prompt()`: æ„å»ºè¯¦ç»†prompt
- ä»sceneä¸­æå–ï¼šstyle, description, visual.composition
- è‡ªåŠ¨æ·»åŠ è¿åŠ¨æè¿°å’Œç»†èŠ‚æè¿°

### 4. âœ… APIæ¥å£å®Œå–„

**åŠŸèƒ½**ï¼š
- `VideoScene` æ¨¡å‹æ”¯æŒ `style` å’Œ `visual` å­—æ®µ
- é£æ ¼ä¿¡æ¯æ­£ç¡®ä¼ é€’åˆ°è§†é¢‘ç”Ÿæˆå™¨
- é£æ ¼éªŒè¯å’Œé”™è¯¯å¤„ç†

**æ¥å£**ï¼š
- `POST /api/v1/videos/generate`: è§†é¢‘ç”Ÿæˆï¼ˆæ”¯æŒé£æ ¼å‚æ•°ï¼‰
- `GET /api/v1/styles`: è·å–å¯ç”¨é£æ ¼åˆ—è¡¨

### 5. âœ… å®Œæ•´æµæ°´çº¿æµ‹è¯•

**æµ‹è¯•è„šæœ¬**ï¼š
- `test_complete_pipeline.py`: åŸºç¡€æµ‹è¯•
- `test_complete_pipeline_commercial.py`: å•†ä¸šåŒ–åœºæ™¯æµ‹è¯•ï¼ˆæ”¯æŒ3ç§åœºæ™¯ç±»å‹ï¼‰

**æµ‹è¯•åœºæ™¯**ï¼š
- scientific: ç§‘æ™®è§†é¢‘
- product: äº§å“å¹¿å‘Š
- story: çŸ­å‰§æ¨æ–‡

## æŠ€æœ¯æ¶æ„

### æ¨¡å‹çŸ©é˜µï¼ˆæ ¹æ®å•†ä¸šåŒ–æ–¹æ¡ˆï¼‰

1. **å›¾åƒç”Ÿæˆ**ï¼šFlux + InstantID/PuLID
2. **è§†é¢‘ç”Ÿæˆï¼ˆé«˜ç«¯ï¼‰**ï¼šHunyuanVideoï¼ˆç§‘æ™®ã€æ”¿åºœã€ä¼ä¸šï¼‰
3. **è§†é¢‘ç”Ÿæˆï¼ˆé‡äº§ï¼‰**ï¼šCogVideoX-5Bï¼ˆçŸ­å‰§ã€æ¨æ–‡ã€ç”µå•†ï¼‰- å¾…é›†æˆ
4. **ç‰¹æ•ˆè§†é¢‘**ï¼šMochi 1ï¼ˆäº§å“å¹¿å‘Šï¼‰- å¾…é›†æˆ

### é£æ ¼ç³»ç»Ÿæ¶æ„

```
é…ç½®æ–‡ä»¶ (config.yaml)
    â†“
é£æ ¼æ¨¡æ¿ (style_templates)
    â†“
åœºæ™¯æ•°æ® (scene.visual.style æˆ– scene.style)
    â†“
é£æ ¼éªŒè¯ (StyleValidator)
    â†“
Promptæ„å»º (_build_detailed_prompt)
    â†“
è§†é¢‘ç”Ÿæˆ (HunyuanVideo Pipeline)
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. ç§‘æ™®è§†é¢‘ï¼ˆæ”¿åºœ/æ•™è‚²èµ›é“ï¼‰

```json
{
  "scenes": [
    {
      "id": 1,
      "narration": "é»‘æ´æ˜¯å®‡å®™ä¸­æœ€ç¥ç§˜çš„å¤©ä½“",
      "description": "a black hole in space",
      "visual": {
        "style": "scientific",
        "composition": "wide shot"
      }
    }
  ]
}
```

### 2. äº§å“å¹¿å‘Šï¼ˆç”µå•†èµ›é“ï¼‰

```json
{
  "scenes": [
    {
      "id": 1,
      "narration": "è¿™æ¬¾æ™ºèƒ½æ°´æ¯é‡‡ç”¨æœ€æ–°ç§‘æŠ€",
      "style": "commercial",
      "visual": {
        "composition": "product shot"
      }
    }
  ]
}
```

### 3. APIè°ƒç”¨

```python
# è·å–å¯ç”¨é£æ ¼
GET /api/v1/styles

# ç”Ÿæˆè§†é¢‘ï¼ˆå¸¦é£æ ¼ï¼‰
POST /api/v1/videos/generate
{
  "scenes": [
    {
      "prompt": "a beautiful landscape",
      "duration": 5.0,
      "style": "scientific"
    }
  ]
}
```

## ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

1. **é›†æˆCogVideoX-5B**
   - æ·»åŠ CogVideoXæ¨¡å‹æ”¯æŒ
   - é…ç½®è‡ªåŠ¨é€‰æ‹©é€»è¾‘ï¼ˆé«˜ç«¯ç”¨HunyuanVideoï¼Œé‡äº§ç”¨CogVideoXï¼‰
   - ä¼˜åŒ–æ˜¾å­˜ä½¿ç”¨

2. **å®Œå–„é”™è¯¯å¤„ç†**
   - é£æ ¼éªŒè¯é”™è¯¯æç¤º
   - æ˜¾å­˜ä¸è¶³æ—¶çš„é™çº§ç­–ç•¥
   - æ›´è¯¦ç»†çš„æ—¥å¿—å’Œç›‘æ§

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ‰¹é‡ç”Ÿæˆä¼˜åŒ–
   - ç¼“å­˜æœºåˆ¶
   - å¹¶è¡Œå¤„ç†

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰

1. **é›†æˆMochi 1**
   - äº§å“å¹¿å‘Šç‰¹æ•ˆæ”¯æŒ
   - æµä½“ã€å¸ƒæ–™ã€çƒŸé›¾ç‰¹æ•ˆ

2. **å‰ç«¯é›†æˆ**
   - é£æ ¼é€‰æ‹©UI
   - å®æ—¶é¢„è§ˆ
   - è¿›åº¦ç›‘æ§

3. **å•†ä¸šåŒ–åŠŸèƒ½**
   - ç”¨æˆ·æƒé™ç®¡ç†
   - è®¡è´¹ç³»ç»Ÿ
   - ä½¿ç”¨ç»Ÿè®¡

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰

1. **å¹³å°åŒ–**
   - å¤šç§Ÿæˆ·æ”¯æŒ
   - APIç½‘å…³
   - è´Ÿè½½å‡è¡¡

2. **AIä¼˜åŒ–**
   - è‡ªåŠ¨é£æ ¼æ¨è
   - æ™ºèƒ½å‚æ•°è°ƒæ•´
   - è´¨é‡è¯„ä¼°

## æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `gen_video/video_generator.py`: è§†é¢‘ç”Ÿæˆå™¨ï¼ˆæ”¯æŒHunyuanVideoï¼‰
- `gen_video/main.py`: å®Œæ•´æµæ°´çº¿
- `gen_video/config.yaml`: é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«é£æ ¼æ¨¡æ¿ï¼‰
- `gen_video/api/mvp_main.py`: APIæ¥å£

### å·¥å…·æ–‡ä»¶
- `gen_video/utils/style_validator.py`: é£æ ¼éªŒè¯å·¥å…·
- `gen_video/test_complete_pipeline_commercial.py`: å•†ä¸šåŒ–æµ‹è¯•è„šæœ¬
- `gen_video/é£æ ¼é…ç½®è¯´æ˜.md`: é£æ ¼é…ç½®æ–‡æ¡£

### æ–‡æ¡£
- `gen_video/å®Œæ•´æµæ°´çº¿å¼€å‘æ€»ç»“.md`: æœ¬æ–‡æ¡£
- `gen_video/é£æ ¼é…ç½®è¯´æ˜.md`: é£æ ¼é…ç½®è¯¦ç»†è¯´æ˜

## æµ‹è¯•å‘½ä»¤

### æµ‹è¯•é£æ ¼é…ç½®
```bash
python gen_video/utils/style_validator.py
```

### æµ‹è¯•å®Œæ•´æµæ°´çº¿ï¼ˆç§‘æ™®åœºæ™¯ï¼‰
```bash
python gen_video/test_complete_pipeline_commercial.py --scenario scientific
```

### æµ‹è¯•å®Œæ•´æµæ°´çº¿ï¼ˆäº§å“å¹¿å‘Šï¼‰
```bash
python gen_video/test_complete_pipeline_commercial.py --scenario product
```

### æµ‹è¯•å®Œæ•´æµæ°´çº¿ï¼ˆçŸ­å‰§æ¨æ–‡ï¼‰
```bash
python gen_video/test_complete_pipeline_commercial.py --scenario story
```

## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

1. **æ˜¾å­˜é™åˆ¶**
   - HunyuanVideoéœ€è¦å¤§é‡æ˜¾å­˜ï¼ˆå³ä½¿480pæ¨¡å‹ä¹Ÿéœ€è¦20GB+ï¼‰
   - å½“å‰ä½¿ç”¨CPU offloadå’Œæ˜¾å­˜é™åˆ¶æ¥ç¼“è§£
   - å»ºè®®åœ¨GPUäº‘ä¸Šè¿è¡Œé«˜ç«¯æ¨¡å‹

2. **é£æ ¼æ‰©å±•**
   - æ·»åŠ æ–°é£æ ¼éœ€è¦åœ¨config.yamlä¸­é…ç½®
   - éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ

3. **CogVideoXé›†æˆ**
   - å°šæœªé›†æˆï¼Œå½“å‰ä»…æ”¯æŒHunyuanVideo
   - è®¡åˆ’ä¸‹ä¸€æ­¥é›†æˆä»¥æ”¯æŒæ‰¹é‡ç”Ÿæˆ

## æ€»ç»“

å½“å‰ç³»ç»Ÿå·²ç»å®ç°äº†ï¼š
- âœ… å®Œæ•´çš„é£æ ¼é…ç½®ç³»ç»Ÿ
- âœ… HunyuanVideoé›†æˆå’Œä¼˜åŒ–
- âœ… è¯¦ç»†çš„promptæ„å»º
- âœ… APIæ¥å£æ”¯æŒ
- âœ… å®Œæ•´æµæ°´çº¿æµ‹è¯•

ä¸‹ä¸€æ­¥é‡ç‚¹æ˜¯ï¼š
- ğŸ”„ é›†æˆCogVideoX-5Bæ”¯æŒæ‰¹é‡ç”Ÿæˆ
- ğŸ”„ å®Œå–„é”™è¯¯å¤„ç†å’Œç›‘æ§
- ğŸ”„ å‰ç«¯é›†æˆå’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–

