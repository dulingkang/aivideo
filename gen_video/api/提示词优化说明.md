# API提示词优化说明

## 🎯 已实施的优化

### 1. 自动优化提示词

**问题**："高空拍摄"可能被模型理解为需要飞机视角

**解决方案**：自动将"高空拍摄"替换为"鸟瞰视角"

**示例**：
- 输入：`"高空拍摄的街景，上面有一辆小汽车"`
- 优化后：`"鸟瞰视角的街景，上面有一辆小汽车"`

### 2. 自动添加负面提示词

**问题**：通用场景可能生成不想要的元素（如飞机）

**解决方案**：自动添加默认负面提示词，排除飞行器

**默认排除项**：
- `airplane, aircraft, plane, flying vehicle`
- `helicopter, drone, UFO, spaceship`
- `飞机, 飞行器, 直升机, 无人机`

**示例**：
- 用户输入：`negative_prompt: "模糊, 低质量"`
- 实际使用：`"airplane, aircraft, plane, ..., 模糊, 低质量"`

---

## 📋 使用建议

### 1. 提示词编写

**推荐写法**：
```
鸟瞰视角的街景，从高处向下看，街道上有一辆小汽车，俯视角度
```

**避免写法**：
```
高空拍摄的街景，上面有一辆小汽车  # 可能被理解为飞机视角
```

### 2. 负面提示词

**如果不需要默认排除项**：
- 可以在负面提示词中明确说明
- 或者修改代码中的 `default_negative_parts` 列表

**如果需要添加更多排除项**：
- 在API请求的 `negative_prompt` 中添加
- 系统会自动合并

---

## 🔧 自定义配置

如果需要修改默认负面提示词，编辑 `gen_video/api/mvp_main.py`：

```python
# 修改 default_negative_parts 列表
default_negative_parts = [
    "airplane", "aircraft", "plane",  # 飞行器
    # 添加更多排除项...
]
```

---

## 🐛 问题排查

### 如果仍然生成飞机

1. **检查场景参考图像选择**：
   - 查看API日志，确认是否使用了参考图像
   - 如果参考图像包含飞机，考虑禁用场景参考图像选择

2. **检查提示词**：
   - 确认提示词是否被正确优化
   - 查看日志中的"提示词优化"信息

3. **检查负面提示词**：
   - 确认负面提示词是否正确应用
   - 查看日志中的"负面提示词"信息

4. **手动测试**：
   - 使用更明确的提示词："鸟瞰视角，俯视角度，从高处向下看"
   - 添加更强的负面提示词："airplane:2.0, aircraft:2.0"

---

**最后更新**：2024年

