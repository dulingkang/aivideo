# å¤šæ¨¡å‹ç»„åˆæ–¹æ¡ˆ - å®æ–½æŒ‡å—

## ğŸ¯ æ–¹æ¡ˆæ¦‚è¿°

é’ˆå¯¹**ç§‘æ™®è§†é¢‘æµæ°´çº¿ + æ”¿åºœå•**åœºæ™¯ï¼Œé‡‡ç”¨å¤šæ¨¡å‹ç»„åˆç­–ç•¥ï¼Œå……åˆ†å‘æŒ¥å„æ¨¡å‹ä¼˜åŠ¿ï¼š

| ç”¨é€” | æ¨èæ¨¡å‹ | ç†ç”± |
|------|---------|------|
| **ç§‘æ™®ä¸»æŒäººå›ºå®šäººè®¾** | **Flux 1-dev + InstantID** | äººè„¸æœ€ç¨³ã€LoRA æ•ˆæœæœ€å¥½ |
| **ä¸­å›½å¼ç§‘æ•™åœºæ™¯ã€å¤ªç©ºã€å®éªŒå®¤** | **Hunyuan-DiT** | ä¸­æ–‡ç†è§£æœ€å¼º |
| **è¿½æ±‚çœŸå®æ„Ÿå’Œç¨³å®šæ€§** | **Kolors** | æ‰‹éƒ¨ã€å…‰å½±ä¼˜ç§€ |
| **æé€Ÿå‡ºå¤§é‡ç´ æ** | **SD3.x Turbo** | ä¸€ç§’ä¸€å¼ ï¼Œé«˜é€Ÿæµæ°´çº¿ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å‹é€‰æ‹©ç­–ç•¥

```
ç”Ÿæˆä»»åŠ¡ç±»å‹åˆ¤æ–­
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. äººç‰©ç”Ÿæˆï¼ˆä¸»æŒäººï¼‰                 â”‚
â”‚     â†’ Flux 1-dev + InstantID        â”‚
â”‚     â†’ å›ºå®šäººè®¾ï¼Œ365å¤©ä¸æ¢è„¸           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åœºæ™¯ç”Ÿæˆï¼ˆç§‘æ™®èƒŒæ™¯ï¼‰               â”‚
â”‚     â†’ Hunyuan-DiTï¼ˆä¸­æ–‡åœºæ™¯ä¼˜å…ˆï¼‰     â”‚
â”‚     â†’ Kolorsï¼ˆçœŸå®æ„Ÿåœºæ™¯ï¼‰            â”‚
â”‚     â†’ SD3 Turboï¼ˆæ‰¹é‡å¤‡é€‰å›¾ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åˆæˆä¸åå¤„ç†                      â”‚
â”‚     â†’ äººç‰© + åœºæ™¯åˆæˆ                 â”‚
â”‚     â†’ Real-ESRGAN è¶…åˆ†               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ¨¡å‹å‡†å¤‡

#### 1.1 ä¸‹è½½ Flux 1-dev æ¨¡å‹

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p /vepfs-dev/shawn/vid/fanren/gen_video/models/flux1-dev

# ä½¿ç”¨ huggingface-cli ä¸‹è½½
huggingface-cli download black-forest-labs/FLUX.1-dev \
    --local-dir /vepfs-dev/shawn/vid/fanren/gen_video/models/flux1-dev \
    --local-dir-use-symlinks False
```

**æ³¨æ„äº‹é¡¹ï¼š**
- Flux 1-dev æ¨¡å‹è¾ƒå¤§ï¼ˆçº¦ 24GBï¼‰ï¼Œéœ€è¦è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
- éœ€è¦ CUDA 12.1+ å’Œ PyTorch 2.5+ æ”¯æŒ
- æ¨èä½¿ç”¨ fp16 é‡åŒ–ä»¥èŠ‚çœæ˜¾å­˜

#### 1.2 ä¸‹è½½ Hunyuan-DiT æ¨¡å‹

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p /vepfs-dev/shawn/vid/fanren/gen_video/models/hunyuan-dit

# ä»è…¾è®¯äº‘æˆ–å®˜æ–¹ä»“åº“ä¸‹è½½
# æ³¨æ„ï¼šHunyuan-DiT å¯èƒ½éœ€è¦ç‰¹æ®Šæˆæƒï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£
```

**Hunyuan-DiT ä¼˜åŠ¿ï¼š**
- ä¸­æ–‡ç†è§£èƒ½åŠ›æœ€å¼º
- é€‚åˆç”Ÿæˆä¸­å›½å¼ç§‘æ•™åœºæ™¯ï¼ˆå®éªŒå®¤ã€å¤ªç©ºç«™ã€ç§‘æŠ€é¦†ç­‰ï¼‰
- å¯¹ä¸­æ–‡æç¤ºè¯çš„ç†è§£æ›´å‡†ç¡®

#### 1.3 ä¸‹è½½ Kolors æ¨¡å‹

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p /vepfs-dev/shawn/vid/fanren/gen_video/models/kolors

# ä»å®˜æ–¹ä»“åº“ä¸‹è½½
# Kolors ä¸“æ³¨äºçœŸå®æ„Ÿå’Œç¨³å®šæ€§ï¼Œæ‰‹éƒ¨ã€å…‰å½±è¡¨ç°ä¼˜ç§€
```

#### 1.4 ä¸‹è½½ SD3 Turbo æ¨¡å‹

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p /vepfs-dev/shawn/vid/fanren/gen_video/models/sd3-turbo

# ä½¿ç”¨ huggingface-cli ä¸‹è½½
huggingface-cli download stabilityai/stable-diffusion-3-turbo \
    --local-dir /vepfs-dev/shawn/vid/fanren/gen_video/models/sd3-turbo \
    --local-dir-use-symlinks False
```

**SD3 Turbo ä¼˜åŠ¿ï¼š**
- ç”Ÿæˆé€Ÿåº¦æå¿«ï¼ˆ1ç§’/å¼ ï¼‰
- é€‚åˆæ‰¹é‡ç”Ÿæˆå¤‡é€‰ç´ æ
- è´¨é‡ç¨³å®šï¼Œé€‚åˆæµæ°´çº¿ç”Ÿäº§

---

### ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶æ›´æ–°

#### 2.1 æ›´æ–° `config.yaml`

åœ¨ `image` é…ç½®æ®µæ·»åŠ å¤šæ¨¡å‹é…ç½®ï¼š

```yaml
image:
  # ä¸»å¼•æ“é€‰æ‹©ç­–ç•¥
  # å¯é€‰å€¼ï¼šautoï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼‰ã€flux-instantidã€hunyuan-ditã€kolorsã€sd3-turboã€instantidï¼ˆå½“å‰æ–¹æ¡ˆï¼‰
  engine: auto  # è‡ªåŠ¨æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©
  
  # æ¨¡å‹é€‰æ‹©ç­–ç•¥é…ç½®
  model_selection:
    # äººç‰©ç”Ÿæˆï¼ˆä¸»æŒäººï¼‰
    character:
      engine: flux-instantid  # Flux 1-dev + InstantID
      flux_model_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/flux1-dev
      instantid_path: /vepfs-dev/shawn/vid/fanren/InstantID/checkpoints
      controlnet_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/instantid/ControlNet
      face_image_path: /vepfs-dev/shawn/vid/fanren/gen_video/reference_image/character_mid.png
      # LoRA é…ç½®ï¼ˆç”¨äºå›ºå®šäººè®¾ï¼‰
      lora:
        enabled: true
        weights_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/lora/kepu_gege/pytorch_lora_weights.safetensors
        adapter_name: kepu_gege
        alpha: 0.60
    
    # åœºæ™¯ç”Ÿæˆï¼ˆç§‘æ™®èƒŒæ™¯ï¼‰
    scene:
      # ä¼˜å…ˆçº§åˆ—è¡¨ï¼ˆæŒ‰é¡ºåºå°è¯•ï¼‰
      engines:
        - hunyuan-dit  # ä¼˜å…ˆï¼šä¸­æ–‡åœºæ™¯
        - kolors       # å¤‡é€‰ï¼šçœŸå®æ„Ÿåœºæ™¯
        - sd3-turbo    # æ‰¹é‡ï¼šé«˜é€Ÿå¤‡é€‰å›¾
      
      # Hunyuan-DiT é…ç½®
      hunyuan_dit:
        model_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/hunyuan-dit
        width: 1536
        height: 864
        num_inference_steps: 50
        guidance_scale: 7.5
        # ä¸­æ–‡æç¤ºè¯ä¼˜åŒ–
        chinese_optimization: true
      
      # Kolors é…ç½®
      kolors:
        model_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/kolors
        width: 1536
        height: 864
        num_inference_steps: 40
        guidance_scale: 7.0
        # çœŸå®æ„Ÿå¢å¼º
        realism_boost: true
      
      # SD3 Turbo é…ç½®
      sd3_turbo:
        model_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/sd3-turbo
        width: 1024
        height: 1024
        num_inference_steps: 4  # Turbo æ¨¡å¼ï¼Œæ­¥æ•°å°‘ä½†é€Ÿåº¦å¿«
        guidance_scale: 1.0      # Turbo æ¨¡å¼ï¼Œä½å¼•å¯¼
        # æ‰¹é‡ç”Ÿæˆæ¨¡å¼
        batch_mode: true
        batch_size: 4  # ä¸€æ¬¡ç”Ÿæˆ4å¼ å¤‡é€‰å›¾
```

---

### ç¬¬ä¸‰æ­¥ï¼šä»£ç å®ç°

#### 3.1 åˆ›å»ºæ¨¡å‹é€‰æ‹©å™¨

åˆ›å»º `gen_video/model_selector.py`ï¼š

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ¨¡å‹é€‰æ‹©å™¨ - æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹
"""

from typing import Dict, Any, Optional, Literal
from enum import Enum


class TaskType(Enum):
    """ä»»åŠ¡ç±»å‹"""
    CHARACTER = "character"  # äººç‰©ç”Ÿæˆï¼ˆä¸»æŒäººï¼‰
    SCENE = "scene"         # åœºæ™¯ç”Ÿæˆï¼ˆç§‘æ™®èƒŒæ™¯ï¼‰
    BATCH = "batch"          # æ‰¹é‡ç”Ÿæˆï¼ˆå¤‡é€‰å›¾ï¼‰


class ModelSelector:
    """æ¨¡å‹é€‰æ‹©å™¨"""
    
    def __init__(self, config: Dict[str, Any]):
        self.config = config
        self.image_config = config.get("image", {})
        self.model_selection = self.image_config.get("model_selection", {})
    
    def select_engine(
        self,
        task_type: TaskType,
        prompt: str,
        scene_context: Optional[Dict[str, Any]] = None
    ) -> str:
        """
        æ ¹æ®ä»»åŠ¡ç±»å‹å’Œæç¤ºè¯é€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹å¼•æ“
        
        Args:
            task_type: ä»»åŠ¡ç±»å‹ï¼ˆäººç‰©/åœºæ™¯/æ‰¹é‡ï¼‰
            prompt: ç”Ÿæˆæç¤ºè¯
            scene_context: åœºæ™¯ä¸Šä¸‹æ–‡ä¿¡æ¯
        
        Returns:
            æ¨¡å‹å¼•æ“åç§°
        """
        if task_type == TaskType.CHARACTER:
            # äººç‰©ç”Ÿæˆï¼šä½¿ç”¨ Flux + InstantID
            return "flux-instantid"
        
        elif task_type == TaskType.SCENE:
            # åœºæ™¯ç”Ÿæˆï¼šæ ¹æ®æç¤ºè¯å†…å®¹é€‰æ‹©
            return self._select_scene_engine(prompt, scene_context)
        
        elif task_type == TaskType.BATCH:
            # æ‰¹é‡ç”Ÿæˆï¼šä½¿ç”¨ SD3 Turbo
            return "sd3-turbo"
        
        else:
            # é»˜è®¤ä½¿ç”¨å½“å‰æ–¹æ¡ˆï¼ˆInstantIDï¼‰
            return "instantid"
    
    def _select_scene_engine(
        self,
        prompt: str,
        scene_context: Optional[Dict[str, Any]] = None
    ) -> str:
        """æ ¹æ®æç¤ºè¯é€‰æ‹©åœºæ™¯ç”Ÿæˆå¼•æ“"""
        prompt_lower = prompt.lower()
        
        # ä¸­æ–‡åœºæ™¯å…³é”®è¯ï¼ˆä¼˜å…ˆä½¿ç”¨ Hunyuan-DiTï¼‰
        chinese_scene_keywords = [
            "å®éªŒå®¤", "å¤ªç©º", "ç§‘æŠ€é¦†", "åšç‰©é¦†", "å¤©æ–‡å°",
            "ä¸­å›½", "ä¸­æ–‡", "ç§‘æ•™", "ç§‘æ™®", "æ•™è‚²"
        ]
        
        # çœŸå®æ„Ÿåœºæ™¯å…³é”®è¯ï¼ˆä¼˜å…ˆä½¿ç”¨ Kolorsï¼‰
        realism_keywords = [
            "çœŸå®", "ç…§ç‰‡", "æ‘„å½±", "æ‰‹éƒ¨", "å…‰å½±", "ç»†èŠ‚"
        ]
        
        # æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡åœºæ™¯å…³é”®è¯
        if any(keyword in prompt for keyword in chinese_scene_keywords):
            return "hunyuan-dit"
        
        # æ£€æŸ¥æ˜¯å¦åŒ…å«çœŸå®æ„Ÿå…³é”®è¯
        if any(keyword in prompt for keyword in realism_keywords):
            return "kolors"
        
        # é»˜è®¤ä½¿ç”¨ Hunyuan-DiTï¼ˆä¸­æ–‡ç†è§£æœ€å¼ºï¼‰
        return "hunyuan-dit"
    
    def get_engine_config(self, engine: str) -> Dict[str, Any]:
        """è·å–æŒ‡å®šå¼•æ“çš„é…ç½®"""
        model_selection = self.image_config.get("model_selection", {})
        
        if engine == "flux-instantid":
            return model_selection.get("character", {})
        elif engine == "hunyuan-dit":
            return model_selection.get("scene", {}).get("hunyuan_dit", {})
        elif engine == "kolors":
            return model_selection.get("scene", {}).get("kolors", {})
        elif engine == "sd3-turbo":
            return model_selection.get("scene", {}).get("sd3_turbo", {})
        else:
            # é»˜è®¤é…ç½®ï¼ˆInstantIDï¼‰
            return self.image_config.get("instantid", {})
```

#### 3.2 æ›´æ–° ImageGenerator

åœ¨ `image_generator.py` ä¸­æ·»åŠ å¤šæ¨¡å‹æ”¯æŒï¼š

```python
# åœ¨ ImageGenerator ç±»ä¸­æ·»åŠ 

from model_selector import ModelSelector, TaskType

class ImageGenerator:
    def __init__(self, config_path: str = "config.yaml") -> None:
        # ... ç°æœ‰åˆå§‹åŒ–ä»£ç  ...
        
        # åˆå§‹åŒ–æ¨¡å‹é€‰æ‹©å™¨
        self.model_selector = ModelSelector(self.config)
        
        # å¤šæ¨¡å‹ pipeline ç¼“å­˜
        self.flux_pipeline = None
        self.hunyuan_dit_pipeline = None
        self.kolors_pipeline = None
        self.sd3_turbo_pipeline = None
    
    def _load_flux_pipeline(self):
        """åŠ è½½ Flux 1-dev + InstantID pipeline"""
        if self.flux_pipeline is None:
            # å®ç° Flux + InstantID åŠ è½½é€»è¾‘
            # å‚è€ƒï¼šhttps://github.com/InstantX/InstantID
            pass
        return self.flux_pipeline
    
    def _load_hunyuan_dit_pipeline(self):
        """åŠ è½½ Hunyuan-DiT pipeline"""
        if self.hunyuan_dit_pipeline is None:
            # å®ç° Hunyuan-DiT åŠ è½½é€»è¾‘
            pass
        return self.hunyuan_dit_pipeline
    
    def _load_kolors_pipeline(self):
        """åŠ è½½ Kolors pipeline"""
        if self.kolors_pipeline is None:
            # å®ç° Kolors åŠ è½½é€»è¾‘
            pass
        return self.kolors_pipeline
    
    def _load_sd3_turbo_pipeline(self):
        """åŠ è½½ SD3 Turbo pipeline"""
        if self.sd3_turbo_pipeline is None:
            # å®ç° SD3 Turbo åŠ è½½é€»è¾‘
            pass
        return self.sd3_turbo_pipeline
    
    def generate_image(
        self,
        prompt: str,
        output_path: str,
        task_type: Optional[TaskType] = None,
        **kwargs
    ):
        """
        ç”Ÿæˆå›¾åƒï¼ˆæ”¯æŒå¤šæ¨¡å‹ï¼‰
        
        Args:
            prompt: ç”Ÿæˆæç¤ºè¯
            output_path: è¾“å‡ºè·¯å¾„
            task_type: ä»»åŠ¡ç±»å‹ï¼ˆè‡ªåŠ¨åˆ¤æ–­æˆ–æ‰‹åŠ¨æŒ‡å®šï¼‰
            **kwargs: å…¶ä»–å‚æ•°
        """
        # è‡ªåŠ¨åˆ¤æ–­ä»»åŠ¡ç±»å‹
        if task_type is None:
            task_type = self._detect_task_type(prompt, kwargs)
        
        # é€‰æ‹©æœ€é€‚åˆçš„å¼•æ“
        engine = self.model_selector.select_engine(task_type, prompt, kwargs.get("scene"))
        
        # æ ¹æ®å¼•æ“è°ƒç”¨å¯¹åº”çš„ç”Ÿæˆæ–¹æ³•
        if engine == "flux-instantid":
            return self._generate_with_flux(prompt, output_path, **kwargs)
        elif engine == "hunyuan-dit":
            return self._generate_with_hunyuan_dit(prompt, output_path, **kwargs)
        elif engine == "kolors":
            return self._generate_with_kolors(prompt, output_path, **kwargs)
        elif engine == "sd3-turbo":
            return self._generate_with_sd3_turbo(prompt, output_path, **kwargs)
        else:
            # é»˜è®¤ä½¿ç”¨ InstantIDï¼ˆå½“å‰æ–¹æ¡ˆï¼‰
            return self._generate_with_instantid(prompt, output_path, **kwargs)
    
    def _detect_task_type(self, prompt: str, kwargs: Dict) -> TaskType:
        """è‡ªåŠ¨æ£€æµ‹ä»»åŠ¡ç±»å‹"""
        # å¦‚æœæä¾›äº† face_reference_image_pathï¼Œåˆ¤æ–­ä¸ºäººç‰©ç”Ÿæˆ
        if kwargs.get("face_reference_image_path"):
            return TaskType.CHARACTER
        
        # å¦‚æœæä¾›äº† character_loraï¼Œåˆ¤æ–­ä¸ºäººç‰©ç”Ÿæˆ
        if kwargs.get("character_lora"):
            return TaskType.CHARACTER
        
        # å¦åˆ™åˆ¤æ–­ä¸ºåœºæ™¯ç”Ÿæˆ
        return TaskType.SCENE
```

---

### ç¬¬å››æ­¥ï¼šAPI æ›´æ–°

#### 4.1 æ›´æ–° API ç«¯ç‚¹

åœ¨ `mvp_main.py` ä¸­æ·»åŠ æ¨¡å‹é€‰æ‹©å‚æ•°ï¼š

```python
@app.post("/api/v1/images/generate", response_model=ImageResponse)
async def generate_image(
    prompt: str = Form(...),
    # ... ç°æœ‰å‚æ•° ...
    model_engine: Optional[str] = Form(None, description="æŒ‡å®šæ¨¡å‹å¼•æ“ï¼ˆå¯é€‰ï¼‰ï¼šflux-instantid, hunyuan-dit, kolors, sd3-turbo, autoï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼‰"),
    task_type: Optional[str] = Form(None, description="ä»»åŠ¡ç±»å‹ï¼ˆå¯é€‰ï¼‰ï¼šcharacterï¼ˆäººç‰©ï¼‰, sceneï¼ˆåœºæ™¯ï¼‰, batchï¼ˆæ‰¹é‡ï¼‰"),
    current_user: dict = Depends(verify_api_key)
):
    """
    ç”Ÿæˆå›¾åƒï¼ˆæ”¯æŒå¤šæ¨¡å‹é€‰æ‹©ï¼‰
    
    - **model_engine**: æŒ‡å®šæ¨¡å‹å¼•æ“ï¼ˆå¯é€‰ï¼‰
      - `auto`: è‡ªåŠ¨é€‰æ‹©ï¼ˆæ¨èï¼‰
      - `flux-instantid`: äººç‰©ç”Ÿæˆï¼ˆä¸»æŒäººï¼‰
      - `hunyuan-dit`: ä¸­æ–‡åœºæ™¯
      - `kolors`: çœŸå®æ„Ÿåœºæ™¯
      - `sd3-turbo`: æ‰¹é‡ç”Ÿæˆ
    
    - **task_type**: ä»»åŠ¡ç±»å‹ï¼ˆå¯é€‰ï¼‰
      - `character`: äººç‰©ç”Ÿæˆ
      - `scene`: åœºæ™¯ç”Ÿæˆ
      - `batch`: æ‰¹é‡ç”Ÿæˆ
    """
    # ... ç°æœ‰ä»£ç  ...
    
    # å¦‚æœæŒ‡å®šäº† model_engineï¼Œä½¿ç”¨æŒ‡å®šå¼•æ“
    # å¦åˆ™ä½¿ç”¨è‡ªåŠ¨é€‰æ‹©
    if model_engine and model_engine != "auto":
        # ä½¿ç”¨æŒ‡å®šå¼•æ“
        pass
    else:
        # è‡ªåŠ¨é€‰æ‹©å¼•æ“
        task_type_enum = TaskType[task_type.upper()] if task_type else None
        # ... è°ƒç”¨ç”Ÿæˆå™¨ ...
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç”Ÿæˆç§‘æ™®ä¸»æŒäººï¼ˆå›ºå®šäººè®¾ï¼‰

```python
import requests

BASE_URL = "http://localhost:8000"
API_KEY = "test-key-123"

# ç”Ÿæˆç§‘æ™®ä¸»æŒäººå›¾åƒ
response = requests.post(
    f"{BASE_URL}/api/v1/images/generate",
    headers={"X-API-Key": API_KEY},
    data={
        "prompt": "ç§‘æ™®ä¸»æŒäººï¼Œç«™åœ¨ç§‘æŠ€é¦†å‰ï¼Œå¾®ç¬‘è®²è§£",
        "model_engine": "flux-instantid",  # ä½¿ç”¨ Flux + InstantID
        "task_type": "character",           # äººç‰©ç”Ÿæˆ
        "width": 1536,
        "height": 864,
    }
)

result = response.json()
print(f"å›¾åƒURL: {result['image_url']}")
```

### ç¤ºä¾‹ 2ï¼šç”Ÿæˆä¸­æ–‡ç§‘æ™®åœºæ™¯

```python
# ç”Ÿæˆå®éªŒå®¤åœºæ™¯
response = requests.post(
    f"{BASE_URL}/api/v1/images/generate",
    headers={"X-API-Key": API_KEY},
    data={
        "prompt": "ç°ä»£åŒ–çš„ç§‘å­¦å®éªŒå®¤ï¼Œå®éªŒè®¾å¤‡æ•´é½æ’åˆ—ï¼Œç¯å…‰æ˜äº®",
        "model_engine": "hunyuan-dit",  # ä½¿ç”¨ Hunyuan-DiTï¼ˆä¸­æ–‡ç†è§£æœ€å¼ºï¼‰
        "task_type": "scene",            # åœºæ™¯ç”Ÿæˆ
        "width": 1536,
        "height": 864,
    }
)
```

### ç¤ºä¾‹ 3ï¼šæ‰¹é‡ç”Ÿæˆå¤‡é€‰å›¾

```python
# æ‰¹é‡ç”Ÿæˆå¤‡é€‰å›¾ï¼ˆé«˜é€Ÿï¼‰
response = requests.post(
    f"{BASE_URL}/api/v1/images/generate",
    headers={"X-API-Key": API_KEY},
    data={
        "prompt": "å¤ªç©ºç«™å†…éƒ¨ï¼Œå®‡èˆªå‘˜å·¥ä½œåœºæ™¯",
        "model_engine": "sd3-turbo",  # ä½¿ç”¨ SD3 Turboï¼ˆæé€Ÿï¼‰
        "task_type": "batch",          # æ‰¹é‡ç”Ÿæˆ
        "width": 1024,
        "height": 1024,
    }
)
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹ | ç”Ÿæˆé€Ÿåº¦ | è´¨é‡ | é€‚ç”¨åœºæ™¯ | æ˜¾å­˜å ç”¨ |
|------|---------|------|---------|---------|
| **Flux 1-dev + InstantID** | ä¸­ç­‰ï¼ˆ~30ç§’/å¼ ï¼‰ | â­â­â­â­â­ | å›ºå®šäººè®¾ | é«˜ï¼ˆ~16GBï¼‰ |
| **Hunyuan-DiT** | ä¸­ç­‰ï¼ˆ~25ç§’/å¼ ï¼‰ | â­â­â­â­â­ | ä¸­æ–‡åœºæ™¯ | ä¸­ï¼ˆ~12GBï¼‰ |
| **Kolors** | ä¸­ç­‰ï¼ˆ~28ç§’/å¼ ï¼‰ | â­â­â­â­â­ | çœŸå®æ„Ÿåœºæ™¯ | ä¸­ï¼ˆ~12GBï¼‰ |
| **SD3 Turbo** | æå¿«ï¼ˆ~1ç§’/å¼ ï¼‰ | â­â­â­â­ | æ‰¹é‡å¤‡é€‰å›¾ | ä½ï¼ˆ~8GBï¼‰ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ˜¾å­˜ç®¡ç†

- **å¤šæ¨¡å‹å…±å­˜**ï¼šä¸åŒæ¨¡å‹å¯ä»¥åŒæ—¶åŠ è½½ï¼Œä½†éœ€è¦è¶³å¤Ÿçš„æ˜¾å­˜ï¼ˆå»ºè®® 24GB+ï¼‰
- **æ¨¡å‹å¸è½½**ï¼šä¸ä½¿ç”¨çš„æ¨¡å‹å¯ä»¥å¸è½½åˆ° CPUï¼ŒèŠ‚çœæ˜¾å­˜
- **åŠ¨æ€åŠ è½½**ï¼šå»ºè®®ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼Œåªåœ¨éœ€è¦æ—¶åŠ è½½å¯¹åº”æ¨¡å‹

### 2. æ¨¡å‹å…¼å®¹æ€§

- **Flux 1-dev**ï¼šéœ€è¦ CUDA 12.1+ å’Œ PyTorch 2.5+
- **Hunyuan-DiT**ï¼šå¯èƒ½éœ€è¦ç‰¹æ®Šæˆæƒï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£
- **Kolors**ï¼šéœ€è¦æ£€æŸ¥æ¨¡å‹æ ¼å¼å’Œä¾èµ–
- **SD3 Turbo**ï¼šéœ€è¦ diffusers 0.27.0+

### 3. æˆæœ¬è€ƒè™‘

- **æ¨¡å‹ä¸‹è½½**ï¼šæ€»æ¨¡å‹å¤§å°çº¦ 50-60GBï¼Œéœ€è¦è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
- **æ˜¾å­˜éœ€æ±‚**ï¼šå»ºè®®ä½¿ç”¨ 24GB+ æ˜¾å­˜çš„ GPU
- **ç”Ÿæˆé€Ÿåº¦**ï¼šä¸åŒæ¨¡å‹é€Ÿåº¦å·®å¼‚è¾ƒå¤§ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©

---

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1å‘¨å†…ï¼‰
1. âœ… é›†æˆ **Flux 1-dev + InstantID**ï¼ˆäººç‰©ç”Ÿæˆï¼‰
2. âœ… é›†æˆ **SD3 Turbo**ï¼ˆæ‰¹é‡ç”Ÿæˆï¼‰

### ç¬¬äºŒé˜¶æ®µï¼ˆ2å‘¨å†…ï¼‰
3. âœ… é›†æˆ **Hunyuan-DiT**ï¼ˆä¸­æ–‡åœºæ™¯ï¼‰
4. âœ… é›†æˆ **Kolors**ï¼ˆçœŸå®æ„Ÿåœºæ™¯ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ3å‘¨å†…ï¼‰
5. âœ… ä¼˜åŒ–æ¨¡å‹é€‰æ‹©ç­–ç•¥
6. âœ… æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜æœºåˆ¶
7. âœ… å®Œæ•´æµ‹è¯•å’Œæ–‡æ¡£

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªå¤šæ¨¡å‹ç»„åˆæ–¹æ¡ˆéå¸¸é€‚åˆ**ç§‘æ™®è§†é¢‘æµæ°´çº¿ + æ”¿åºœå•**çš„åœºæ™¯ï¼š

âœ… **å›ºå®šäººè®¾**ï¼šFlux + InstantID ç¡®ä¿ 365 å¤©ä¸æ¢è„¸  
âœ… **ä¸­æ–‡åœºæ™¯**ï¼šHunyuan-DiT æä¾›æœ€å¼ºçš„ä¸­æ–‡ç†è§£èƒ½åŠ›  
âœ… **çœŸå®æ„Ÿ**ï¼šKolors æä¾›ä¼˜ç§€çš„æ‰‹éƒ¨å’Œå…‰å½±è¡¨ç°  
âœ… **é«˜æ•ˆç‡**ï¼šSD3 Turbo æ”¯æŒæé€Ÿæ‰¹é‡ç”Ÿæˆ  

**å»ºè®®ç«‹å³å¼€å§‹å®æ–½ï¼** ğŸš€

