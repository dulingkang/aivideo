# v2.2 工作计划追踪表

> **更新日期**: 2025-12-20  
> **状态**: 进行中

---

## 📋 核心原则

1. **JSON直接包含所有信息** - 无需LLM决策，所有参数都在JSON中
2. **无需转换器** - 直接使用新JSON格式，不再需要v2→v2.1转换
3. **LLM只做文案编辑** - 场景描述、氛围渲染，不参与决策

---

## ✅ 已完成

- [x] ExecutionRulesV21（规则引擎）
- [x] ExecutionExecutorV21（执行器）
- [x] CharacterAnchorManager（角色锚系统）
- [x] SDXL智能分流（特种兵定位）
- [x] LoRA Stack架构设计
- [x] 单LoRA使用指南

---

## 🔄 进行中

### 1. 确定最终JSON格式 ⏳

**目标**: JSON直接包含所有决策信息，无需LLM

**要求**:
- Shot类型（直接指定）
- Pose类型（直接指定）
- Model路由（直接指定）
- Character信息（完整描述）
- Prompt模板（可选，LLM只做文案填充）

**状态**: 设计中

**负责人**: -  
**截止日期**: 2025-12-21

---

## 📝 待办事项

### 2. 移除JSON转换器 ⏳

**目标**: 不再需要v2→v2.1转换，直接使用新格式

**任务**:
- [ ] 删除或标记`json_v2_to_v21_converter.py`为废弃
- [ ] 更新文档，说明直接使用新格式
- [ ] 清理相关调用代码

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-22

---

### 3. Execution Planner V3退休 ⏳

**目标**: 移除生成路径逻辑，只保留转换功能（如果需要）

**任务**:
- [ ] 移除LLM决策逻辑
- [ ] 移除动态切换逻辑
- [ ] 保留转换功能（如果需要）
- [ ] 更新所有调用点

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-25

---

### 4. 更新ExecutionExecutorV21 ⏳

**目标**: 直接从JSON读取所有参数，不依赖LLM

**任务**:
- [ ] 更新`execute_scene`方法，直接从JSON读取
- [ ] 移除所有LLM调用
- [ ] 验证参数完整性
- [ ] 添加参数验证

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-23

---

### 5. 重构Prompt Builder ⏳

**目标**: 只做模板填充，从JSON读取所有信息

**任务**:
- [ ] 移除LLM决策逻辑
- [ ] 从JSON读取Shot/Pose/Character信息
- [ ] 只做模板填充（可选LLM文案优化）
- [ ] 测试Prompt质量

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-24

---

### 6. 实施单LoRA运行时补丁 ⏳

**目标**: 应用3个运行时补丁，提升稳定性

**任务**:
- [ ] 气质锚点（必须）
- [ ] 显式锁词（必须）
- [ ] FaceDetailer（可选但推荐）
- [ ] 测试效果

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-26

---

### 7. 完善SDXL智能分流 ⏳

**目标**: 完善NPC/扩图/构图控制路由

**任务**:
- [ ] 测试NPC生成路由
- [ ] 测试扩图路由
- [ ] 测试构图控制路由
- [ ] 优化路由规则

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-27

---

### 8. 更新主流程 ⏳

**目标**: generate_novel_video.py和batch_novel_generator.py使用新JSON格式

**任务**:
- [ ] 更新`generate_novel_video.py`
- [ ] 更新`batch_novel_generator.py`
- [ ] 移除旧格式支持
- [ ] 测试端到端流程

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-28

---

### 9. 测试新JSON格式 ⏳

**目标**: 端到端测试，验证稳定性

**任务**:
- [ ] 创建测试JSON文件
- [ ] 运行端到端测试
- [ ] 验证参数完整性
- [ ] 验证生成质量

**状态**: 待开始

**负责人**: -  
**截止日期**: 2025-12-29

---

## 🔮 中期任务（1个月）

### 10. 准备LoRA Stack ⏳

**目标**: 准备解耦训练素材

**任务**:
- [ ] 准备脸部核心LoRA素材
- [ ] 准备阶段性气质LoRA素材
- [ ] 准备服饰LoRA素材
- [ ] 开始训练

**状态**: 待开始

**负责人**: -  
**截止日期**: 2026-01-20

---

## 📊 进度追踪

| 任务 | 状态 | 进度 | 截止日期 |
|------|------|------|----------|
| 确定最终JSON格式 | ✅ 已完成 | 100% | 2025-12-21 |
| 移除JSON转换器 | ✅ 已完成 | 100% | 2025-12-22 |
| Execution Planner V3退休 | ⏳ 待开始 | 0% | 2025-12-25 |
| 更新ExecutionExecutorV21 | ✅ 已完成 | 100% | 2025-12-23 |
| 重构Prompt Builder | ✅ 已完成 | 100% | 2025-12-24 |
| 实施单LoRA运行时补丁 | ⏳ 待开始 | 0% | 2025-12-26 |
| 完善SDXL智能分流 | ⏳ 待开始 | 0% | 2025-12-27 |
| 更新主流程 | ⏳ 待开始 | 0% | 2025-12-28 |
| 测试新JSON格式 | ⏳ 待开始 | 0% | 2025-12-29 |
| 准备LoRA Stack | ⏳ 待开始 | 0% | 2026-01-20 |

---

## 🎯 关键决策

### JSON格式原则

1. **直接包含所有信息**
   - Shot类型（直接指定）
   - Pose类型（直接指定）
   - Model路由（直接指定）
   - Character信息（完整描述）

2. **无需转换器**
   - 直接使用新格式
   - 不再需要v2→v2.1转换
   - 旧格式直接废弃

3. **LLM只做文案编辑**
   - 场景描述优化
   - 氛围渲染
   - 不参与决策

---

## 📝 备注

- 所有任务按优先级排序
- 关键路径：JSON格式 → Executor更新 → 主流程更新 → 测试
- 中期任务可以并行进行

---

## 🔗 相关文档

- `TECH_ARCHITECTURE_V2_1.md` - 技术架构文档
- `ARCHITECTURE_FINAL_V22.md` - 架构最终结论
- `PLANNER_RETIREMENT_PLAN.md` - Planner退休计划
- `schemas/scene_v2_1_example.json` - JSON格式示例

