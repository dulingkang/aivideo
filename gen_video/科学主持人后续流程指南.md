# 科学主持人形象后续流程指南

## ✅ 当前完成状态

- ✅ **科学主持人形象配置完成**
  - `character_profiles.yaml` 中已配置 `host_person` 角色
  - 包含完整的身份、面部特征、发型、服饰、身体特征描述
  
- ✅ **LoRA模型已训练**
  - LoRA模型位置: `models/lora/host_person_v2/pytorch_lora_weights.safetensors`
  - ModelManager已自动配置LoRA路径

- ✅ **训练数据已准备**
  - 训练图片: 20张（位于 `train_data/host_person/`）
  - 图片已统一尺寸和格式

---

## 🚀 下一步流程

### 第一步：测试生成效果（当前步骤）

**目标**: 验证科学主持人形象生成效果，确保LoRA和配置正常工作

**执行步骤**:

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
source /vepfs-dev/shawn/venv/py312/bin/activate

# 运行测试脚本
python test_host_person.py
```

**测试内容**:
- 生成5个不同场景的科学主持人图像
- 验证人脸一致性
- 验证服装一致性
- 验证不同角度和表情的生成效果

**预期输出**:
- 测试图像保存在 `outputs/test_host_person/`
- 测试报告保存在 `outputs/test_host_person/test_report.txt`

**如果测试失败**:
- 检查LoRA文件是否存在
- 检查ModelManager配置
- 查看错误日志

---

### 第二步：优化生成效果（如需要）

**如果测试效果不理想，可以**:

1. **调整LoRA权重**
   - 编辑 `model_manager.py`，修改 `lora_alpha` 值（默认1.0）
   - 建议范围: 0.5 - 1.5

2. **优化提示词**
   - 根据测试结果，调整 `character_profiles.yaml` 中的提示词
   - 可以增加或减少某些特征的权重

3. **重新训练LoRA**（如果效果很差）
   - 检查训练数据质量
   - 增加训练轮数
   - 调整训练参数

---

### 第三步：创建科普场景库

**目标**: 为科普视频创建丰富的场景提示词库

**执行步骤**:

1. **创建场景提示词文件**
   ```bash
   # 如果不存在，创建场景提示词文件
   touch gen_video/prompt/kepu_scenes.yaml
   ```

2. **定义场景分类**
   - 宇宙航天类（太空站、行星、星云等）
   - 量子/神经网络类（量子纠缠、神经网络结构等）
   - 实验室场景（科学实验、显微镜等）
   - 医学场景（人体结构、医疗设备等）
   - 自然环境（地球、海洋、森林等）

3. **测试场景生成**
   - 使用ModelManager生成测试场景
   - 验证场景质量
   - 优化提示词

**参考文档**:
- `国家科普短视频-缺失内容分析.md` - 场景分类参考
- `国家科普短视频-实施路线图.md` - 场景库建设指南

---

### 第四步：完善视频生成流程

**目标**: 整合科学主持人形象到完整视频生成流程

**执行步骤**:

1. **测试主持人+场景合成**
   - 生成主持人图像
   - 生成场景背景
   - 测试合成效果

2. **创建视频生成脚本**
   - 整合图像生成
   - 整合视频生成（SVD）
   - 整合配音生成（CosyVoice）
   - 整合字幕生成（WhisperX）

3. **测试完整流程**
   - 从脚本到最终视频
   - 验证各环节质量
   - 优化参数

**参考文档**:
- `完整视频生成流水线架构.md`
- `run_pipeline.py` - 主流程脚本

---

### 第五步：API集成

**目标**: 将科学主持人形象集成到API接口

**执行步骤**:

1. **测试API接口**
   ```bash
   # 启动API服务
   python gen_video/api/mvp_main.py
   
   # 测试生成
   curl -X POST "http://localhost:8000/api/v1/images/generate" \
     -H "X-API-Key: test-key-123" \
     -F "prompt=科普主持人，专业形象，微笑，正式着装" \
     -F "use_model_manager=true" \
     -F "task=host_face" \
     -F "width=1024" \
     -F "height=1024"
   ```

2. **验证API功能**
   - 测试图像生成
   - 测试参数传递
   - 测试错误处理

**参考文档**:
- `gen_video/api/MVP启动指南.md`
- `gen_video/api/API测试命令.md`

---

## 📋 检查清单

### 当前阶段（测试生成效果）

- [ ] 运行 `test_host_person.py` 测试脚本
- [ ] 检查生成的测试图像质量
- [ ] 验证人脸一致性
- [ ] 验证服装一致性
- [ ] 查看测试报告

### 下一阶段（场景库建设）

- [ ] 创建场景提示词文件
- [ ] 定义场景分类
- [ ] 生成测试场景
- [ ] 优化场景提示词

### 后续阶段（完整流程）

- [ ] 测试主持人+场景合成
- [ ] 创建视频生成脚本
- [ ] 测试完整流程
- [ ] API集成测试

---

## 🎯 成功标准

### 图像生成质量

- ✅ 人脸一致性: 不同场景下人脸特征保持一致
- ✅ 服装一致性: 服装风格统一
- ✅ 图像质量: 清晰、专业、符合科普视频风格
- ✅ 生成速度: 单张图像生成时间 < 30秒

### 流程完整性

- ✅ 能够稳定生成科学主持人图像
- ✅ 能够生成匹配的科普场景
- ✅ 能够合成完整的视频
- ✅ API接口正常工作

---

## 📞 问题排查

### 如果测试失败

1. **检查LoRA文件**
   ```bash
   ls -lh gen_video/models/lora/host_person_v2/pytorch_lora_weights.safetensors
   ```

2. **检查ModelManager配置**
   ```python
   from model_manager import ModelManager
   manager = ModelManager()
   print(manager.lora_configs)
   ```

3. **检查角色配置**
   ```python
   print(manager.character_profiles.get('host_person'))
   ```

### 如果生成效果不理想

1. **调整LoRA权重**: 修改 `model_manager.py` 中的 `lora_alpha`
2. **优化提示词**: 调整 `character_profiles.yaml` 中的描述
3. **检查训练数据**: 确保训练数据质量

---

## 📚 相关文档

- `character_profiles.yaml` - 角色配置文件
- `model_manager.py` - 模型管理器
- `LoRA使用指南.md` - LoRA使用说明
- `国家科普短视频-实施路线图.md` - 完整实施计划
- `完整视频生成流水线架构.md` - 流程架构

---

**最后更新**: 2024年


