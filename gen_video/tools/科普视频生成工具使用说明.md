# ç§‘æ™®è§†é¢‘ç”Ÿæˆå·¥å…·ä½¿ç”¨è¯´æ˜

## ğŸ“‹ å·¥å…·åˆ—è¡¨

### 1. åœºæ™¯æµ‹è¯•è„šæœ¬ (`kepu_scene_tester.py`)

ç”¨äºæ‰¹é‡ç”Ÿæˆæµ‹è¯•åœºæ™¯ï¼ŒéªŒè¯åœºæ™¯æç¤ºè¯åº“çš„è´¨é‡ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# æµ‹è¯•æ‰€æœ‰åœºæ™¯ç±»å‹ï¼ˆæ¯ä¸ªç±»å‹ç”Ÿæˆ2ä¸ªç¤ºä¾‹ï¼‰
cd /vepfs-dev/shawn/vid/fanren/gen_video
python tools/kepu_scene_tester.py --all --num-examples 2

# æµ‹è¯•ç‰¹å®šåœºæ™¯ç±»å‹
python tools/kepu_scene_tester.py --scene-type universe --example-index 0

# æŒ‡å®šæ¯ä¸ªåœºæ™¯ç±»å‹æµ‹è¯•çš„ç¤ºä¾‹æ•°é‡
python tools/kepu_scene_tester.py --all --num-examples 3

# æ˜¾å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨æ›´è½»é‡çš„æ¨¡å‹ï¼ˆæ¨èï¼‰
python tools/kepu_scene_tester.py --all --num-examples 2 --model-engine sdxl
# æˆ–ä½¿ç”¨ Kolorsï¼ˆçœŸå®æ„Ÿåœºæ™¯ï¼‰
python tools/kepu_scene_tester.py --all --num-examples 2 --model-engine kolors
```

#### è¾“å‡º

- æµ‹è¯•å›¾åƒä¿å­˜åœ¨: `outputs/kepu_scene_tests/`
- æµ‹è¯•æŠ¥å‘Šä¿å­˜åœ¨: `outputs/kepu_scene_tests/test_report.json`

#### å‚æ•°è¯´æ˜

- `--config`: é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤: config.yamlï¼‰
- `--scene-type`: æµ‹è¯•ç‰¹å®šåœºæ™¯ç±»å‹ï¼ˆå¦‚: universe, quantum, earthç­‰ï¼‰
- `--example-index`: æµ‹è¯•ç‰¹å®šç¤ºä¾‹ç´¢å¼•ï¼ˆä»…å½“æŒ‡å®š--scene-typeæ—¶æœ‰æ•ˆï¼‰
- `--num-examples`: æ¯ä¸ªåœºæ™¯ç±»å‹æµ‹è¯•çš„ç¤ºä¾‹æ•°é‡ï¼ˆé»˜è®¤: 2ï¼‰
- `--all`: æµ‹è¯•æ‰€æœ‰åœºæ™¯ç±»å‹
- `--model-engine`: æŒ‡å®šæ¨¡å‹å¼•æ“ï¼ˆå¯é€‰: sdxl, kolors, sd3-turbo, flux1, flux2, hunyuan-dit, autoï¼‰
  - **æ˜¾å­˜ä¸è¶³æ—¶æ¨è**: `sdxl` æˆ– `kolors`
  - **é»˜è®¤**: `auto`ï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼Œä½†å¯èƒ½å› æ˜¾å­˜ä¸è¶³å¤±è´¥ï¼‰

---

### 2. å¿«é€Ÿç”Ÿæˆå·¥å…· (`kepu_quick_generate.py`)

ä»çŸ¥è¯†åº“è¯»å–é€‰é¢˜ï¼Œè‡ªåŠ¨ç”Ÿæˆè„šæœ¬å¹¶ç”Ÿæˆå®Œæ•´è§†é¢‘ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# åˆ—å‡ºæ‰€æœ‰å¯ç”¨é€‰é¢˜
cd /vepfs-dev/shawn/vid/fanren/gen_video
python tools/kepu_quick_generate.py --list

# ç”Ÿæˆè§†é¢‘ï¼ˆä½¿ç”¨é»˜è®¤IPè§’è‰²ï¼šç§‘æ™®å“¥å“¥ï¼‰
python tools/kepu_quick_generate.py --topic "ä»€ä¹ˆæ˜¯é»‘æ´ï¼Ÿ"

# ç”Ÿæˆè§†é¢‘ï¼ˆæŒ‡å®šIPè§’è‰²ï¼šæœªæ¥å§å§ï¼‰
python tools/kepu_quick_generate.py --topic "ä»€ä¹ˆæ˜¯é»‘æ´ï¼Ÿ" --ip-character weilai_jiejie

# ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬ç”Ÿæˆè§†é¢‘
python tools/kepu_quick_generate.py --topic "ä»€ä¹ˆæ˜¯é»‘æ´ï¼Ÿ" --script custom_script.json
```

#### è¾“å‡º

- è„šæœ¬JSONä¿å­˜åœ¨: `outputs/kepu_videos/[é€‰é¢˜]_script.json`
- æœ€ç»ˆè§†é¢‘ä¿å­˜åœ¨: `outputs/kepu_videos/[é€‰é¢˜]_[æ—¶é—´æˆ³].mp4`

#### å‚æ•°è¯´æ˜

- `--config`: é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤: config.yamlï¼‰
- `--topic`: é€‰é¢˜æ ‡é¢˜ï¼ˆä»çŸ¥è¯†åº“ä¸­é€‰æ‹©ï¼Œå¿…å¡«ï¼‰
- `--ip-character`: IPè§’è‰²ï¼ˆkepu_gege æˆ– weilai_jiejieï¼Œé»˜è®¤: kepu_gegeï¼‰
- `--script`: è‡ªå®šä¹‰è„šæœ¬JSONæ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰
- `--list`: åˆ—å‡ºæ‰€æœ‰å¯ç”¨é€‰é¢˜

---

## ğŸ“š çŸ¥è¯†åº“å’Œåœºæ™¯åº“

### çŸ¥è¯†åº“ (`knowledge_base/kepu_topics.yaml`)

åŒ…å«æ‰€æœ‰å¯ç”¨çš„ç§‘æ™®é€‰é¢˜ï¼ŒæŒ‰åˆ†ç±»ç»„ç»‡ï¼š
- å®‡å®™èˆªå¤©ç±»
- é‡å­ç§‘å­¦ç±»
- åœ°çƒç§‘å­¦ç±»
- å·¥ä¸šèƒ½æºç±»
- åŸå¸‚æ²»ç†ç±»
- ç”Ÿç‰©ç§‘å­¦ç±»
- äººå·¥æ™ºèƒ½ç±»

### åœºæ™¯æç¤ºè¯åº“ (`prompt/kepu_scenes.yaml`)

åŒ…å«å„ç±»ç§‘æ™®åœºæ™¯çš„æç¤ºè¯ï¼Œæ¯ä¸ªç±»åˆ«åŒ…å«ï¼š
- åŸºç¡€æç¤ºè¯ (`base_prompt`)
- è´Ÿé¢æç¤ºè¯ (`negative_prompt`)
- é£æ ¼æ ‡ç­¾ (`style_tags`)
- åœºæ™¯ç¤ºä¾‹ (`examples`) - æ¯ä¸ªç±»åˆ«12ä¸ªç¤ºä¾‹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: æµ‹è¯•åœºæ™¯ç”Ÿæˆ

```bash
# æµ‹è¯•æ‰€æœ‰åœºæ™¯ç±»å‹
python tools/kepu_scene_tester.py --all --num-examples 1
```

### æ­¥éª¤2: æŸ¥çœ‹å¯ç”¨é€‰é¢˜

```bash
# åˆ—å‡ºæ‰€æœ‰é€‰é¢˜
python tools/kepu_quick_generate.py --list
```

### æ­¥éª¤3: ç”Ÿæˆç¬¬ä¸€ä¸ªè§†é¢‘

```bash
# é€‰æ‹©ä¸€ä¸ªç®€å•çš„é€‰é¢˜å¼€å§‹
python tools/kepu_quick_generate.py --topic "ä»€ä¹ˆæ˜¯é»‘æ´ï¼Ÿ"
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### LoRAé…ç½®

ç¡®ä¿LoRAæ¨¡å‹å·²æ­£ç¡®é…ç½®ï¼š
- ç§‘æ™®å“¥å“¥LoRA: `models/lora/kepu_gege/`
- æœªæ¥å§å§LoRA: `models/lora/weilai_jiejie/`

### æ¨¡å‹é…ç½®

åœ¨ `config.yaml` ä¸­é…ç½®ï¼š
- å›¾åƒç”Ÿæˆå¼•æ“
- è§†é¢‘ç”Ÿæˆå‚æ•°
- TTSé…ç½®
- è¾“å‡ºè·¯å¾„

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡ä½¿ç”¨**: ç¡®ä¿æ‰€æœ‰æ¨¡å‹å·²ä¸‹è½½å¹¶é…ç½®æ­£ç¡®
2. **ç”Ÿæˆæ—¶é—´**: å•æ¡è§†é¢‘ç”Ÿæˆæ—¶é—´çº¦2å°æ—¶ï¼ˆæ ¹æ®é…ç½®å’Œç¡¬ä»¶ï¼‰
3. **è„šæœ¬è‡ªå®šä¹‰**: å¦‚éœ€è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ç”Ÿæˆçš„JSONæ–‡ä»¶
4. **åœºæ™¯åŒ¹é…**: åœºæ™¯æç¤ºè¯ä¼šæ ¹æ®é€‰é¢˜ç±»å‹è‡ªåŠ¨é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: æ‰¾ä¸åˆ°é€‰é¢˜

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `--list` å‚æ•°æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é€‰é¢˜ï¼Œç¡®ä¿é€‰é¢˜æ ‡é¢˜å®Œå…¨åŒ¹é…ã€‚

### é—®é¢˜2: LoRAæœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥LoRAæ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿åœ¨ `config.yaml` ä¸­é…ç½®äº†LoRAè·¯å¾„ã€‚

### é—®é¢˜3: åœºæ™¯ç”Ÿæˆè´¨é‡ä¸ä½³

**è§£å†³æ–¹æ¡ˆ**: 
1. ä½¿ç”¨åœºæ™¯æµ‹è¯•è„šæœ¬æµ‹è¯•ä¸åŒåœºæ™¯ç±»å‹
2. è°ƒæ•´åœºæ™¯æç¤ºè¯åº“ä¸­çš„ç¤ºä¾‹
3. æ£€æŸ¥æ¨¡å‹é…ç½®å’Œå‚æ•°

### é—®é¢˜4: CUDA out of memoryï¼ˆæ˜¾å­˜ä¸è¶³ï¼‰

**è§£å†³æ–¹æ¡ˆ**: 
1. **ä½¿ç”¨æ›´è½»é‡çš„æ¨¡å‹å¼•æ“**:
   ```bash
   # ä½¿ç”¨ SDXLï¼ˆæ¨èï¼Œæ˜¾å­˜å ç”¨è¾ƒå°ï¼‰
   python tools/kepu_scene_tester.py --all --model-engine sdxl
   
   # æˆ–ä½¿ç”¨ Kolorsï¼ˆçœŸå®æ„Ÿåœºæ™¯ï¼‰
   python tools/kepu_scene_tester.py --all --model-engine kolors
   ```

2. **å‡å°‘æµ‹è¯•æ•°é‡**:
   ```bash
   # æ¯ä¸ªåœºæ™¯ç±»å‹åªæµ‹è¯•1ä¸ªç¤ºä¾‹
   python tools/kepu_scene_tester.py --all --num-examples 1 --model-engine sdxl
   ```

3. **é€ä¸ªæµ‹è¯•åœºæ™¯ç±»å‹**:
   ```bash
   # ä¸€æ¬¡åªæµ‹è¯•ä¸€ä¸ªåœºæ™¯ç±»å‹
   python tools/kepu_scene_tester.py --scene-type universe --model-engine sdxl
   ```

4. **æ¸…ç†æ˜¾å­˜**:
   ```bash
   # æ£€æŸ¥æ˜¾å­˜ä½¿ç”¨
   nvidia-smi
   
   # å¦‚æœæœ‰å…¶ä»–è¿›ç¨‹å ç”¨æ˜¾å­˜ï¼Œå…ˆå…³é—­å®ƒä»¬
   ```

5. **è„šæœ¬å·²è‡ªåŠ¨ä¼˜åŒ–**:
   - æ¯æ¬¡ç”Ÿæˆåè‡ªåŠ¨æ¸…ç†æ˜¾å­˜
   - æ¯ä¸ªåœºæ™¯ç±»å‹æµ‹è¯•å®Œæˆåæ¸…ç†æ˜¾å­˜
   - æ˜¾ç¤ºæ˜¾å­˜ä½¿ç”¨çŠ¶æ€

---

## ğŸ“ ä¸‹ä¸€æ­¥

å®ŒæˆDay 5ä»»åŠ¡åï¼Œå¯ä»¥ç»§ç»­ï¼š
1. æµ‹è¯•åœºæ™¯ç”Ÿæˆæ•ˆæœ
2. ä¼˜åŒ–åœºæ™¯æç¤ºè¯
3. å‡†å¤‡è¿›å…¥Day 6-7çš„è„šæœ¬æ¨¡æ¿å’ŒçŸ¥è¯†åº“å®Œå–„å·¥ä½œ

