# 科普视频测试工具使用说明

## 工具介绍

`kepu_pipeline_test.py` 是用于测试科普视频完整生成流程的工具，对应 Day 8-9 的任务。

## 功能

1. **自动选择测试选题**：从知识库中选择不同类别的选题
2. **批量生成测试视频**：支持多个IP角色和多个选题
3. **记录生成时间和问题**：自动记录每个测试的详细信息
4. **生成测试报告**：自动生成详细的测试报告

## 使用方法

### 基本用法

```bash
# 测试3个选题，使用默认的科普哥哥和未来姐姐
python gen_video/tools/kepu_pipeline_test.py --count 3

# 测试5个选题，只使用科普哥哥
python gen_video/tools/kepu_pipeline_test.py --count 5 --ip kepu_gege

# 指定输出目录
python gen_video/tools/kepu_pipeline_test.py --count 3 --output-dir outputs/test_videos
```

### 参数说明

- `--config`: 配置文件路径（默认：config.yaml）
- `--count`: 测试选题数量（默认：3）
- `--ip`: IP角色列表（默认：kepu_gege weilai_jiejie）
- `--output-dir`: 输出目录（可选）

## 测试流程

1. **选择测试选题**：从知识库中按类别选择选题
2. **生成脚本JSON**：为每个选题生成脚本
3. **初始化流水线**：加载所有必要的组件
4. **生成完整视频**：执行完整的视频生成流程
5. **检查输出文件**：验证生成的视频文件
6. **生成测试报告**：汇总所有测试结果

## 测试报告

测试完成后会自动生成测试报告，包含：

- 测试概览（总数、成功率、平均时间等）
- 详细结果（按IP角色分组）
- 错误列表
- 警告列表
- 优化建议

报告保存在：`outputs/test/test_report.md`

## 注意事项

1. **生成时间**：每个视频可能需要较长时间，建议分批测试
2. **资源占用**：确保有足够的GPU内存和存储空间
3. **错误处理**：如果某个测试失败，会继续执行其他测试
4. **版本要求**：确保 transformers 版本已降级到 4.51.3

## 示例输出

```
============================================================
科普视频完整流程测试
============================================================
测试选题数: 3
IP角色: kepu_gege, weilai_jiejie

选择的测试选题:
  1. 什么是黑洞？ (宇宙航天)
  2. 量子纠缠的原理 (量子物理)
  3. 地球的构造 (地球科学)

[测试过程...]

测试完成
总测试数: 6
成功: 6
失败: 0
测试报告: outputs/test/test_report.md
```

