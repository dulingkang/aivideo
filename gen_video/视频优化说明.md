# è§†é¢‘ä¼˜åŒ–è¯´æ˜

## ğŸ“Š é—®é¢˜åˆ†æ

ç”¨æˆ·åé¦ˆè§†é¢‘æ•ˆæœä¸å¥½ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š
1. **å¥½å¤šæ²¡æœ‰é•œå¤´çš„ç§»åŠ¨**ï¼šå¾ˆå¤šåœºæ™¯è™½ç„¶æœ‰ `motion` å­—æ®µæŒ‡å®šäº†é•œå¤´è¿åŠ¨ï¼Œä½†å®é™…ç”Ÿæˆçš„è§†é¢‘æ²¡æœ‰é•œå¤´ç§»åŠ¨
2. **æœ‰ä¸€äº›åŠ¨çš„æ•ˆæœä¸è‡ªç„¶**ï¼šä¸€äº›åŠ¨ä½œåœºæ™¯çš„è¿åŠ¨æ•ˆæœä¸è‡ªç„¶ã€ä¸æµç•…

## âœ… å·²å®æ–½çš„ä¼˜åŒ–

### 1. å¢å¼ºé•œå¤´ç§»åŠ¨æ£€æµ‹ï¼ˆ`scene_motion_analyzer.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **ä¼˜å…ˆä» `motion` å­—æ®µè¯»å–**ï¼šå¦‚æœ JSON ä¸­æ˜ç¡®æŒ‡å®šäº† `motion.type`ï¼Œä¼˜å…ˆä½¿ç”¨è¯¥å€¼
- **è‡ªåŠ¨å¯ç”¨ SVD**ï¼šæ£€æµ‹åˆ°é•œå¤´è¿åŠ¨æ—¶ï¼Œè‡ªåŠ¨è®¾ç½® `use_svd = True`ï¼Œç¡®ä¿ä½¿ç”¨ SVD ç”Ÿæˆè§†é¢‘
- **è‡ªåŠ¨è®¾ç½®è¿åŠ¨å‚æ•°**ï¼šæ ¹æ®é•œå¤´è¿åŠ¨ç±»å‹è‡ªåŠ¨è®¾ç½® `motion_bucket_id` å’Œ `noise_aug_strength`
  - `pan`, `tilt`, `dolly`, `orbit`ï¼š`motion_bucket_id = 2.0`ï¼Œ`noise_aug_strength = 0.0003`
  - `zoom`ï¼š`motion_bucket_id = 1.8`ï¼Œ`noise_aug_strength = 0.0003`
- **ä» `camera` å­—æ®µæ¨æ–­**ï¼šå¦‚æœ `motion` å­—æ®µæ²¡æœ‰æŒ‡å®šï¼Œä» `camera` å­—æ®µæ¨æ–­é•œå¤´è¿åŠ¨
- **ä» `description` æ¨æ–­**ï¼šå¦‚æœéƒ½æ²¡æœ‰ï¼Œä» `description` ä¸­æ¨æ–­é•œå¤´è¿åŠ¨ï¼ˆå¦‚"æ¨è¿›"ã€"æ‹‰è¿œ"ã€"æ¨ªç§»"ç­‰ï¼‰

**ä»£ç ä½ç½®**ï¼š
```python
# scene_motion_analyzer.py, line 123-155
# ä¼˜å…ˆä»motionå­—æ®µè¯»å–ï¼ˆå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜æ˜ç¡®æŒ‡å®šäº†é•œå¤´è¿åŠ¨ï¼‰
if motion_value:
    if isinstance(motion_value, dict):
        motion_type = motion_value.get("type", "")
        if motion_type and motion_type != "static":
            result["camera_motion_type"] = motion_type
            result["use_svd"] = True  # æœ‰é•œå¤´è¿åŠ¨ï¼Œå¿…é¡»ä½¿ç”¨SVD
            # æ ¹æ®é•œå¤´è¿åŠ¨ç±»å‹è°ƒæ•´è¿åŠ¨å‚æ•°ï¼Œç¡®ä¿é•œå¤´ç§»åŠ¨æ˜æ˜¾
            if motion_type in ["pan", "tilt", "dolly", "orbit"]:
                result["motion_bucket_id_override"] = 2.0
                result["noise_aug_strength_override"] = 0.0003
```

### 2. ä¼˜åŒ–åŠ¨ä½œè‡ªç„¶åº¦å‚æ•°ï¼ˆ`scene_motion_analyzer.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **ä¸­ç­‰åŠ¨ä½œ**ï¼š`noise_aug_strength` ä» `0.0003` æé«˜åˆ° `0.00035`ï¼Œä½¿åŠ¨ä½œæ›´è‡ªç„¶æµç•…
- **è½»å¾®åŠ¨ä½œ**ï¼šä¿æŒ `motion_bucket_id = 1.8`ï¼Œ`noise_aug_strength = 0.0003`ï¼Œç¡®ä¿æœ‰è‡ªç„¶å¾®åŠ¨

**ä»£ç ä½ç½®**ï¼š
```python
# scene_motion_analyzer.py, line 181-187
elif any(keyword in all_text for keyword in self.moderate_action_keywords):
    result["motion_intensity"] = "moderate"
    result["use_svd"] = True
    result["motion_bucket_id_override"] = 2.0
    result["noise_aug_strength_override"] = 0.00035  # ç¨é«˜å™ªå£°ï¼Œä½¿åŠ¨ä½œæ›´è‡ªç„¶æµç•…
```

### 3. å¢å¼ºé•œå¤´è¿åŠ¨å‚æ•°ï¼ˆ`video_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **æ£€æµ‹é•œå¤´è¿åŠ¨**ï¼šåœ¨ `generate_video` ä¸­æ£€æµ‹æ˜¯å¦æœ‰é•œå¤´è¿åŠ¨
- **æé«˜è¿åŠ¨å‚æ•°**ï¼šå¦‚æœæœ‰é•œå¤´è¿åŠ¨ï¼Œç¡®ä¿ `motion_bucket_id >= 2.0`ï¼Œ`noise_aug_strength >= 0.00035`
- **æé«˜æ¨ç†æ­¥æ•°**ï¼šé•œå¤´è¿åŠ¨åœºæ™¯ï¼Œæ¨ç†æ­¥æ•°è‡³å°‘ 45 æ­¥ï¼Œæé«˜ç¨³å®šæ€§å’Œæµç•…åº¦
- **ä¼˜åŒ– decode_chunk_size**ï¼šé•œå¤´è¿åŠ¨åœºæ™¯ï¼Œ`decode_chunk_size` è®¾ç½®ä¸º 6-7ï¼Œå¹³è¡¡è¿è´¯æ€§å’Œæµç•…åº¦

**ä»£ç ä½ç½®**ï¼š
```python
# video_generator.py, line 165-189
# å¦‚æœæœ‰é•œå¤´è¿åŠ¨ï¼Œç¡®ä¿è¿åŠ¨å‚æ•°è¶³å¤Ÿé«˜ï¼Œä½¿é•œå¤´ç§»åŠ¨æ˜æ˜¾
if camera_motion_type != 'static':
    if motion_bucket_id < 2.0:
        motion_bucket_id = 2.0
    if noise_aug_strength < 0.0003:
        noise_aug_strength = 0.00035  # ç¨é«˜å™ªå£°ï¼Œä½¿é•œå¤´ç§»åŠ¨æ›´è‡ªç„¶æµç•…
```

### 4. ä¼˜åŒ– SVD ç”Ÿæˆå‚æ•°ï¼ˆ`video_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **æ¨ç†æ­¥æ•°**ï¼šåŠ¨ä½œåœºæ™¯å’Œé•œå¤´è¿åŠ¨åœºæ™¯ï¼Œæ¨ç†æ­¥æ•°è‡³å°‘ 45 æ­¥
- **decode_chunk_size**ï¼šåŠ¨ä½œåœºæ™¯å’Œé•œå¤´è¿åŠ¨åœºæ™¯ï¼Œè®¾ç½®ä¸º 6-7ï¼Œå¹³è¡¡è¿è´¯æ€§å’Œæµç•…åº¦

**ä»£ç ä½ç½®**ï¼š
```python
# video_generator.py, line 253-263
if motion_bucket_id >= 2.0:
    num_inference_steps = max(num_inference_steps, 45)
    decode_chunk_size = min(decode_chunk_size, 7)
    if decode_chunk_size < 6:
        decode_chunk_size = 6  # å¯¹äºé•œå¤´è¿åŠ¨ï¼Œå¯ä»¥ç¨å¾®å¤§ä¸€ç‚¹ï¼Œä¿æŒæµç•…åº¦
```

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

å®æ–½ä¸Šè¿°ä¼˜åŒ–åï¼Œé¢„æœŸï¼š
1. **é•œå¤´ç§»åŠ¨é—®é¢˜**ï¼šæ‰€æœ‰æœ‰ `motion` å­—æ®µçš„åœºæ™¯éƒ½ä¼šä½¿ç”¨ SVD å¹¶åº”ç”¨é€‚å½“çš„è¿åŠ¨å‚æ•°ï¼Œé•œå¤´ç§»åŠ¨ä¼šæ›´æ˜æ˜¾
2. **åŠ¨ä½œè‡ªç„¶åº¦**ï¼šé€šè¿‡æé«˜ `noise_aug_strength` å’Œä¼˜åŒ– `decode_chunk_size`ï¼ŒåŠ¨ä½œä¼šæ›´è‡ªç„¶æµç•…
3. **æ•´ä½“æµç•…åº¦**ï¼šé€šè¿‡å¢åŠ æ¨ç†æ­¥æ•°å’Œä¼˜åŒ–å‚æ•°ï¼Œæ•´ä½“è§†é¢‘æµç•…åº¦ä¼šæå‡

## ğŸ“‹ å‚æ•°è¯´æ˜

### motion_bucket_idï¼ˆè¿åŠ¨å¹…åº¦ï¼‰
- **1.5**ï¼šè½»å¾®è¿åŠ¨ï¼ˆé›¾æ°”ã€è½»é£ã€çµæ°”é£˜åŠ¨ï¼‰
- **1.8**ï¼šè½»å¾®åŠ¨ä½œï¼ˆè¡¨æƒ…å˜åŒ–ã€å¾®åŠ¨ï¼‰
- **2.0**ï¼šä¸­ç­‰è¿åŠ¨ï¼ˆé•œå¤´ç§»åŠ¨ã€ä¸­ç­‰åŠ¨ä½œã€ç‰©ä½“è¿åŠ¨ï¼‰
- **2.5**ï¼šæ˜æ˜¾åŠ¨ä½œï¼ˆæ”»å‡»ã€å¥”è·‘ã€è·³è·ƒï¼‰- ä½† SVD-XT æœ€å¤§å€¼ä¸º 2.0

### noise_aug_strengthï¼ˆè¿åŠ¨å¹³æ»‘åº¦ï¼‰
- **0.00025**ï¼šè½»å¾®è¿åŠ¨ï¼ˆé›¾æ°”ã€è½»é£ï¼‰
- **0.0003**ï¼šè½»å¾®åŠ¨ä½œã€é»˜è®¤åœºæ™¯
- **0.00035**ï¼šä¸­ç­‰åŠ¨ä½œã€é•œå¤´è¿åŠ¨ï¼ˆæ›´è‡ªç„¶æµç•…ï¼‰
- **0.0004**ï¼šæ˜æ˜¾åŠ¨ä½œï¼ˆä½†å¯èƒ½å¯¼è‡´è¿‡åº¦è¿åŠ¨ï¼‰

### decode_chunk_sizeï¼ˆå¸§é—´è¿è´¯æ€§ï¼‰
- **6-7**ï¼šåŠ¨ä½œåœºæ™¯ã€é•œå¤´è¿åŠ¨åœºæ™¯ï¼ˆå¹³è¡¡è¿è´¯æ€§å’Œæµç•…åº¦ï¼‰
- **8**ï¼šé»˜è®¤åœºæ™¯ï¼ˆSVD-XT æœ€ç¨³å®šèŒƒå›´ï¼‰

### num_inference_stepsï¼ˆç¨³å®šæ€§ï¼‰
- **40**ï¼šé»˜è®¤åœºæ™¯
- **45**ï¼šåŠ¨ä½œåœºæ™¯ã€é•œå¤´è¿åŠ¨åœºæ™¯ï¼ˆæé«˜ç¨³å®šæ€§å’Œæµç•…åº¦ï¼‰

## ğŸ” éªŒè¯æ–¹æ³•

1. **é‡æ–°ç”Ÿæˆè§†é¢‘**ï¼šä½¿ç”¨ä¼˜åŒ–åçš„ä»£ç é‡æ–°ç”Ÿæˆæ‰€æœ‰åœºæ™¯çš„è§†é¢‘
2. **æ£€æŸ¥é•œå¤´ç§»åŠ¨**ï¼šç¡®è®¤æ‰€æœ‰æœ‰ `motion` å­—æ®µçš„åœºæ™¯éƒ½æœ‰æ˜æ˜¾çš„é•œå¤´ç§»åŠ¨
3. **æ£€æŸ¥åŠ¨ä½œè‡ªç„¶åº¦**ï¼šç¡®è®¤åŠ¨ä½œåœºæ™¯çš„è¿åŠ¨æ•ˆæœæ›´è‡ªç„¶æµç•…

## ğŸ“ ä»£ç å˜æ›´æ–‡ä»¶

1. `gen_video/scene_motion_analyzer.py`
   - `analyze` æ–¹æ³•ï¼šå¢å¼ºé•œå¤´ç§»åŠ¨æ£€æµ‹ï¼Œä¼˜åŒ–åŠ¨ä½œè‡ªç„¶åº¦å‚æ•°

2. `gen_video/video_generator.py`
   - `generate_video` æ–¹æ³•ï¼šå¢å¼ºé•œå¤´è¿åŠ¨å‚æ•°ï¼Œä¼˜åŒ–åŠ¨ä½œè‡ªç„¶åº¦
   - `_generate_video_svd` æ–¹æ³•ï¼šä¼˜åŒ– SVD ç”Ÿæˆå‚æ•°

## âœ… è¯­æ³•æ£€æŸ¥

æ‰€æœ‰ä»£ç å·²é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚

