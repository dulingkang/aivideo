# æ¨èå®æ–½æ–¹æ¡ˆï¼šæå‡è§†é¢‘ç¨³å®šæ€§å’ŒåŠ¨ç”»æ•ˆæœ

## ğŸ¯ é—®é¢˜åˆ†æ

**å½“å‰é—®é¢˜**ï¼š
- SVD ç”Ÿæˆçš„è§†é¢‘è¿åŠ¨ä¸å¤Ÿè‡ªç„¶
- åŠ¨ç”»æ•ˆæœä¸å¤Ÿå¥½
- ç¨³å®šæ€§æœ‰å¾…æå‡

**æ ¹æœ¬åŸå› **ï¼š
- SVD æ›´é€‚åˆçœŸå®ç…§ç‰‡é£æ ¼ï¼Œå¯¹åŠ¨æ¼«æ”¯æŒæœ‰é™
- è¿åŠ¨æ§åˆ¶å‚æ•°æœ‰é™
- å¸§æ•°é™åˆ¶ï¼ˆ20-25å¸§ï¼‰

## ğŸ† æ¨èæ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### æ–¹æ¡ˆ1ï¼šSVD + RIFE æ’å¸§ â­â­â­â­â­ï¼ˆæœ€æ¨èï¼Œæœ€ç®€å•ï¼‰

**ä¸ºä»€ä¹ˆæ¨è**ï¼š
- âœ… **å®ç°æœ€ç®€å•**ï¼šä¸éœ€è¦æ¢æ¨¡å‹ï¼Œåªéœ€æ·»åŠ æ’å¸§
- âœ… **æ•ˆæœæå‡æ˜æ˜¾**ï¼šæ’å¸§å¯ä»¥æ˜¾è‘—æå‡æµç•…åº¦
- âœ… **é£é™©æœ€ä½**ï¼šä¸æ”¹å˜ç°æœ‰æµç¨‹
- âœ… **é€Ÿåº¦å¿«**ï¼šæ’å¸§æ¯”é‡æ–°ç”Ÿæˆå¿«å¾—å¤š

**å®æ–½æ­¥éª¤**ï¼š

#### 1. å®‰è£… RIFE
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ pipï¼ˆæ¨èï¼‰
pip install rife-ncnn-python

# æ–¹æ³•2ï¼šä½¿ç”¨å®˜æ–¹å®ç°
git clone https://github.com/megvii-research/ECCV2022-RIFE.git
cd ECCV2022-RIFE
pip install -r requirements.txt
```

#### 2. é›†æˆåˆ° video_generator.py
```python
def _interpolate_frames_rife(self, frames: List[np.ndarray], target_fps: int = 24) -> List[np.ndarray]:
    """ä½¿ç”¨ RIFE æ’å¸§å¢åŠ å¸§æ•°"""
    try:
        from rife import RIFE
        
        # åˆå§‹åŒ– RIFE
        rife = RIFE()
        
        # æ’å¸§ï¼šä»å½“å‰å¸§æ•°æ’åˆ°ç›®æ ‡å¸§æ•°
        current_fps = len(frames) / (len(frames) / 24)  # å‡è®¾åŸå§‹æ˜¯24fps
        scale = target_fps / current_fps
        
        interpolated = []
        for i in range(len(frames) - 1):
            interpolated.append(frames[i])
            # åœ¨æ¯ä¸¤å¸§ä¹‹é—´æ’å€¼
            mid_frame = rife.interpolate(frames[i], frames[i+1])
            interpolated.append(mid_frame)
        interpolated.append(frames[-1])
        
        return interpolated
    except ImportError:
        print("  âš  RIFE æœªå®‰è£…ï¼Œè·³è¿‡æ’å¸§")
        return frames
```

#### 3. ä¿®æ”¹ç”Ÿæˆæµç¨‹
```python
# åœ¨ _generate_video_svd ä¸­
# 1. ç”Ÿæˆå…³é”®å¸§ï¼ˆå‡å°‘å¸§æ•°ï¼Œæé«˜é€Ÿåº¦ï¼‰
frames = pipeline(
    image=image,
    num_frames=60,  # ä»120å‡å°‘åˆ°60
    ...
).frames

# 2. ä½¿ç”¨ RIFE æ’å¸§åˆ°ç›®æ ‡å¸§æ•°
frames = self._interpolate_frames_rife(frames, target_fps=24)
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç”Ÿæˆé€Ÿåº¦æ›´å¿«ï¼ˆç”Ÿæˆ60å¸§ï¼Œæ’åˆ°120å¸§ï¼‰
- âœ… æµç•…åº¦æ˜¾è‘—æå‡
- âœ… å®ç°ç®€å•

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦é¢å¤–çš„ RIFE æ¨¡å‹ï¼ˆçº¦100MBï¼‰
- âš ï¸ æ’å¸§è´¨é‡ä¾èµ– RIFE æ¨¡å‹

### æ–¹æ¡ˆ2ï¼šComfyUI AnimateDiff å·¥ä½œæµ â­â­â­â­ï¼ˆæœ€ç¨³å®šï¼Œæ•ˆæœæœ€å¥½ï¼‰

**ä¸ºä»€ä¹ˆæ¨è**ï¼š
- âœ… **æœ€ç¨³å®š**ï¼šComfyUI çš„ AnimateDiff å®ç°æœ€æˆç†Ÿ
- âœ… **æ•ˆæœæœ€å¥½**ï¼šä¸“ä¸ºåŠ¨æ¼«è®¾è®¡
- âœ… **æ”¯æŒ SDXL**ï¼šæœ‰ä¸“é—¨çš„ SDXL ç‰ˆæœ¬
- âœ… **æ”¯æŒ FreeInit**ï¼šå»é—ªçƒæ•ˆæœå¥½

**å®æ–½æ­¥éª¤**ï¼š

#### 1. å®‰è£… ComfyUI
```bash
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI
pip install -r requirements.txt
```

#### 2. å®‰è£… AnimateDiff èŠ‚ç‚¹
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/Kosinkadink/ComfyUI-AnimateDiff-Evolved.git
```

#### 3. é€šè¿‡ API è°ƒç”¨
```python
import requests
import json

def generate_video_comfyui(image_path: str, prompt: str) -> str:
    """é€šè¿‡ ComfyUI API ç”Ÿæˆè§†é¢‘"""
    
    # æ„å»ºå·¥ä½œæµ
    workflow = {
        "1": {
            "inputs": {
                "image": image_path,
                "clip": ["4", 0],
                "vae": ["5", 0]
            },
            "class_type": "IPAdapterApply"
        },
        # ... æ›´å¤šèŠ‚ç‚¹
    }
    
    # å‘é€è¯·æ±‚
    response = requests.post(
        "http://127.0.0.1:8188/prompt",
        json={"prompt": workflow}
    )
    
    return response.json()["prompt_id"]
```

**ä¼˜åŠ¿**ï¼š
- âœ… æœ€ç¨³å®š
- âœ… æ•ˆæœæœ€å¥½
- âœ… æ”¯æŒå¤æ‚å·¥ä½œæµ

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦å•ç‹¬è¿è¡Œ ComfyUI æœåŠ¡
- âš ï¸ éœ€è¦å­¦ä¹  ComfyUI å·¥ä½œæµ

### æ–¹æ¡ˆ3ï¼šAnimateDiff + ControlNetï¼ˆdiffusersï¼‰â­â­â­â­

**ä¸ºä»€ä¹ˆæ¨è**ï¼š
- âœ… åœ¨ diffusers æ¡†æ¶å†…
- âœ… é€šè¿‡ ControlNet æ§åˆ¶ç”Ÿæˆ
- âœ… å¯ä»¥ç»“åˆ IP-Adapter

**å®æ–½æ­¥éª¤**ï¼š

#### 1. ä¸‹è½½ ControlNet æ¨¡å‹
```bash
# Canny è¾¹ç¼˜æ£€æµ‹
huggingface-cli download lllyasviel/sd-controlnet-canny
```

#### 2. é›†æˆåˆ° video_generator.py
```python
def _load_animatediff_with_controlnet(self, model_path: str):
    """åŠ è½½ AnimateDiff + ControlNet"""
    from diffusers import AnimateDiffPipeline, MotionAdapter, ControlNetModel
    
    # åŠ è½½ ControlNet
    controlnet = ControlNetModel.from_pretrained(
        "lllyasviel/sd-controlnet-canny",
        torch_dtype=torch.float16
    )
    
    # åŠ è½½ AnimateDiff
    adapter = MotionAdapter.from_pretrained("guoyww/animatediff-motion-adapter-v1-5-2")
    pipe = AnimateDiffPipeline.from_pretrained(
        "runwayml/stable-diffusion-v1-5",
        motion_adapter=adapter,
        controlnet=controlnet,
        torch_dtype=torch.float16
    )
    
    # ç”Ÿæˆ Canny è¾¹ç¼˜å›¾
    canny_image = self._generate_canny_edge(image)
    
    # ç”Ÿæˆè§†é¢‘
    frames = pipe(
        prompt=prompt,
        image=canny_image,  # ControlNet è¾“å…¥
        num_frames=16,
        guidance_scale=7.5,
    ).frames
```

**ä¼˜åŠ¿**ï¼š
- âœ… åœ¨ç°æœ‰æ¡†æ¶å†…
- âœ… æ§åˆ¶æ›´ç²¾ç¡®
- âœ… æ•ˆæœè¾ƒå¥½

**ç¼ºç‚¹**ï¼š
- âš ï¸ åªæ”¯æŒ SD1.5ï¼ˆ768x768ï¼‰
- âš ï¸ éœ€è¦é¢å¤–çš„ ControlNet æ¨¡å‹

## ğŸ“‹ æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ç¨³å®šæ€§ | æ•ˆæœ | å®ç°éš¾åº¦ | æ¨èåº¦ | å®æ–½æ—¶é—´ |
|------|--------|------|----------|--------|----------|
| SVD + RIFE æ’å¸§ | â­â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­â­â­ | 1-2å¤© |
| ComfyUI AnimateDiff | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | 1-2å‘¨ |
| AnimateDiff + ControlNet | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | 1-2å‘¨ |

## ğŸš€ å¿«é€Ÿå®æ–½å»ºè®®

### é˜¶æ®µ1ï¼šç«‹å³å®æ–½ï¼ˆ1-2å¤©ï¼‰- SVD + RIFE æ’å¸§

**æ­¥éª¤**ï¼š
1. å®‰è£… RIFE
2. é›†æˆåˆ° video_generator.py
3. æµ‹è¯•æ•ˆæœ

**é¢„æœŸæ•ˆæœ**ï¼š
- âœ… æµç•…åº¦æå‡ 50%+
- âœ… ç”Ÿæˆé€Ÿåº¦æå‡ 30%+
- âœ… è¿åŠ¨æ›´è‡ªç„¶

### é˜¶æ®µ2ï¼šä¸­æœŸæå‡ï¼ˆ1-2å‘¨ï¼‰- ComfyUI AnimateDiff

**æ­¥éª¤**ï¼š
1. å®‰è£… ComfyUI
2. é…ç½®å·¥ä½œæµ
3. é€šè¿‡ API é›†æˆ

**é¢„æœŸæ•ˆæœ**ï¼š
- âœ… æ•ˆæœæ¥è¿‘ä¸“ä¸šåŠ¨æ¼«
- âœ… ç¨³å®šæ€§æœ€é«˜
- âœ… æ”¯æŒå¤æ‚åœºæ™¯

### é˜¶æ®µ3ï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰- å®Œæ•´å·¥ä½œæµ

**æ­¥éª¤**ï¼š
1. é›†æˆ FreeInit
2. ä¼˜åŒ–å‚æ•°
3. å»ºç«‹å®Œæ•´æµç¨‹

## ğŸ’¡ å…³é”®å»ºè®®

1. **ä¼˜å…ˆå°è¯• SVD + RIFE æ’å¸§**
   - å®ç°æœ€ç®€å•
   - æ•ˆæœæå‡æ˜æ˜¾
   - é£é™©æœ€ä½

2. **å¦‚æœæ•ˆæœä»ä¸æ»¡æ„ï¼Œå†è€ƒè™‘ ComfyUI**
   - æœ€ç¨³å®š
   - æ•ˆæœæœ€å¥½
   - ä½†éœ€è¦å­¦ä¹ æˆæœ¬

3. **ä¿æŒç°æœ‰æµç¨‹**
   - ä¸è¦ä¸€æ¬¡æ€§å¤§æ”¹
   - é€æ­¥ä¼˜åŒ–
   - æµ‹è¯•æ¯ä¸ªé˜¶æ®µçš„æ•ˆæœ

## ğŸ“ å®æ–½æ£€æŸ¥æ¸…å•

### SVD + RIFE æ’å¸§
- [ ] å®‰è£… RIFE
- [ ] é›†æˆåˆ° video_generator.py
- [ ] æµ‹è¯•æ’å¸§æ•ˆæœ
- [ ] ä¼˜åŒ–æ’å¸§å‚æ•°
- [ ] æ›´æ–°é…ç½®æ–‡ä»¶

### ComfyUI AnimateDiffï¼ˆå¯é€‰ï¼‰
- [ ] å®‰è£… ComfyUI
- [ ] å®‰è£… AnimateDiff èŠ‚ç‚¹
- [ ] é…ç½®å·¥ä½œæµ
- [ ] é€šè¿‡ API é›†æˆ
- [ ] æµ‹è¯•æ•ˆæœ

## âœ… æ€»ç»“

**æ¨èæ–¹æ¡ˆ**ï¼š**SVD + RIFE æ’å¸§**

**ç†ç”±**ï¼š
- âœ… å®ç°æœ€ç®€å•ï¼ˆ1-2å¤©ï¼‰
- âœ… æ•ˆæœæå‡æ˜æ˜¾
- âœ… é£é™©æœ€ä½
- âœ… ä¸éœ€è¦æ¢æ¨¡å‹

**å¦‚æœæ•ˆæœä»ä¸æ»¡æ„**ï¼Œå†è€ƒè™‘ï¼š
- ComfyUI AnimateDiffï¼ˆæœ€ç¨³å®šï¼Œæ•ˆæœæœ€å¥½ï¼‰
- AnimateDiff + ControlNetï¼ˆå¹³è¡¡æ–¹æ¡ˆï¼‰

**å…³é”®**ï¼šå…ˆå°è¯•æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œé€æ­¥ä¼˜åŒ–ï¼Œä¸è¦ä¸€æ¬¡æ€§å¤§æ”¹ã€‚

