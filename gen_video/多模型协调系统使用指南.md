# å¤šæ¨¡å‹åè°ƒè°ƒç”¨ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## âœ… æ‰€æœ‰æ¨¡å‹ä¸‹è½½çŠ¶æ€

| æ¨¡å‹ | çŠ¶æ€ | å¤§å° | ç±»å‹ |
|------|------|------|------|
| **Flux.1** | âœ… å®Œæ•´ | 53.91 GB | diffusers |
| **Flux.2** | âœ… å®Œæ•´ | 53.87 GB | diffusers |
| **Kolors-base** | âœ… å®Œæ•´ | 26.99 GB | diffusers |
| **Hunyuan-DiT** | âœ… å®Œæ•´ | 26.71 GB | custom (End2End) |
| **SD3.5 Large Turbo** | âœ… å®Œæ•´ | 40.81 GB | diffusers |

**æ€»ä½“çŠ¶æ€**: âœ… **æ‰€æœ‰æ¨¡å‹å·²å°±ç»ª**

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„

```
gen_video/
â”œâ”€â”€ models/              # æ¨¡å‹æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ flux1-dev/
â”‚   â”œâ”€â”€ flux2-dev/
â”‚   â”œâ”€â”€ kolors-base/
â”‚   â”œâ”€â”€ hunyuan-dit/
â”‚   â””â”€â”€ sd3-turbo/
â”œâ”€â”€ pipelines/           # Pipeline å®ç°
â”‚   â”œâ”€â”€ base_pipeline.py      # åŸºç±»æ¥å£
â”‚   â”œâ”€â”€ flux_pipeline.py      # Flux Pipeline
â”‚   â”œâ”€â”€ kolors_pipeline.py    # Kolors Pipeline
â”‚   â”œâ”€â”€ sd3_pipeline.py       # SD3 Turbo Pipeline
â”‚   â””â”€â”€ hunyuan_pipeline.py   # Hunyuan-DiT Pipeline
â””â”€â”€ model_manager.py    # ç»Ÿä¸€ç®¡ç†å™¨
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

```python
from model_manager import ModelManager

# åˆ›å»ºç®¡ç†å™¨ï¼ˆå»¶è¿ŸåŠ è½½ï¼ŒèŠ‚çœæ˜¾å­˜ï¼‰
manager = ModelManager(lazy_load=True)

# ç”Ÿæˆç§‘æ™®ä¸»æŒäººè„¸ï¼ˆè‡ªåŠ¨ä½¿ç”¨ Kolorsï¼‰
img = manager.generate(
    task="host_face",
    prompt="ä¸€ä½æ¸©æš–äº²å’Œçš„ä¸­å›½ç§‘æ™®ä¸»æŒäººï¼Œæ­£é¢å¯¹é•œå¤´ï¼Œä¸“ä¸šå½¢è±¡",
    width=1024,
    height=1024
)
img.save("host_face.png")
```

### 2. ç”Ÿæˆç§‘å­¦èƒŒæ™¯ï¼ˆè‡ªåŠ¨ä½¿ç”¨ Flux.2ï¼‰

```python
img = manager.generate(
    task="science_background",
    prompt="é‡å­è®¡ç®—æœºæ ¸å¿ƒå…‰å­¦å…ƒä»¶ï¼Œè“è‰²å…‰æ™•ï¼Œé«˜ç§‘æŠ€ï¼Œæœªæ¥æ„Ÿ",
    width=1024,
    height=1024
)
img.save("science_background.png")
```

### 3. ç”Ÿæˆå®˜æ–¹é£æ ¼ç§‘æ•™å›¾ï¼ˆè‡ªåŠ¨ä½¿ç”¨ Hunyuan-DiTï¼‰

```python
img = manager.generate(
    task="official_style",
    prompt="ä¸­å›½ç©ºé—´ç«™å†…éƒ¨ï¼Œèˆªå¤©å‘˜æ“ä½œç§‘å­¦å®éªŒï¼Œé«˜çº§å®£ä¼ é£",
    width=1024,
    height=1024
)
img.save("official_style.png")
```

### 4. å¿«é€Ÿæ‰¹é‡ç”Ÿæˆï¼ˆè‡ªåŠ¨ä½¿ç”¨ SD3 Turboï¼‰

```python
img = manager.generate(
    task="fast_background",
    prompt="æ•™å®¤é‡Œçš„å­©å­ä»¬åœ¨ä¸Šç§‘å­¦è¯¾",
    width=1024,
    height=1024
)
img.save("fast_background.png")
```

---

## ğŸ“‹ ä»»åŠ¡è·¯ç”±è¡¨

ç³»ç»Ÿä¼šæ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ¨¡å‹ï¼š

| ä»»åŠ¡ç±»å‹ | ä½¿ç”¨çš„æ¨¡å‹ | è¯´æ˜ |
|---------|-----------|------|
| `host_face` | Kolors | ç§‘æ™®ä¸»æŒäººè„¸ |
| `character_face` | Kolors | è§’è‰²äººè„¸ |
| `realistic_face` | Kolors | çœŸå®æ„Ÿäººè„¸ |
| `science_background` | Flux.2 | ç§‘å­¦èƒŒæ™¯å›¾ï¼ˆå†²å‡»åŠ›å¼ºï¼‰ |
| `quantum_particle` | Flux.2 | é‡å­/ç²’å­åœºæ™¯ |
| `space_cosmos` | Flux.2 | å¤ªç©º/å®‡å®™åœºæ™¯ |
| `lab_scene` | Flux.1 | å®éªŒå®¤åœºæ™¯ï¼ˆæ›´å¹²å‡€è‡ªç„¶ï¼‰ |
| `medical_scene` | Flux.1 | åŒ»å­¦åœºæ™¯ |
| `official_style` | Hunyuan-DiT | å®˜æ–¹æ„Ÿç§‘æ•™å®£ä¼ å›¾ |
| `chinese_scene` | Hunyuan-DiT | ä¸­æ–‡åœºæ™¯ |
| `education_style` | Hunyuan-DiT | æ•™è‚²é£æ ¼ |
| `fast_background` | SD3 Turbo | å¿«é€ŸèƒŒæ™¯ |
| `batch_generation` | SD3 Turbo | æ‰¹é‡ç”Ÿæˆ |
| `variations` | SD3 Turbo | å¤‡é€‰å›¾ |

---

## ğŸ¨ å®Œæ•´ç¤ºä¾‹

```python
from model_manager import ModelManager
from pathlib import Path

# åˆ›å»ºç®¡ç†å™¨
manager = ModelManager(lazy_load=True)

# ç¤ºä¾‹ 1: ç§‘æ™®ä¸»æŒäººè„¸
print("ç”Ÿæˆç§‘æ™®ä¸»æŒäººè„¸...")
img1 = manager.generate(
    task="host_face",
    prompt="ä¸€ä½æ¸©æš–äº²å’Œçš„ä¸­å›½ç§‘æ™®ä¸»æŒäººï¼Œæ­£é¢å¯¹é•œå¤´ï¼Œä¸“ä¸šå½¢è±¡ï¼Œå¾®ç¬‘",
    width=1024,
    height=1024,
    seed=42
)
img1.save("outputs/host_face.png")
print("âœ… å·²ä¿å­˜: outputs/host_face.png")

# ç¤ºä¾‹ 2: ç§‘å­¦èƒŒæ™¯
print("ç”Ÿæˆç§‘å­¦èƒŒæ™¯...")
img2 = manager.generate(
    task="science_background",
    prompt="é‡å­è®¡ç®—æœºæ ¸å¿ƒå…‰å­¦å…ƒä»¶ï¼Œè“è‰²å…‰æ™•ï¼Œé«˜ç§‘æŠ€ï¼Œæœªæ¥æ„Ÿï¼Œç§‘æŠ€æ„Ÿ",
    width=1024,
    height=1024,
    seed=42
)
img2.save("outputs/science_background.png")
print("âœ… å·²ä¿å­˜: outputs/science_background.png")

# ç¤ºä¾‹ 3: å®˜æ–¹é£æ ¼
print("ç”Ÿæˆå®˜æ–¹é£æ ¼ç§‘æ•™å›¾...")
img3 = manager.generate(
    task="official_style",
    prompt="ä¸­å›½ç©ºé—´ç«™å†…éƒ¨ï¼Œèˆªå¤©å‘˜æ“ä½œç§‘å­¦å®éªŒï¼Œé«˜çº§å®£ä¼ é£ï¼Œä¸“ä¸š",
    width=1024,
    height=1024,
    seed=42
)
img3.save("outputs/official_style.png")
print("âœ… å·²ä¿å­˜: outputs/official_style.png")

# ç¤ºä¾‹ 4: å¿«é€Ÿç”Ÿæˆ
print("å¿«é€Ÿç”ŸæˆèƒŒæ™¯...")
img4 = manager.generate(
    task="fast_background",
    prompt="æ•™å®¤é‡Œçš„å­©å­ä»¬åœ¨ä¸Šç§‘å­¦è¯¾ï¼Œæ˜äº®ï¼Œæ¸©é¦¨",
    width=1024,
    height=1024,
    seed=42
)
img4.save("outputs/fast_background.png")
print("âœ… å·²ä¿å­˜: outputs/fast_background.png")

# é‡Šæ”¾æ˜¾å­˜
manager.unload()
print("âœ… æ‰€æœ‰æ¨¡å‹å·²å¸è½½")
```

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. æ‰‹åŠ¨æŒ‡å®šæ¨¡å‹

```python
# ç›´æ¥ä½¿ç”¨æŒ‡å®šæ¨¡å‹ï¼ˆè·³è¿‡è·¯ç”±ï¼‰
pipeline = manager._get_pipeline("flux2")
img = pipeline.generate(
    prompt="æµ‹è¯•æç¤ºè¯",
    width=1024,
    height=1024
)
```

### 2. è‡ªå®šä¹‰å‚æ•°

```python
img = manager.generate(
    task="host_face",
    prompt="æç¤ºè¯",
    num_inference_steps=30,  # è‡ªå®šä¹‰æ­¥æ•°
    guidance_scale=8.0,      # è‡ªå®šä¹‰å¼•å¯¼å¼ºåº¦
    seed=123,                # å›ºå®šéšæœºç§å­
    width=1280,              # è‡ªå®šä¹‰å°ºå¯¸
    height=768
)
```

### 3. æ˜¾å­˜ç®¡ç†

```python
# å»¶è¿ŸåŠ è½½ï¼ˆé»˜è®¤ï¼‰ï¼šåªåœ¨éœ€è¦æ—¶åŠ è½½æ¨¡å‹
manager = ModelManager(lazy_load=True)

# é¢„åŠ è½½æ‰€æœ‰æ¨¡å‹
manager = ModelManager(lazy_load=False)

# æ‰‹åŠ¨å¸è½½æ¨¡å‹
manager.unload("flux2")  # å¸è½½æŒ‡å®šæ¨¡å‹
manager.unload()         # å¸è½½æ‰€æœ‰æ¨¡å‹
```

### 4. æ£€æŸ¥æ¨¡å‹çŠ¶æ€

```python
status = manager.list_models()
for model_name, info in status.items():
    print(f"{model_name}: å­˜åœ¨={info['exists']}, å·²åŠ è½½={info['loaded']}")
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### æ¨¡å‹è·¯å¾„é…ç½®

é»˜è®¤æ¨¡å‹è·¯å¾„åœ¨ `model_manager.py` ä¸­é…ç½®ï¼š

```python
self.model_paths = {
    "flux1": str(models_root / "flux1-dev"),
    "flux2": str(models_root / "flux2-dev"),
    "kolors": str(models_root / "kolors-base"),
    "hunyuan": str(models_root / "hunyuan-dit" / "t2i"),
    "sd3": str(models_root / "sd3-turbo"),
}
```

### ä»»åŠ¡è·¯ç”±é…ç½®

å¯ä»¥åœ¨ `model_manager.py` ä¸­ä¿®æ”¹ `routing_table` æ¥è‡ªå®šä¹‰è·¯ç”±è§„åˆ™ã€‚

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç§‘æ™®è§†é¢‘æµæ°´çº¿

```python
# æ­¥éª¤ 1: ç”Ÿæˆä¸»æŒäººè„¸ï¼ˆå›ºå®šï¼‰
host_face = manager.generate(
    task="host_face",
    prompt="ç§‘æ™®ä¸»æŒäººï¼Œä¸“ä¸šå½¢è±¡",
    seed=42  # å›ºå®šç§å­ï¼Œä¿è¯ä¸€è‡´æ€§
)

# æ­¥éª¤ 2: ç”Ÿæˆç§‘å­¦èƒŒæ™¯ï¼ˆæ ¹æ®å†…å®¹é€‰æ‹©ï¼‰
if "é‡å­" in content or "ç²’å­" in content:
    background = manager.generate(
        task="quantum_particle",
        prompt=content_prompt
    )
elif "å®éªŒå®¤" in content:
    background = manager.generate(
        task="lab_scene",
        prompt=content_prompt
    )
else:
    background = manager.generate(
        task="science_background",
        prompt=content_prompt
    )

# æ­¥éª¤ 3: åˆæˆè§†é¢‘...
```

### 2. æ‰¹é‡ç”Ÿæˆå¤‡é€‰å›¾

```python
# ä½¿ç”¨ SD3 Turbo å¿«é€Ÿç”Ÿæˆå¤šä¸ªå¤‡é€‰
for i in range(5):
    img = manager.generate(
        task="batch_generation",
        prompt=prompt,
        seed=i,  # ä¸åŒç§å­ç”Ÿæˆä¸åŒå˜ä½“
        width=1024,
        height=1024
    )
    img.save(f"variations/variant_{i}.png")
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ˜¾å­˜ç®¡ç†**: ä½¿ç”¨ `lazy_load=True` å¯ä»¥èŠ‚çœæ˜¾å­˜ï¼Œåªåœ¨éœ€è¦æ—¶åŠ è½½æ¨¡å‹
2. **Hunyuan-DiT**: éœ€è¦å®‰è£…å®˜æ–¹ä¾èµ–ï¼Œå¯èƒ½éœ€è¦ç‹¬ç«‹ç¯å¢ƒ
3. **æ¨¡å‹å†²çª**: ä¸ä¼šå†²çªï¼Œæ¯ä¸ªæ¨¡å‹ç‹¬ç«‹ç›®å½•å’Œé…ç½®
4. **æ€§èƒ½ä¼˜åŒ–**: SD3 Turbo æœ€å¿«ï¼Œé€‚åˆæ‰¹é‡ç”Ÿæˆï¼›Flux è´¨é‡æœ€é«˜ï¼Œé€‚åˆæœ€ç»ˆè¾“å‡º

---

## ğŸ“š å‚è€ƒ

- æ¨¡å‹ä¸‹è½½çŠ¶æ€: æ‰€æœ‰æ¨¡å‹å·²å°±ç»ª âœ…
- Pipeline å®ç°: `pipelines/` ç›®å½•
- ç®¡ç†å™¨ä»£ç : `model_manager.py`
- ä½¿ç”¨ç¤ºä¾‹: è§æœ¬æ–‡æ¡£

