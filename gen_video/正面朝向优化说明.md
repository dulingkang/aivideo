# æ­£é¢æœå‘ä¼˜åŒ–è¯´æ˜

## ğŸ“Š é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆå¾ˆå¤šå¸¦äººç‰©çš„åœºæ™¯ï¼ŒåŸºæœ¬éƒ½æ˜¯èƒŒå½±ã€‚è¿™æ˜¯ä¸€ä¸ªè§†è§’é—®é¢˜ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰äººç‰©åœºæ™¯é»˜è®¤æ˜¾ç¤ºæ­£é¢è€ŒéèƒŒå½±ã€‚

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. å¢å¼ºæ­£é¢æœå‘æç¤ºï¼ˆ`image_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **é»˜è®¤æ­£é¢æœå‘**ï¼šå¯¹äºæ‰€æœ‰äººç‰©åœºæ™¯ï¼Œå¦‚æœè§†è§’ä¸æ˜¯èƒŒé¢ï¼Œéƒ½æ·»åŠ æ­£é¢æœå‘æç¤º
- **æé«˜æƒé‡**ï¼šæ­£é¢æœå‘æç¤ºæƒé‡è‡³å°‘ `1.8`ï¼Œæ˜ç¡®è¦æ±‚æ­£é¢æ—¶ä½¿ç”¨ `2.0`
- **å¢å¼ºæè¿°**ï¼šæ·»åŠ æ›´å¤šæ­£é¢æœå‘å…³é”®è¯ï¼Œå¦‚ `frontal view`

**ä»£ç ä½ç½®**ï¼š
```python
# image_generator.py, line 2454-2472
# å¯¹äºæ‰€æœ‰äººç‰©åœºæ™¯ï¼Œé»˜è®¤æ·»åŠ æ­£é¢æœå‘æç¤ºï¼ˆé™¤éæ˜ç¡®è¦æ±‚èƒŒé¢ï¼‰
if viewpoint_type != 'back':
    # å¦‚æœæ˜ç¡®è¦æ±‚æ­£é¢ï¼Œä½¿ç”¨æ›´é«˜æƒé‡ï¼›å¦åˆ™ä½¿ç”¨é»˜è®¤é«˜æƒé‡
    if viewpoint_explicit and viewpoint_type == 'front':
        final_weight = 2.0
    elif viewpoint_type == 'front':
        final_weight = max(viewpoint_weight, 1.8)  # è‡³å°‘1.8ï¼Œç¡®ä¿æ­£é¢æœå‘æ˜æ˜¾
    else:
        final_weight = 1.8  # é»˜è®¤é«˜æƒé‡ï¼Œç¡®ä¿æ­£é¢æœå‘
    
    facing_prompt = f"(facing camera, front view, face forward, character facing viewer, frontal view:{final_weight:.2f})"
    priority_parts.insert(insert_pos, facing_prompt)
```

### 2. å¢å¼ºè´Ÿé¢æç¤ºæƒé‡ï¼ˆ`image_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **æé«˜è´Ÿé¢æç¤ºæƒé‡**ï¼š
  - æ˜ç¡®è¦æ±‚æ­£é¢ï¼š`1.8`ï¼ˆä» `1.5` æé«˜ï¼‰
  - é»˜è®¤æ­£é¢ï¼š`1.6`ï¼ˆä»æ— æƒé‡æé«˜ï¼‰
- **æ·»åŠ æ›´å¤šè´Ÿé¢å…³é”®è¯**ï¼šå¦‚ `back facing`

**ä»£ç ä½ç½®**ï¼š
```python
# image_generator.py, line 3827-3840
# å¯¹äºæ‰€æœ‰éèƒŒé¢åœºæ™¯ï¼Œéƒ½å¢å¼ºè´Ÿé¢æç¤ºæƒé‡ï¼Œç¡®ä¿æ’é™¤èƒŒå½±
if viewpoint_type_check != 'back':
    if viewpoint_explicit_check and viewpoint_type_check == 'front':
        enhanced_negative += ", back view:1.8, from behind:1.8, character back:1.8, ..."
    else:
        enhanced_negative += ", back view:1.6, from behind:1.6, character back:1.6, ..."
```

### 3. ä¼˜åŒ– character_pose å¤„ç†ï¼ˆ`image_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **é»˜è®¤æ­£é¢æœå‘**ï¼šå¦‚æœ `character_pose` ä¸­æ²¡æœ‰æ˜ç¡®æŒ‡å®šæœå‘ï¼Œé»˜è®¤æ·»åŠ æ­£é¢æœå‘
- **æ£€æµ‹èƒŒé¢å…³é”®è¯**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ `back`, `èƒŒé¢`, `èƒŒå` ç­‰å…³é”®è¯
- **æé«˜æƒé‡**ï¼šæ­£é¢æœå‘æç¤ºæƒé‡æé«˜åˆ° `1.8`

**ä»£ç ä½ç½®**ï¼š
```python
# image_generator.py, line 2514-2535
# æ£€æŸ¥æ˜¯å¦åŒ…å«æ­£é¢æœå‘å…³é”®è¯
has_facing = any(kw in pose_lower for kw in ["facing", "front", "æ­£é¢", ...])
has_back = any(kw in pose_lower for kw in ["back", "èƒŒé¢", "èƒŒå", ...])

if has_facing:
    priority_parts.append(f"({character_pose}:1.8)")
    priority_parts.append("(facing camera, front view, face forward, frontal view:1.8)")
elif has_back:
    priority_parts.append(f"({character_pose}:1.3)")
else:
    # å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šæœå‘ï¼Œé»˜è®¤æ·»åŠ æ­£é¢æœå‘
    priority_parts.append(f"({character_pose}, facing camera, front view:1.8)")
```

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

å®æ–½ä¸Šè¿°ä¿®å¤åï¼Œé¢„æœŸï¼š
1. **æ‰€æœ‰äººç‰©åœºæ™¯é»˜è®¤æ­£é¢**ï¼šé™¤éæ˜ç¡®è¦æ±‚èƒŒé¢ï¼Œæ‰€æœ‰äººç‰©åœºæ™¯éƒ½ä¼šæ˜¾ç¤ºæ­£é¢
2. **æ­£é¢æœå‘æ›´æ˜æ˜¾**ï¼šé€šè¿‡æé«˜æƒé‡åˆ° `1.8-2.0`ï¼Œç¡®ä¿æ­£é¢æœå‘æ˜æ˜¾
3. **èƒŒå½±æ›´å°‘**ï¼šé€šè¿‡å¢å¼ºè´Ÿé¢æç¤ºæƒé‡åˆ° `1.6-1.8`ï¼Œæ›´æœ‰æ•ˆåœ°æ’é™¤èƒŒå½±

## ğŸ“‹ å‚æ•°è¯´æ˜

### æ­£é¢æœå‘æç¤ºæƒé‡
- **1.8**ï¼šé»˜è®¤æ­£é¢æœå‘ï¼ˆæ‰€æœ‰éèƒŒé¢åœºæ™¯ï¼‰
- **2.0**ï¼šæ˜ç¡®è¦æ±‚æ­£é¢

### è´Ÿé¢æç¤ºæƒé‡
- **1.6**ï¼šé»˜è®¤æ­£é¢åœºæ™¯ï¼ˆæ’é™¤èƒŒå½±ï¼‰
- **1.8**ï¼šæ˜ç¡®è¦æ±‚æ­£é¢åœºæ™¯ï¼ˆæ›´å¼ºçƒˆæ’é™¤èƒŒå½±ï¼‰

## ğŸ“ ä»£ç å˜æ›´æ–‡ä»¶

1. `gen_video/image_generator.py`
   - `_build_prompt` æ–¹æ³•ï¼šå¢å¼ºæ­£é¢æœå‘æç¤ºï¼Œä¼˜åŒ– character_pose å¤„ç†
   - `_generate_image_instantid` æ–¹æ³•ï¼šå¢å¼ºè´Ÿé¢æç¤ºæƒé‡

## âœ… è¯­æ³•æ£€æŸ¥

æ‰€æœ‰ä»£ç å·²é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚

