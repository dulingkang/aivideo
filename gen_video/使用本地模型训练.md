# ä½¿ç”¨æœ¬åœ°æ¨¡å‹è®­ç»ƒé£æ ¼LoRA

## ğŸ“‹ é—®é¢˜è¯´æ˜

è®­ç»ƒè„šæœ¬é»˜è®¤ä½¿ç”¨ `stabilityai/stable-diffusion-xl-base-1.0`ï¼Œä¼šä»HuggingFaceä¸‹è½½æ¨¡å‹ã€‚ä½†å®é™…ä¸Šæœ¬åœ°å·²ç»æœ‰å®Œæ•´çš„SDXLæ¨¡å‹åœ¨ `gen_video/models/sdxl-base/`ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ³•1ï¼šä¿®æ”¹è®­ç»ƒè„šæœ¬ä½¿ç”¨æœ¬åœ°è·¯å¾„ï¼ˆæ¨èï¼‰

è®­ç»ƒè„šæœ¬å·²ç»æ›´æ–°ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å‹è·¯å¾„ï¼š

```bash
# ä½¿ç”¨æœ¬åœ°æ¨¡å‹è·¯å¾„
--pretrained_model_name_or_path /vepfs-dev/shawn/vid/fanren/gen_video/models/sdxl-base
```

### æ–¹æ³•2ï¼šè®¾ç½®ç¯å¢ƒå˜é‡

```bash
export HF_HOME=/vepfs-dev/shawn/vid/fanren/gen_video/models/.cache
export TRANSFORMERS_CACHE=/vepfs-dev/shawn/vid/fanren/gen_video/models/.cache
```

### æ–¹æ³•3ï¼šä½¿ç”¨ç¬¦å·é“¾æ¥

å¦‚æœHuggingFace cacheåœ¨å…¶ä»–ä½ç½®ï¼Œå¯ä»¥åˆ›å»ºç¬¦å·é“¾æ¥ï¼š

```bash
# æ£€æŸ¥HuggingFace cacheä½ç½®
python -c "from huggingface_hub import snapshot_download; import os; print(os.path.expanduser('~/.cache/huggingface/hub'))"

# åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
ln -s /vepfs-dev/shawn/vid/fanren/gen_video/models/sdxl-base ~/.cache/huggingface/hub/models--stabilityai--stable-diffusion-xl-base-1.0
```

## ğŸ” æ£€æŸ¥æœ¬åœ°æ¨¡å‹

```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls -lh gen_video/models/sdxl-base/text_encoder_2/model.safetensors
ls -lh gen_video/models/sdxl-base/text_encoder/model.safetensors
ls -lh gen_video/models/sdxl-base/unet/diffusion_pytorch_model.safetensors

# æ£€æŸ¥æ¨¡å‹ç´¢å¼•
cat gen_video/models/sdxl-base/model_index.json
```

## ğŸ“ å·²æ›´æ–°çš„è„šæœ¬

ä»¥ä¸‹è„šæœ¬å·²æ›´æ–°ä¸ºä½¿ç”¨æœ¬åœ°æ¨¡å‹è·¯å¾„ï¼š

- `scripts/train_style_lora.sh`
- `scripts/train_style_lora_simple.sh`

## ğŸš€ è¿è¡Œè®­ç»ƒ

ç°åœ¨å¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸ä¼šé‡å¤ä¸‹è½½æ¨¡å‹ï¼š

```bash
bash scripts/train_style_lora.sh
```

æˆ–

```bash
bash scripts/train_style_lora_simple.sh
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿æ¨¡å‹å®Œæ•´**ï¼šæœ¬åœ°æ¨¡å‹å¿…é¡»åŒ…å«æ‰€æœ‰å¿…éœ€æ–‡ä»¶
   - `text_encoder/model.safetensors`
   - `text_encoder_2/model.safetensors`
   - `unet/diffusion_pytorch_model.safetensors`
   - `vae/` ç›®å½•ï¼ˆå¦‚æœä½¿ç”¨è‡ªå®šä¹‰VAEï¼‰

2. **å¦‚æœæ¨¡å‹ä¸å®Œæ•´**ï¼šå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ç¼ºå¤±çš„éƒ¨åˆ†ï¼Œæˆ–ä½¿ç”¨HuggingFaceä¸‹è½½ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰

3. **ç¼“å­˜ä½ç½®**ï¼šå¦‚æœä½¿ç”¨æœ¬åœ°è·¯å¾„ï¼ŒHuggingFaceä¸ä¼šä½¿ç”¨cacheï¼Œç›´æ¥ä»æœ¬åœ°åŠ è½½

