# è§†é¢‘é—ªåŠ¨é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ“Š é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆè§†é¢‘ä¸­åŠ¨èµ·æ¥çš„éƒ¨åˆ†æ˜¯**é—ªåŠ¨ã€ä¸ç¨³å®š**ã€‚è¿™æ˜¯ä¸€ä¸ªè§†é¢‘ç”Ÿæˆè´¨é‡é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç”±äºï¼š
1. `noise_aug_strength` å¤ªé«˜ï¼Œå¯¼è‡´ç”»é¢ä¸ç¨³å®š
2. `motion_bucket_id` å¤ªé«˜ï¼Œå¯¼è‡´è¿åŠ¨è¿‡åº¦
3. `decode_chunk_size` ä¸åˆé€‚ï¼Œå¯¼è‡´å¸§é—´ä¸è¿è´¯
4. `num_inference_steps` ä¸å¤Ÿï¼Œå¯¼è‡´è´¨é‡ä¸ç¨³å®š

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. é™ä½è¿åŠ¨å‚æ•°ï¼Œå‡å°‘é—ªåŠ¨ï¼ˆ`scene_motion_analyzer.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **ç‰©ä½“å±•å¼€è¿åŠ¨**ï¼š`motion_bucket_id` ä» `2.0` é™ä½åˆ° `1.8`ï¼Œ`noise_aug_strength` ä» `0.00035` é™ä½åˆ° `0.0003`
- **ç‰©ä½“æ—‹è½¬/ä¸Šå‡/ä¸‹é™è¿åŠ¨**ï¼š`motion_bucket_id` ä» `2.0` é™ä½åˆ° `1.8`ï¼Œ`noise_aug_strength` ä» `0.00035` é™ä½åˆ° `0.0003`
- **é•œå¤´è¿åŠ¨ï¼ˆpan/tilt/dolly/orbitï¼‰**ï¼š`motion_bucket_id` ä» `2.0` é™ä½åˆ° `1.8`ï¼Œ`noise_aug_strength` ä¿æŒ `0.0003`
- **é•œå¤´ç¼©æ”¾ï¼ˆzoomï¼‰**ï¼š`motion_bucket_id` ä» `1.8` é™ä½åˆ° `1.7`ï¼Œ`noise_aug_strength` ä¿æŒ `0.0003`
- **ä¸­ç­‰äººç‰©åŠ¨ä½œ**ï¼š`motion_bucket_id` ä» `2.0` é™ä½åˆ° `1.8`ï¼Œ`noise_aug_strength` ä» `0.00035` é™ä½åˆ° `0.0003`

**ä»£ç ä½ç½®**ï¼š
```python
# scene_motion_analyzer.py
# ç‰©ä½“å±•å¼€è¿åŠ¨
result["motion_bucket_id_override"] = 1.8  # é™ä½åˆ°1.8ï¼Œå‡å°‘é—ªåŠ¨
result["noise_aug_strength_override"] = 0.0003  # é™ä½åˆ°0.0003ï¼Œå‡å°‘é—ªåŠ¨

# é•œå¤´è¿åŠ¨
result["motion_bucket_id_override"] = 1.8  # é™ä½åˆ°1.8ï¼Œå‡å°‘é—ªåŠ¨
result["noise_aug_strength_override"] = 0.0003  # ä¿æŒ0.0003ï¼Œå‡å°‘é—ªåŠ¨
```

### 2. é™åˆ¶è¿åŠ¨å‚æ•°ä¸Šé™ï¼Œå‡å°‘é—ªåŠ¨ï¼ˆ`video_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **ç‰©ä½“è¿åŠ¨**ï¼šé™åˆ¶ `motion_bucket_id <= 1.8`ï¼Œ`noise_aug_strength <= 0.0003`
- **é•œå¤´è¿åŠ¨**ï¼šé™åˆ¶ `motion_bucket_id <= 1.8`ï¼Œ`noise_aug_strength <= 0.0003`
- **äººç‰©åŠ¨ä½œ**ï¼šé™åˆ¶ `motion_bucket_id <= 1.8`ï¼Œ`noise_aug_strength <= 0.0003`

**ä»£ç ä½ç½®**ï¼š
```python
# video_generator.py, line 170-202
# å¦‚æœæœ‰ç‰©ä½“è¿åŠ¨ï¼Œé™åˆ¶å‚æ•°ä¸Šé™ï¼Œå‡å°‘é—ªåŠ¨
if has_object_motion:
    if motion_bucket_id > 1.8:
        motion_bucket_id = 1.8  # é™åˆ¶åˆ°1.8ï¼Œå‡å°‘é—ªåŠ¨
    if noise_aug_strength > 0.0003:
        noise_aug_strength = 0.0003  # é™åˆ¶åˆ°0.0003ï¼Œå‡å°‘é—ªåŠ¨
```

### 3. å¢åŠ æ¨ç†æ­¥æ•°ï¼Œæé«˜ç¨³å®šæ€§ï¼ˆ`video_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **æ¨ç†æ­¥æ•°**ï¼šä» `45` æé«˜åˆ° `50`ï¼Œæé«˜ç¨³å®šæ€§å’Œå‡å°‘é—ªåŠ¨
- **è§¦å‘æ¡ä»¶**ï¼š`motion_bucket_id >= 1.7`ï¼ˆä¹‹å‰æ˜¯ `>= 2.0`ï¼‰

**ä»£ç ä½ç½®**ï¼š
```python
# video_generator.py, line 276-280
if motion_bucket_id >= 1.7:
    num_inference_steps = max(num_inference_steps, 50)  # æé«˜åˆ°50æ­¥ï¼Œå‡å°‘é—ªåŠ¨
    print(f"  â„¹ åŠ¨ä½œ/é•œå¤´è¿åŠ¨åœºæ™¯ï¼Œå¢åŠ æ¨ç†æ­¥æ•°è‡³ {num_inference_steps} æé«˜ç¨³å®šæ€§å’Œå‡å°‘é—ªåŠ¨")
```

### 4. ä¼˜åŒ– decode_chunk_sizeï¼Œæé«˜è¿è´¯æ€§ï¼ˆ`video_generator.py`ï¼‰

**ä¼˜åŒ–å†…å®¹**ï¼š
- **decode_chunk_size**ï¼šä¿æŒ `8`ï¼ˆSVD-XTæœ€ç¨³å®šèŒƒå›´ï¼‰ï¼Œæœ€å° `7`
- **è§¦å‘æ¡ä»¶**ï¼š`motion_bucket_id >= 1.7`ï¼ˆä¹‹å‰æ˜¯ `>= 2.0`ï¼‰

**ä»£ç ä½ç½®**ï¼š
```python
# video_generator.py, line 282-289
if motion_bucket_id >= 1.7:
    decode_chunk_size = min(decode_chunk_size, 8)  # ä¿æŒ8ï¼ŒSVD-XTæœ€ç¨³å®š
    if decode_chunk_size < 7:
        decode_chunk_size = 7  # æœ€å°7ï¼Œä¿æŒæµç•…åº¦
    print(f"  â„¹ åŠ¨ä½œ/é•œå¤´è¿åŠ¨åœºæ™¯ï¼Œè°ƒæ•´ decode_chunk_size è‡³ {decode_chunk_size} æé«˜è¿è´¯æ€§å’Œå‡å°‘é—ªåŠ¨")
```

## ğŸ¯ å‚æ•°ä¼˜åŒ–æ€»ç»“

### motion_bucket_idï¼ˆè¿åŠ¨å¹…åº¦ï¼‰
- **1.5**ï¼šè½»å¾®è¿åŠ¨ï¼ˆé›¾æ°”ã€è½»é£ã€çµæ°”é£˜åŠ¨ï¼‰- æœ€ç¨³å®š
- **1.7**ï¼šé•œå¤´ç¼©æ”¾ - å‡å°‘é—ªåŠ¨
- **1.8**ï¼šä¸­ç­‰è¿åŠ¨ï¼ˆç‰©ä½“è¿åŠ¨ã€é•œå¤´ç§»åŠ¨ã€äººç‰©åŠ¨ä½œï¼‰- å‡å°‘é—ªåŠ¨ï¼Œä¿æŒè¿åŠ¨æ˜æ˜¾
- **2.0**ï¼šä¸å†ä½¿ç”¨ï¼ˆä¼šå¯¼è‡´é—ªåŠ¨ï¼‰

### noise_aug_strengthï¼ˆè¿åŠ¨å¹³æ»‘åº¦ï¼‰
- **0.00025**ï¼šè½»å¾®è¿åŠ¨ï¼ˆé›¾æ°”ã€è½»é£ï¼‰- æœ€ç¨³å®š
- **0.0003**ï¼šä¸­ç­‰è¿åŠ¨ã€é•œå¤´è¿åŠ¨ã€äººç‰©åŠ¨ä½œ - å‡å°‘é—ªåŠ¨ï¼Œä¿æŒæµç•…
- **0.00035**ï¼šä¸å†ä½¿ç”¨ï¼ˆä¼šå¯¼è‡´é—ªåŠ¨ï¼‰

### num_inference_stepsï¼ˆç¨³å®šæ€§ï¼‰
- **40**ï¼šé»˜è®¤åœºæ™¯
- **50**ï¼šåŠ¨ä½œåœºæ™¯ã€é•œå¤´è¿åŠ¨åœºæ™¯ï¼ˆæé«˜ç¨³å®šæ€§å’Œå‡å°‘é—ªåŠ¨ï¼‰

### decode_chunk_sizeï¼ˆå¸§é—´è¿è´¯æ€§ï¼‰
- **7-8**ï¼šåŠ¨ä½œåœºæ™¯ã€é•œå¤´è¿åŠ¨åœºæ™¯ï¼ˆSVD-XTæœ€ç¨³å®šèŒƒå›´ï¼Œå‡å°‘é—ªåŠ¨ï¼‰

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

å®æ–½ä¸Šè¿°ä¿®å¤åï¼Œé¢„æœŸï¼š
1. **å‡å°‘é—ªåŠ¨**ï¼šé€šè¿‡é™ä½ `motion_bucket_id` å’Œ `noise_aug_strength`ï¼Œå‡å°‘ç”»é¢é—ªåŠ¨
2. **æé«˜ç¨³å®šæ€§**ï¼šé€šè¿‡å¢åŠ  `num_inference_steps` åˆ° 50ï¼Œæé«˜ç”»é¢ç¨³å®šæ€§
3. **æé«˜è¿è´¯æ€§**ï¼šé€šè¿‡ä¼˜åŒ– `decode_chunk_size` åˆ° 7-8ï¼Œæé«˜å¸§é—´è¿è´¯æ€§
4. **ä¿æŒè¿åŠ¨æ˜æ˜¾**ï¼šè™½ç„¶é™ä½äº†å‚æ•°ï¼Œä½† `1.8` å’Œ `0.0003` ä»ç„¶è¶³å¤Ÿä½¿è¿åŠ¨æ˜æ˜¾

## ğŸ“‹ éªŒè¯æ–¹æ³•

1. **é‡æ–°ç”Ÿæˆè§†é¢‘**ï¼šä½¿ç”¨ä¼˜åŒ–åçš„ä»£ç é‡æ–°ç”Ÿæˆæ‰€æœ‰åœºæ™¯çš„è§†é¢‘
2. **æ£€æŸ¥é—ªåŠ¨**ï¼šç¡®è®¤è§†é¢‘ä¸­åŠ¨èµ·æ¥çš„éƒ¨åˆ†ä¸å†é—ªåŠ¨ã€æ›´ç¨³å®š
3. **æ£€æŸ¥æµç•…åº¦**ï¼šç¡®è®¤è§†é¢‘ä»ç„¶æµç•…ï¼Œè¿åŠ¨ä»ç„¶æ˜æ˜¾

## ğŸ“ ä»£ç å˜æ›´æ–‡ä»¶

1. `gen_video/scene_motion_analyzer.py`
   - `analyze` æ–¹æ³•ï¼šé™ä½æ‰€æœ‰è¿åŠ¨å‚æ•°ï¼Œå‡å°‘é—ªåŠ¨

2. `gen_video/video_generator.py`
   - `generate_video` æ–¹æ³•ï¼šé™åˆ¶è¿åŠ¨å‚æ•°ä¸Šé™ï¼Œå‡å°‘é—ªåŠ¨
   - `_generate_video_svd` æ–¹æ³•ï¼šå¢åŠ æ¨ç†æ­¥æ•°ï¼Œä¼˜åŒ– decode_chunk_size

## âœ… è¯­æ³•æ£€æŸ¥

æ‰€æœ‰ä»£ç å·²é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚

