# 健壮的运动参数优化方案

## 📋 优化原则

**不使用关键词匹配**，而是基于**运动强度分类**的通用规则，更加健壮和可维护。

## ✅ 优化方案

### 1. 基于运动强度的通用参数映射

**核心思想**：不依赖具体元素（云、发带等），而是基于运动强度（gentle、moderate、dynamic）来设置参数。

#### 运动强度分类

| 运动强度 | 说明 | motion_bucket_id | noise_aug_strength |
|---------|------|-----------------|-------------------|
| **gentle** | 轻微运动（表情变化、微动、环境微动） | 1.4 | 0.00025 |
| **moderate** | 中等运动（物体运动、镜头运动、人物中等动作） | 1.6 | 0.0003 |
| **dynamic** | 明显运动（快速动作、明显物体运动） | 1.8 | 0.0003 |

### 2. 参数生成逻辑

**优先级**：
1. **运动强度**（gentle/moderate/dynamic）→ 使用通用参数映射
2. **场景类型**（character/environment/object/camera/action）→ 使用场景特定参数
3. **analysis覆盖值**（如果明确指定）→ 使用覆盖值

**优势**：
- ✅ 不依赖关键词匹配，更健壮
- ✅ 基于运动强度，更通用
- ✅ 参数统一，更可预测
- ✅ 易于维护和调整

### 3. 参数映射表

#### 基于运动强度（优先使用）

```python
"gentle": {
    "motion_bucket_id": 1.4,  # 轻微运动
    "noise_aug_strength": 0.00025,
}

"moderate": {
    "motion_bucket_id": 1.6,  # 中等运动
    "noise_aug_strength": 0.0003,
}

"dynamic": {
    "motion_bucket_id": 1.8,  # 明显运动
    "noise_aug_strength": 0.0003,
}
```

#### 基于场景类型（备用）

```python
# 人物场景
"character_close_up": 1.4  # 特写：较低
"character_medium": 1.5    # 中景：中等
"character_wide": 1.6       # 远景：稍高

# 环境场景
"environment_static": 1.4   # 静态：较低
"environment_dynamic": 1.6  # 动态：中等

# 物体运动
"object_floating": 1.4      # 飘动：轻微
"object_rotating": 1.6      # 旋转：中等
"object_unfurling": 1.7     # 展开：中等偏高

# 镜头运动
"camera_zoom": 1.5          # 缩放：中等偏低
"camera_pan": 1.6           # 平移：中等
"camera_dolly": 1.6         # 跟拍：中等

# 动作场景
"action_gentle": 1.4        # 轻微动作
"action_moderate": 1.6      # 中等动作
"action_dynamic": 1.8        # 明显动作
```

## 🎯 工作流程

```
场景数据
    ↓
运动分析 → 确定运动强度（gentle/moderate/dynamic）
    ↓
参数生成 → 优先使用运动强度参数
    ↓
场景类型分类 → 如果没有运动强度，使用场景类型参数
    ↓
应用参数 → 生成视频
```

## ✅ 优势

### 1. 更健壮
- ✅ 不依赖关键词匹配
- ✅ 基于运动强度，更通用
- ✅ 参数统一，更可预测

### 2. 更易维护
- ✅ 只需调整3个运动强度参数
- ✅ 不需要维护大量关键词列表
- ✅ 逻辑清晰，易于理解

### 3. 更可扩展
- ✅ 新增场景类型只需添加参数映射
- ✅ 不需要添加新的关键词
- ✅ 参数调整更简单

## 📊 参数范围

- **1.0-1.3**：几乎静态
- **1.4-1.5**：轻微运动（gentle）✅ 推荐用于云、发带等
- **1.6-1.7**：中等运动（moderate）✅ 推荐用于物体运动、镜头运动
- **1.8-2.0**：明显运动（dynamic）✅ 推荐用于快速动作

## 🔧 调整方式

如果需要调整运动速度，只需修改运动强度参数：

```python
# 在 svd_parameter_generator.py 中
"gentle": {
    "motion_bucket_id": 1.4,  # 可以调整为 1.3 或 1.2 来进一步降低速度
    "noise_aug_strength": 0.00025,
}
```

## ✅ 总结

**优化后的方案**：
- ✅ 基于运动强度，不依赖关键词匹配
- ✅ 更健壮、更易维护
- ✅ 参数统一、可预测
- ✅ 易于调整和扩展

**效果**：
- 轻微运动（gentle）自动使用 `motion_bucket_id = 1.4`，减少过快运动
- 中等运动（moderate）自动使用 `motion_bucket_id = 1.6`，平衡运动明显度和稳定性
- 明显运动（dynamic）自动使用 `motion_bucket_id = 1.8`，确保动作明显

