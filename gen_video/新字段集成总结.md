# æ–° JSON å­—æ®µé›†æˆæ€»ç»“

## âœ… å·²å®Œæˆçš„é›†æˆ

### 1. `face_style_auto` è‡ªåŠ¨ç”Ÿæˆ

**ä½ç½®ï¼š** `face_style_auto_generator.py`ï¼ˆç‹¬ç«‹æ¨¡å—ï¼‰

**åŠŸèƒ½ï¼š**
- æ ¹æ® `mood` / `lighting` / `action` è‡ªåŠ¨ç”Ÿæˆ `face_style_auto`
- æ”¯æŒåºåˆ—å¹³æ»‘ï¼ˆé¿å…é•œå¤´é—´é£æ ¼çªå˜ï¼‰
- æä¾› `to_instantid_params()` æ˜ å°„åˆ° InstantID å‚æ•°

**é›†æˆç‚¹ï¼š**
- `image_generator.py::generate_from_script()` - åœ¨ç”Ÿæˆå›¾åƒå‰è‡ªåŠ¨è°ƒç”¨
- å¦‚æœåœºæ™¯æ²¡æœ‰ `face_style_auto`ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶å†™å…¥ JSON

### 2. `duration` å­—æ®µæ”¯æŒ

**åŠŸèƒ½ï¼š**
- æ ¹æ® `duration` è®¡ç®—è§†é¢‘ç”Ÿæˆå¸§æ•°ï¼š`frames = duration * fps`
- åœ¨ `video_generator.py::generate_video()` ä¸­å®ç°

**ä½¿ç”¨æ–¹å¼ï¼š**
```json
{
  "duration": 5,  // 5ç§’
  // ... å…¶ä»–å­—æ®µ
}
```

### 3. `visual` å­—æ®µå®Œæ•´æ”¯æŒ

**å­å­—æ®µï¼š**
- `composition` - æ„å›¾æè¿°ï¼ˆæƒé‡ 1.2ï¼‰
- `environment` - ç¯å¢ƒæè¿°ï¼ˆæƒé‡ 1.0ï¼‰
- `character_pose` - è§’è‰²å§¿åŠ¿ï¼ˆæƒé‡ 1.15ï¼‰
- `fx` - ç‰¹æ•ˆï¼ˆæƒé‡ 0.9ï¼‰
- `motion` - é•œå¤´è¿åŠ¨ï¼ˆæƒé‡ 1.0ï¼‰

**é›†æˆç‚¹ï¼š**
- `image_generator.py::build_prompt()` - ä¼˜å…ˆä½¿ç”¨ visual å­—æ®µæ„å»º prompt
- `_convert_motion_to_prompt()` - æ”¯æŒå­—ç¬¦ä¸²å’Œç»“æ„åŒ–æ ¼å¼

### 4. `face_style_auto` å‚æ•°åº”ç”¨

**åŠŸèƒ½ï¼š**
- æ ¹æ® `expression` / `lighting` / `detail` è°ƒæ•´ InstantID å‚æ•°
- è‡ªåŠ¨è°ƒæ•´ `ip_adapter_scale` å’Œ `face_kps_scale`

**é›†æˆç‚¹ï¼š**
- `image_generator.py::_generate_image_instantid()` - åœ¨ç”Ÿæˆæ—¶åº”ç”¨å‚æ•°

## ğŸ“‹ å­—æ®µæ˜ å°„å…³ç³»

### face_style_auto.expression â†’ InstantID å‚æ•°

| expression | ip_adapter_scale è°ƒæ•´ | è¯´æ˜ |
|-----------|---------------------|------|
| focused | +5% | éœ€è¦æ¸…æ™°è¡¨æƒ… |
| alert | +5% | éœ€è¦æ¸…æ™°è¡¨æƒ… |
| determined | +5% | éœ€è¦æ¸…æ™°è¡¨æƒ… |
| neutral | 0% | é»˜è®¤ |
| calm | -5% | æŸ”å’Œè¡¨æƒ… |
| tired_soft | -10% | é™ä½æƒé‡ |

### face_style_auto.detail â†’ InstantID å‚æ•°

| detail | ip_adapter_scale è°ƒæ•´ | face_kps_scale è°ƒæ•´ | è¯´æ˜ |
|--------|---------------------|-------------------|------|
| detailed | +15% | +10% | å¢åŠ ç»†èŠ‚ |
| cinematic | +5% | +10% | å½±è§†çº§ç»†èŠ‚ |
| sharp_dynamic | +10% | +5% | åŠ¨æ€åœºæ™¯ |
| natural | 0% | 0% | é»˜è®¤ |
| soft_concentrated | -5% | -5% | æŸ”å’Œèšç„¦ |
| subtle | -10% | -10% | æç®€ç»†èŠ‚ |

### face_style_auto.lighting â†’ prompt

| lighting | prompt æ·»åŠ  |
|---------|------------|
| bright_normal | `(face lighting: bright_normal:0.95)` |
| soft | `(face lighting: soft:0.95)` |
| dramatic | `(face lighting: dramatic:0.95)` |
| rim_light | `(face lighting: rim_light:0.95)` |

## ğŸ”„ è‡ªåŠ¨åŒ–æµç¨‹

```
JSON è„šæœ¬
    â†“
generate_from_script()
    â†“
[è‡ªåŠ¨ç”Ÿæˆ face_style_auto] â† å¦‚æœä¸å­˜åœ¨
    â†“
build_prompt()
    â”œâ”€ visual.composition â†’ prompt (æƒé‡ 1.2)
    â”œâ”€ visual.environment â†’ prompt (æƒé‡ 1.0)
    â”œâ”€ visual.character_pose â†’ prompt (æƒé‡ 1.15)
    â”œâ”€ visual.fx â†’ prompt (æƒé‡ 0.9)
    â”œâ”€ visual.motion â†’ prompt (æƒé‡ 1.0)
    â””â”€ face_style_auto â†’ prompt + å‚æ•°è°ƒæ•´
    â†“
_generate_image_instantid()
    â”œâ”€ åº”ç”¨ face_style_auto åˆ° ip_adapter_scale
    â””â”€ åº”ç”¨ face_style_auto åˆ° face_kps_scale
    â†“
ç”Ÿæˆå›¾åƒ
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### JSON æ ¼å¼

```json
{
  "id": 1,
  "duration": 5,
  "mood": "serious",
  "lighting": "day",
  "action": "walking_forward",
  "camera": "wide_shot_low_angle",
  "visual": {
    "composition": "Han Li small silhouette vs vast golden desert",
    "environment": "rolling sand waves, intense sunlight, heat distortion",
    "character_pose": "steady forward walk, robe slightly fluttering",
    "fx": "subtle heat haze, drifting sand",
    "motion": "slow dolly-forward shot"
  },
  "face_style_auto": {
    "expression": "focused",
    "lighting": "bright_normal",
    "detail": "natural",
    "strength": 0.85
  }
}
```

### è‡ªåŠ¨ç”Ÿæˆ face_style_auto

å¦‚æœ JSON ä¸­æ²¡æœ‰ `face_style_auto`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆï¼š

```python
# è‡ªåŠ¨è°ƒç”¨
generate_face_styles_for_episode(scenes, smooth=True, overwrite_existing=False)
```

### æ‰‹åŠ¨æŒ‡å®š face_style_auto

å¦‚æœ JSON ä¸­å·²æœ‰ `face_style_auto`ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ç°æœ‰å€¼ï¼Œä¸ä¼šè¦†ç›–ã€‚

## ğŸ¯ æ•ˆæœ

1. **æ›´å‡†ç¡®çš„ prompt** - visual å­—æ®µæä¾›æ›´ç²¾ç¡®çš„æè¿°
2. **è‡ªåŠ¨è¡¨æƒ…æ§åˆ¶** - face_style_auto è‡ªåŠ¨è°ƒæ•´é¢éƒ¨æƒé‡
3. **é•œå¤´æ—¶é•¿æ§åˆ¶** - duration è‡ªåŠ¨è®¡ç®—å¸§æ•°
4. **åºåˆ—å¹³æ»‘** - é¿å…é•œå¤´é—´é£æ ¼çªå˜

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **face_style_auto è‡ªåŠ¨ç”Ÿæˆ**
   - åªåœ¨åœºæ™¯æ²¡æœ‰ `face_style_auto` æ—¶ç”Ÿæˆ
   - å¦‚æœå·²æœ‰ï¼Œä¼šä¿ç•™åŸæœ‰å€¼
   - å¯ä»¥é€šè¿‡ `overwrite_existing=True` å¼ºåˆ¶è¦†ç›–

2. **visual.motion æ ¼å¼**
   - æ”¯æŒå­—ç¬¦ä¸²ï¼š`"slow dolly-forward shot"`
   - æ”¯æŒå¯¹è±¡ï¼š`{"type": "pan", "direction": "left_to_right", "speed": "slow"}`

3. **duration è®¡ç®—**
   - åªåœ¨ `video_generator.generate_video()` ä¸­ä½¿ç”¨
   - å¦‚æœåœºæ™¯æ²¡æœ‰ `duration`ï¼Œä½¿ç”¨é…ç½®ä¸­çš„é»˜è®¤å€¼

