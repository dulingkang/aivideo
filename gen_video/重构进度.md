# é‡æ„è¿›åº¦æŠ¥å‘Š

## âœ… å·²å®Œæˆ

### 1. æ¨¡å—ç»“æ„åˆ›å»º
- âœ… åˆ›å»ºäº† `prompt/` æ¨¡å—ç›®å½•ç»“æ„
- âœ… åˆ›å»ºäº† `core/`, `adapters/`, `generators/`, `profiles/`, `utils/` ç›®å½•

### 2. Promptæ¨¡å—åŸºç¡€ç»„ä»¶
- âœ… `prompt/__init__.py` - æ¨¡å—å¯¼å‡º
- âœ… `prompt/token_estimator.py` - Tokenä¼°ç®—å™¨ï¼ˆçº¦150è¡Œï¼‰
  - æå–è‡ª `_estimate_clip_tokens()` æ–¹æ³•
  - æ”¯æŒçœŸå®tokenizerå’Œå›é€€ä¼°ç®—
- âœ… `prompt/parser.py` - Promptè§£æå™¨ï¼ˆçº¦150è¡Œï¼‰
  - æå–è‡ª `_extract_first_keyword()` æ–¹æ³•
  - æå–è‡ª `_extract_core_keywords()` æ–¹æ³•
- âœ… `prompt/optimizer.py` - Promptä¼˜åŒ–å™¨ï¼ˆçº¦200è¡Œï¼‰
  - æå–è‡ª `_smart_optimize_prompt()` æ–¹æ³•
  - æå–è‡ª `_analyze_prompt_importance()` æ–¹æ³•

### 3. ä»£ç è´¨é‡
- âœ… æ‰€æœ‰æ–°æ¨¡å—é€šè¿‡è¯­æ³•æ£€æŸ¥
- âœ… ä¿æŒå•ä¸€èŒè´£åŸåˆ™
- âœ… ä¾èµ–å…³ç³»æ¸…æ™°

---

## ğŸš§ è¿›è¡Œä¸­

### PromptBuilder æ¨¡å—
- â³ éœ€è¦æå– `build_prompt()` æ–¹æ³•ï¼ˆçº¦1500è¡Œï¼‰
- â³ éœ€è¦æå–ç›¸å…³è¾…åŠ©æ–¹æ³•ï¼š
  - `_convert_camera_to_prompt()`
  - `_convert_motion_to_prompt()`
  - `_looks_like_camera_prompt()`
  - `_build_character_prompt()`
  - `_build_character_prompt_compact()`
  - `_build_character_description_prompt()`
  - `_build_scene_background_prompt()`
  - `_build_scene_background_prompt_compact()`

---

## ğŸ“‹ å¾…åŠäº‹é¡¹

### é˜¶æ®µä¸€ï¼šPromptæ¨¡å—å®Œæˆï¼ˆå½“å‰é˜¶æ®µï¼‰
1. [ ] åˆ›å»º `prompt/builder.py` - PromptBuilderç±»
2. [ ] æå– `build_prompt()` ä¸»æ–¹æ³•
3. [ ] æå–æ‰€æœ‰è¾…åŠ©æ–¹æ³•
4. [ ] æ›´æ–° `ImageGenerator` ä½¿ç”¨æ–°çš„ `PromptBuilder`
5. [ ] æµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸

### é˜¶æ®µäºŒï¼šPipelineç®¡ç†æ¨¡å—
1. [ ] åˆ›å»º `core/pipeline_manager.py`
2. [ ] æå– `load_pipeline()`, `_load_instantid_pipeline()`, `_load_sdxl_pipeline()`
3. [ ] åˆ›å»º `core/device_manager.py`
4. [ ] æ›´æ–° `ImageGenerator` ä½¿ç”¨æ–°çš„Pipelineç®¡ç†å™¨

### é˜¶æ®µä¸‰ï¼šç”Ÿæˆå™¨æ¨¡å—
1. [ ] åˆ›å»º `generators/base_generator.py` - ç”Ÿæˆå™¨åŸºç±»
2. [ ] åˆ›å»º `generators/sdxl_generator.py` - SDXLç”Ÿæˆå™¨
3. [ ] åˆ›å»º `generators/instantid_generator.py` - InstantIDç”Ÿæˆå™¨
4. [ ] æ›´æ–° `ImageGenerator` ä½¿ç”¨æ–°çš„ç”Ÿæˆå™¨

### é˜¶æ®µå››ï¼šAdapteræ¨¡å—
1. [ ] åˆ›å»º `adapters/ip_adapter.py`
2. [ ] åˆ›å»º `adapters/lora_adapter.py`
3. [ ] åˆ›å»º `adapters/instantid_adapter.py`
4. [ ] æ›´æ–° `ImageGenerator` ä½¿ç”¨æ–°çš„Adapterç®¡ç†å™¨

### é˜¶æ®µäº”ï¼šé…ç½®ç®¡ç†æ¨¡å—
1. [ ] åˆ›å»º `profiles/character_manager.py`
2. [ ] åˆ›å»º `profiles/scene_manager.py`
3. [ ] åˆ›å»º `utils/config_loader.py`
4. [ ] æ›´æ–° `ImageGenerator` ä½¿ç”¨æ–°çš„é…ç½®ç®¡ç†å™¨

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### å½“å‰çŠ¶æ€
- **åŸå§‹æ–‡ä»¶**: `image_generator.py` - 5603è¡Œ
- **å·²æå–**: ~500è¡Œï¼ˆpromptæ¨¡å—åŸºç¡€ç»„ä»¶ï¼‰
- **å‰©ä½™**: ~5100è¡Œ

### ç›®æ ‡çŠ¶æ€
- **ä¸»æ–‡ä»¶**: `image_generator.py` - <500è¡Œï¼ˆä»…ä½œä¸ºå…¥å£å’Œåè°ƒå™¨ï¼‰
- **promptæ¨¡å—**: ~2000è¡Œï¼ˆåˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼‰
- **coreæ¨¡å—**: ~800è¡Œ
- **generatorsæ¨¡å—**: ~1500è¡Œ
- **adaptersæ¨¡å—**: ~600è¡Œ
- **profilesæ¨¡å—**: ~400è¡Œ
- **utilsæ¨¡å—**: ~300è¡Œ

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. **åˆ›å»º `prompt/builder.py`**
   - è¿™æ˜¯æœ€å¤æ‚çš„æ¨¡å—ï¼Œéœ€è¦ä»”ç»†æå–
   - å»ºè®®åˆ†æ­¥éª¤ï¼š
     a. å…ˆåˆ›å»ºç±»ç»“æ„
     b. é€æ­¥è¿ç§»æ–¹æ³•
     c. ä¿æŒå‘åå…¼å®¹

2. **æ›´æ–° `ImageGenerator`**
   - æ·»åŠ  `PromptBuilder` å®ä¾‹
   - å°† `build_prompt()` å§”æ‰˜ç»™ `PromptBuilder`
   - ä¿æŒåŸæœ‰æ¥å£ä¸å˜

3. **æµ‹è¯•éªŒè¯**
   - è¿è¡Œç°æœ‰æµ‹è¯•
   - ç¡®ä¿åŠŸèƒ½æ­£å¸¸
   - æ£€æŸ¥æ€§èƒ½å½±å“

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**
   - ä¿æŒ `ImageGenerator` çš„å…¬å…±æ¥å£ä¸å˜
   - å†…éƒ¨å®ç°å¯ä»¥é‡æ„

2. **ä¾èµ–ç®¡ç†**
   - é¿å…å¾ªç¯ä¾èµ–
   - ä½¿ç”¨ä¾èµ–æ³¨å…¥

3. **æµ‹è¯•è¦†ç›–**
   - æ¯ä¸ªæ–°æ¨¡å—éƒ½è¦æœ‰å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•ç¡®ä¿æ•´ä½“åŠŸèƒ½æ­£å¸¸

4. **æ–‡æ¡£æ›´æ–°**
   - æ›´æ–°APIæ–‡æ¡£
   - æ›´æ–°ä½¿ç”¨ç¤ºä¾‹

---

## ğŸ” ä»£ç å®¡æŸ¥è¦ç‚¹

- [ ] æ¯ä¸ªæ¨¡å—ä¸è¶…è¿‡500è¡Œ
- [ ] æ¯ä¸ªç±»å•ä¸€èŒè´£
- [ ] æ–¹æ³•ä¸è¶…è¿‡50è¡Œ
- [ ] ä¾èµ–å…³ç³»æ¸…æ™°
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•å……åˆ†









