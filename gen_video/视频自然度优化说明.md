# 视频自然度优化说明

## 优化目标
确保人物动作和动画场景的视频看起来自然、流畅，有适当的身体动作和动画效果。

## 已实施的优化

### 1. 智能动作识别和参数调整

#### 动作类型分类
- **明显动作**（dynamic）：攻击、奔跑、跳跃、施法等
  - `motion_bucket_id`: 2.5（接近SVD-XT最大值2.0）
  - `noise_aug_strength`: 0.0004
  - 确保动作明显可见

- **中等动作**（moderate）：转头、抬手、吸气、收集等
  - `motion_bucket_id`: 2.0
  - `noise_aug_strength`: 0.0003
  - 确保动作自然流畅

- **轻微动作**（gentle）：表情变化、微动等
  - `motion_bucket_id`: 1.8
  - `noise_aug_strength`: 0.0003
  - 确保有自然微动

- **完全静态**（static）：一动不动
  - 使用静态图像动画（Ken Burns效果）

#### 自动参数调整
系统会根据场景描述自动识别动作类型，并调整参数：
- 检测到"攻击"、"奔跑"等明显动作 → 使用较高运动参数
- 检测到"转头"、"抬手"等中等动作 → 使用中等运动参数
- 检测到"静止"、"不动" → 使用静态图像动画

### 2. 帧数和帧率优化

#### 当前配置
- `num_frames`: 120（5秒 × 24fps）
- `fps`: 24（标准视频帧率）
- `max_frames`: 384（约16秒）

#### 动作场景优化
- 对于动作场景，确保至少4秒的帧数（96帧@24fps）
- 自动增加帧数以确保动作流畅

### 3. 推理参数优化

#### 动作场景特殊处理
- **推理步数**：动作场景自动增加到45步（提高稳定性）
- **decode_chunk_size**：动作场景自动调整为7（提高连贯性）
- **motion_bucket_id限制**：确保不超过SVD-XT的最大值（2.0）

### 4. 智能分析集成

系统使用`SceneMotionAnalyzer`自动分析场景：
- 识别动作类型（明显/中等/轻微/静态）
- 自动调整运动参数
- 确保动作自然流畅

## 参数说明

### motion_bucket_id（运动幅度）
- **1.5-1.8**：轻微运动（表情变化、微动）
- **2.0**：中等运动（转头、抬手、吸气）
- **2.0-2.5**：明显运动（攻击、奔跑、跳跃）
- **注意**：SVD-XT最大值为2.0，超过会自动限制

### noise_aug_strength（运动平滑度）
- **0.00025**：轻微运动
- **0.0003**：中等运动
- **0.0004**：明显运动
- **注意**：过高会导致抖动，过低会导致动作僵硬

### decode_chunk_size（帧间连贯性）
- **7-8**：动作场景推荐（提高连贯性）
- **8-10**：静态场景推荐（提高稳定性）

### num_inference_steps（稳定性）
- **40**：基础步数
- **45**：动作场景自动增加（提高稳定性）

## 使用建议

### 1. JSON描述优化
在JSON中明确描述动作类型：
```json
{
  "action": "Charging attack",  // 明显动作
  "description": "韩立头颅一偏，胸膛一瘪，吸起一团沙砾"  // 中等动作
}
```

### 2. 动作关键词
系统会自动识别以下关键词：
- **明显动作**：attack, fight, run, jump, cast, 攻击, 战斗, 奔跑, 跳跃, 施法
- **中等动作**：tilt, turn, move, gather, inhale, 侧, 转, 移动, 收集, 吸
- **静态**：still, motionless, 静止, 不动

### 3. 场景类型
- **人物动作场景**：系统会自动使用较高运动参数
- **物体动画场景**：系统会自动识别并调整参数
- **静态场景**：系统会自动使用静态图像动画

## 预期效果

1. **人物动作**：身体有自然微动，动作流畅
2. **动画场景**：物体运动自然，无抖动
3. **整体流畅度**：视频连贯，无跳跃感
4. **自然度**：动作符合场景描述，看起来自然

## 测试建议

1. 测试明显动作场景（如攻击、奔跑）
2. 测试中等动作场景（如转头、抬手）
3. 测试轻微动作场景（如表情变化）
4. 测试物体动画场景（如卷轴展开）
5. 验证动作是否自然流畅

