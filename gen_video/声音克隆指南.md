# TTS 声音克隆指南

## 概述

要将自己的声音输入到TTS系统中，有几种方法：

1. **ChatTTS** - 支持零样本声音克隆（Zero-shot Voice Cloning）
2. **Coqui TTS** - 支持微调（Fine-tuning）和声音克隆
3. **OpenVoice** - 支持声音克隆

## 方法1: ChatTTS 声音克隆（推荐）

ChatTTS 支持零样本声音克隆，只需要提供一段参考音频即可。

### 录制要求

#### 1. 录制内容（中文）

**推荐录制以下内容（覆盖常见音素）：**

```
大家好，我是云卷仙音。今天我们要讲述一个关于修仙者的故事。
在这个充满灵气的世界里，修行者们追求长生不老的梦想。
韩立是一个普通的凡人，但他有着不屈的意志和坚定的信念。
通过不断的努力和机缘巧合，他逐渐成长为一名强大的修士。
在灵界的旅程中，他遇到了许多挑战和机遇。
每一次的突破都让他的修为更上一层楼。
这就是凡人修仙传的故事，一个关于坚持和成长的故事。
```

**或者使用更简单的版本：**

```
大家好，我是云卷仙音。今天我们要继续讲述凡人修仙传的故事。
在这个故事中，韩立经历了无数的挑战和机遇。
他从一个普通的凡人，逐渐成长为强大的修士。
每一次的突破都充满了惊险和刺激。
让我们一起跟随韩立的脚步，探索这个神秘的修仙世界。
```

#### 2. 录制时长

- **最短**: 10-15秒（最低要求）
- **推荐**: 30-60秒（最佳效果）
- **最长**: 2-3分钟（足够覆盖各种音素）

#### 3. 录制质量要求

- **格式**: WAV 或 MP3
- **采样率**: 16kHz 或 24kHz（ChatTTS 推荐 24kHz）
- **声道**: 单声道（Mono）
- **比特率**: 16-bit 或更高
- **环境**: 安静的环境，无背景噪音
- **音量**: 适中，不要过大或过小

#### 4. 录制技巧

1. **语速**: 自然、清晰，不要过快或过慢
2. **语调**: 保持自然，符合"云卷仙音"的风格（平静、叙述型）
3. **停顿**: 适当的停顿，不要连续不断
4. **发音**: 清晰准确，注意声调
5. **情感**: 保持一致的风格（温柔、叙述、有仙气）

### 使用步骤

#### 步骤1: 录制音频

使用录音软件（如 Audacity、系统录音工具）录制：

```bash
# 使用系统录音工具
arecord -d 60 -f cd -t wav reference_audio.wav

# 或使用 ffmpeg 录制
ffmpeg -f alsa -i default -t 60 -ar 24000 reference_audio.wav
```

#### 步骤2: 预处理音频

```bash
# 转换为单声道，24kHz采样率
ffmpeg -i reference_audio.wav -ar 24000 -ac 1 -acodec pcm_s16le reference_audio_processed.wav
```

#### 步骤3: 使用 ChatTTS 生成语音

创建自定义 TTS 脚本：

```python
import ChatTTS
import torch
import soundfile as sf

# 加载模型
chat = ChatTTS.Chat()
chat.load(compile=False)

# 加载参考音频
ref_audio, sr = sf.read("reference_audio.wav")

# 生成语音（使用参考音频）
texts = ["当韩立再次睁开双眼，发现自己身处一片茫茫黄沙之中。"]
wavs = chat.infer(
    texts,
    use_decoder=True,
    ref_audio=ref_audio,  # 使用参考音频
    temperature=0.7,
)

# 保存生成的音频
sf.write("output.wav", wavs[0], 24000)
```

### 更新 TTS 生成器

更新 `tts_generator.py` 以支持声音克隆：

```python
def generate_with_reference(
    self,
    text: str,
    output_path: str,
    reference_audio_path: str,
    **kwargs
):
    """使用参考音频生成语音"""
    import soundfile as sf
    
    # 加载参考音频
    ref_audio, sr = sf.read(reference_audio_path)
    if sr != 24000:
        # 重采样到24kHz
        import librosa
        ref_audio = librosa.resample(ref_audio, orig_sr=sr, target_sr=24000)
    
    # 生成语音
    wavs = self.chattts.infer(
        [text],
        use_decoder=True,
        ref_audio=ref_audio,
        temperature=kwargs.get('temperature', 0.7),
    )
    
    # 保存音频
    sf.write(output_path, wavs[0], 24000)
```

## 方法2: Coqui TTS 声音克隆

Coqui TTS 支持更高级的声音克隆，但需要更多的训练数据。

### 录制要求

- **时长**: 至少 10-30 分钟（用于微调）
- **内容**: 多样化的文本，覆盖各种音素
- **质量**: 高音质，无噪音

### 使用步骤

1. 准备训练数据（音频 + 文本对齐）
2. 使用 Coqui TTS 进行微调
3. 使用微调后的模型生成语音

## 方法3: OpenVoice 声音克隆

OpenVoice 是另一个支持声音克隆的 TTS 系统。

### 录制要求

- **时长**: 5-10 秒（零样本克隆）
- **内容**: 任意清晰的中文语音
- **质量**: 高音质，无背景噪音

## 推荐方案

对于你的"云卷仙音"项目，**推荐使用 ChatTTS**：

1. **简单易用**: 只需要一段参考音频
2. **效果良好**: 零样本克隆效果不错
3. **中文支持**: 对中文支持较好
4. **快速**: 不需要训练过程

### 具体操作步骤

1. **录制参考音频**（30-60秒）
   - 使用上面的推荐文本
   - 保持自然、清晰的发音
   - 符合"云卷仙音"的风格

2. **保存为 WAV 格式**
   - 24kHz 采样率
   - 单声道
   - 16-bit

3. **更新配置文件**
   ```yaml
   tts:
     engine: "chattts"
     reference_audio: "assets/voices/yunjuanxianyin_reference.wav"
   ```

4. **使用更新的 TTS 生成器**
   - 支持参考音频输入
   - 自动处理音频格式

## 录制脚本模板

### 完整版（推荐，60秒）

```
大家好，我是云卷仙音。今天我们要继续讲述凡人修仙传的故事。

在这个故事中，韩立经历了无数的挑战和机遇。他从一个普通的凡人，逐渐成长为强大的修士。

每一次的突破都充满了惊险和刺激。让我们一起跟随韩立的脚步，探索这个神秘的修仙世界。

在这个充满灵气的世界里，修行者们追求长生不老的梦想。韩立是一个普通的凡人，但他有着不屈的意志和坚定的信念。

通过不断的努力和机缘巧合，他逐渐成长为一名强大的修士。在灵界的旅程中，他遇到了许多挑战和机遇。
```

### 精简版（30秒）

```
大家好，我是云卷仙音。今天我们要继续讲述凡人修仙传的故事。

在这个故事中，韩立经历了无数的挑战和机遇。他从一个普通的凡人，逐渐成长为强大的修士。

每一次的突破都充满了惊险和刺激。让我们一起跟随韩立的脚步，探索这个神秘的修仙世界。
```

### 超短版（15秒，最低要求）

```
大家好，我是云卷仙音。今天我们要继续讲述凡人修仙传的故事。

在这个故事中，韩立经历了无数的挑战和机遇。他从一个普通的凡人，逐渐成长为强大的修士。
```

## 音频处理工具

### 使用 Audacity（推荐）

1. 下载安装 Audacity
2. 录制音频
3. 导出为 WAV 格式：
   - 采样率: 24000 Hz
   - 声道: Mono (单声道)
   - 格式: WAV (Microsoft) 16-bit PCM

### 使用 FFmpeg 处理

```bash
# 转换格式
ffmpeg -i input.wav -ar 24000 -ac 1 -acodec pcm_s16le output.wav

# 去除噪音（可选）
ffmpeg -i input.wav -af "highpass=f=200,lowpass=f=3000" output.wav

# 标准化音量
ffmpeg -i input.wav -af "loudnorm=I=-16:TP=-1.5:LRA=11" output.wav
```

## 测试声音克隆效果

创建测试脚本：

```python
import ChatTTS
import soundfile as sf

# 加载模型
chat = ChatTTS.Chat()
chat.load(compile=False)

# 加载参考音频
ref_audio, sr = sf.read("reference_audio.wav")

# 测试生成
test_texts = [
    "当韩立再次睁开双眼，发现自己身处一片茫茫黄沙之中。",
    "他艰难地坐起身，拍了拍身上的沙尘，感受着身体的虚弱。",
    "韩立盘坐在沙地上，闭目内视，检查自身修为状况。",
]

for i, text in enumerate(test_texts):
    wavs = chat.infer([text], use_decoder=True, ref_audio=ref_audio)
    sf.write(f"test_{i}.wav", wavs[0], 24000)
    print(f"生成: {text}")
```

## 注意事项

1. **音质**: 参考音频质量直接影响克隆效果
2. **时长**: 更长的参考音频通常效果更好
3. **多样性**: 参考音频应该覆盖各种音素
4. **环境**: 录制环境要安静，无背景噪音
5. **风格**: 保持一致的说话风格和语调

## 总结

**推荐配置**:
- **方法**: ChatTTS 零样本克隆
- **录制时长**: 30-60秒
- **录制内容**: 使用上面的推荐脚本
- **格式**: WAV, 24kHz, 单声道, 16-bit
- **环境**: 安静的环境，清晰发音

准备好参考音频后，我们就可以更新 TTS 生成器以支持声音克隆了！

