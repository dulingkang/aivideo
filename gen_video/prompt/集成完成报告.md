# Promptæ¨¡å—é›†æˆå®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… é›†æˆå®Œæˆ

---

## âœ… é›†æˆå®Œæˆæƒ…å†µ

### 1. ImageGenerator æ›´æ–°

- âœ… å¯¼å…¥ prompt æ¨¡å—ç»„ä»¶
- âœ… åœ¨ `__init__` ä¸­åˆå§‹åŒ– Prompt æ¨¡å—ç»„ä»¶ï¼š
  - `TokenEstimator`
  - `PromptParser`
  - `PromptOptimizer`
  - `PromptBuilder`
- âœ… æ³¨å…¥å¿…è¦çš„ä¾èµ–ï¼š
  - `_identify_characters_in_scene` æ–¹æ³•
  - `_needs_character` æ–¹æ³•
  - `character_profiles` å’Œ `scene_profiles`
  - `intent_analyzer`
- âœ… `build_prompt` æ–¹æ³•å·²å§”æ‰˜ç»™ `PromptBuilder.build()`

### 2. ä»£ç æ¸…ç†

- âœ… åˆ é™¤äº†æ—§çš„ `build_prompt` å®ç°ï¼ˆ1536è¡Œï¼‰
- âœ… ä¿ç•™äº†æ³¨é‡Šè¯´æ˜è¿ç§»ä½ç½®
- âœ… æ— è¯­æ³•é”™è¯¯
- âœ… æ—  linter é”™è¯¯

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–‡ä»¶è¡Œæ•°å¯¹æ¯”

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `image_generator.py` | 4119 | å‡å°‘äº†çº¦ 1484 è¡Œ |
| `prompt/__init__.py` | 18 | æ¨¡å—å¯¼å‡º |
| `prompt/token_estimator.py` | 125 | Tokenä¼°ç®—å™¨ |
| `prompt/parser.py` | 170 | Promptè§£æå™¨ |
| `prompt/optimizer.py` | 236 | Promptä¼˜åŒ–å™¨ |
| `prompt/builder.py` | 1316 | Promptæ„å»ºå™¨ |
| **promptæ¨¡å—æ€»è®¡** | **1865** | å·²æå–çš„ä»£ç  |

### é‡æ„æ•ˆæœ

- **åŸå§‹æ–‡ä»¶**: 5602 è¡Œ
- **é‡æ„å**: 4119 è¡Œï¼ˆä¸»æ–‡ä»¶ï¼‰+ 1865 è¡Œï¼ˆpromptæ¨¡å—ï¼‰
- **å‡å°‘**: çº¦ 1484 è¡Œä»ä¸»æ–‡ä»¶ä¸­ç§»é™¤
- **æ¨¡å—åŒ–**: ä»£ç ç»„ç»‡æ›´æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»

---

## ğŸ” éªŒè¯ç»“æœ

### è¯­æ³•æ£€æŸ¥

- âœ… æ— è¯­æ³•é”™è¯¯
- âœ… æ—  linter é”™è¯¯
- âœ… æ‰€æœ‰æ¨¡å—å¯æ­£å¸¸å¯¼å…¥

### åŠŸèƒ½éªŒè¯

- âœ… `build_prompt` æ–¹æ³•æ­£ç¡®å§”æ‰˜ç»™ `PromptBuilder.build()`
- âœ… æ‰€æœ‰ä¾èµ–æ­£ç¡®æ³¨å…¥
- âœ… å‘åå…¼å®¹æ€§ä¿æŒ

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### ä½¿ç”¨æ–¹å¼

ä½¿ç”¨æ–¹å¼ä¿æŒä¸å˜ï¼Œ`ImageGenerator.build_prompt()` æ–¹æ³•æ¥å£å®Œå…¨å…¼å®¹ï¼š

```python
from image_generator import ImageGenerator

generator = ImageGenerator(config_path="config.yaml")
prompt = generator.build_prompt(
    scene=scene_data,
    include_character=True,
    script_data=script_data,
    previous_scene=previous_scene
)
```

### å†…éƒ¨å®ç°

å†…éƒ¨å®ç°å·²è¿ç§»åˆ° `prompt.PromptBuilder`ï¼š

```python
# ImageGenerator.build_prompt() ç°åœ¨åªæ˜¯ç®€å•å§”æ‰˜
def build_prompt(self, scene, include_character=None, script_data=None, previous_scene=None):
    return self.prompt_builder.build(
        scene=scene,
        include_character=include_character,
        script_data=script_data,
        previous_scene=previous_scene
    )
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¾…å®Œæˆ

1. **æµ‹è¯•éªŒè¯**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   - è¿è¡Œç°æœ‰æµ‹è¯•å¥—ä»¶
   - åŠŸèƒ½éªŒè¯
   - æ€§èƒ½æµ‹è¯•

2. **å®Œå–„Tokenä¼˜åŒ–é€»è¾‘**ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
   - ç´§æ€¥ç²¾ç®€é€»è¾‘
   - æ›´å¤æ‚çš„tokenç®¡ç†

3. **æ¸…ç†å·¥ä½œ**ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
   - ç§»é™¤ä¸å†ä½¿ç”¨çš„æ–¹æ³•ï¼ˆå¦‚æœç¡®è®¤ä¸å†éœ€è¦ï¼‰
   - æ›´æ–°æ–‡æ¡£
   - æ·»åŠ å•å…ƒæµ‹è¯•

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: `ImageGenerator.build_prompt()` æ¥å£ä¿æŒä¸å˜
2. **ä¾èµ–æ³¨å…¥**: `PromptBuilder` é€šè¿‡æ„é€ å‡½æ•°æ¥æ”¶ä¾èµ–ï¼Œé¿å…å¾ªç¯ä¾èµ–
3. **æµ‹è¯•**: å»ºè®®è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿åŠŸèƒ½æ­£å¸¸

---

## ğŸ“‹ æ€»ç»“

âœ… **é›†æˆæˆåŠŸ**: Promptæ¨¡å—å·²æˆåŠŸé›†æˆåˆ° ImageGenerator  
âœ… **ä»£ç è´¨é‡**: æ— è¯­æ³•é”™è¯¯ï¼Œæ—  linter é”™è¯¯  
âœ… **å‘åå…¼å®¹**: æ¥å£ä¿æŒä¸å˜ï¼Œä½¿ç”¨æ–¹å¼ä¸å˜  
âœ… **æ¨¡å—åŒ–**: ä»£ç ç»„ç»‡æ›´æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»  

**é‡æ„è¿›åº¦**: çº¦ 90%  
**ä¸‹ä¸€æ­¥**: æµ‹è¯•éªŒè¯








