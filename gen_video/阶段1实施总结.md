# é˜¶æ®µ1å®æ–½æ€»ç»“ - 1080Pæ–¹æ¡ˆæ ¸å¿ƒæ›¿æ¢

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. é…ç½®æ–‡ä»¶æ›´æ–° (`config.yaml`)

#### å›¾åƒç”Ÿæˆé…ç½®
- âœ… æ·»åŠ  `image.engine` é€‰é¡¹ï¼ˆ`instantid` æˆ– `sdxl`ï¼‰
- âœ… æ·»åŠ  `image.instantid` å®Œæ•´é…ç½®ï¼š
  - åŸºç¡€æ¨¡å‹ï¼š`Juggernaut-XL-v9-anime`
  - åˆ†è¾¨ç‡ï¼š1536Ã—864ï¼ˆ1080P ç­‰æ¯”ç¼©æ”¾ï¼‰
  - æ¨ç†æ­¥æ•°ï¼š20ï¼ˆFP8 ä¼˜åŒ–ï¼‰
  - é¢éƒ¨ç¼“å­˜ï¼šå¯ç”¨
  - é‡åŒ–ç±»å‹ï¼šFP8ï¼ˆæ˜¾å­˜-35%ï¼Œé€Ÿåº¦+45%ï¼‰
- âœ… ä¿ç•™ `image.sdxl` é…ç½®ï¼ˆå‘åå…¼å®¹ï¼‰

#### TTS é…ç½®
- âœ… æ·»åŠ  `tts.engine: cosyvoice` é€‰é¡¹
- âœ… æ·»åŠ  `tts.cosyvoice` å®Œæ•´é…ç½®ï¼š
  - æ¨¡å‹ï¼š`CosyVoice-2.0-0.5B`
  - é‡åŒ–ï¼šINT8ï¼ˆæ˜¾å­˜ 3.4GB â†’ 1.1GBï¼‰
  - é‡‡æ ·ç‡ï¼š48000 Hz
  - ä½æ·±åº¦ï¼š24 bit
  - è‡ªåŠ¨æƒ…æ„Ÿé¢„æµ‹ï¼šå¯ç”¨
- âœ… ä¿ç•™ `tts.chattts` é…ç½®ï¼ˆå‘åå…¼å®¹ï¼‰

#### å­—å¹•é…ç½®
- âœ… å‡çº§æ¨¡å‹ï¼š`small` â†’ `large-v3`
- âœ… å¯ç”¨å¯¹é½åŠŸèƒ½ï¼š`align: true`
- âœ… æ·»åŠ å¯¹é½æ¨¡å‹ï¼š`ZhangCheng/whisperx-align-zh`
- âœ… æ·»åŠ  VAD æ¨¡å‹ï¼š`pyannote/segmentation-3.0`
- âœ… æ‰¹é‡å¤§å°ï¼š16 â†’ 32
- âœ… è®¡ç®—ç±»å‹ï¼š`float16`ï¼ˆH20 æ˜¾å­˜å……è¶³ï¼‰

#### è§†é¢‘åˆæˆé…ç½®
- âœ… è¾“å‡ºåˆ†è¾¨ç‡ï¼š1280Ã—720 â†’ 1920Ã—1080
- âœ… å­—ä½“å¤§å°ï¼š24 â†’ 36ï¼ˆé€‚é… 1080Pï¼‰

---

### 2. ä»£ç ä¿®æ”¹

#### `image_generator.py` - InstantID æ”¯æŒ
- âœ… æ·»åŠ  `_load_instantid_pipeline()` æ–¹æ³•
- âœ… æ·»åŠ  `_generate_image_instantid()` æ–¹æ³•
- âœ… æ”¯æŒ FP8/FP16 é‡åŒ–è‡ªåŠ¨æ£€æµ‹
- âœ… æ”¯æŒé¢éƒ¨ç¼“å­˜åŠŸèƒ½
- âœ… ä¿ç•™ SDXL ç”Ÿæˆé€»è¾‘ï¼ˆ`_generate_image_sdxl()`ï¼‰
- âœ… å¼•æ“è‡ªåŠ¨é€‰æ‹©ï¼ˆ`generate_image()` æ ¹æ®é…ç½®é€‰æ‹©ï¼‰

#### `tts_generator.py` - CosyVoice æ”¯æŒ
- âœ… æ·»åŠ  `load_cosyvoice()` æ–¹æ³•
- âœ… æ·»åŠ  `synthesize_cosyvoice()` æ–¹æ³•
- âœ… æ”¯æŒ INT8/FP16/FP32 é‡åŒ–
- âœ… æ”¯æŒè‡ªåŠ¨æƒ…æ„Ÿé¢„æµ‹
- âœ… æ”¯æŒæµå¼ç”Ÿæˆï¼ˆå¯é€‰ï¼‰
- âœ… ä¿ç•™ ChatTTS ç”Ÿæˆé€»è¾‘ï¼ˆå‘åå…¼å®¹ï¼‰

#### `subtitle_generator.py` - WhisperX-large + å¯¹é½
- âœ… å‡çº§åˆ° `large-v3` æ¨¡å‹
- âœ… å¯ç”¨å¯¹é½åŠŸèƒ½ï¼ˆå­—çº§å¯¹é½ï¼Œè¯¯å·® < 50msï¼‰
- âœ… æ·»åŠ  VAD æ¨¡å‹æ”¯æŒ
- âœ… æ‰¹é‡å¤§å°æå‡åˆ° 32
- âœ… è®¡ç®—ç±»å‹é…ç½®åŒ–ï¼ˆfloat16/int8ï¼‰
- âœ… æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º

---

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### 1. å®‰è£…ä¾èµ–åŒ…

éœ€è¦å®‰è£…ä»¥ä¸‹ Python åŒ…ï¼š

```bash
# InstantID
pip install instantid

# CosyVoice
pip install cosyvoice

# WhisperXï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
pip install whisperx

# æ›´æ–° pyannote.audioï¼ˆå¯¹é½åŠŸèƒ½éœ€è¦ï¼‰
pip install --upgrade pyannote.audio
```

### 2. ä¸‹è½½æ¨¡å‹

#### InstantID æ¨¡å‹
```bash
# åŸºç¡€æ¨¡å‹ï¼ˆä¼šè‡ªåŠ¨ä¸‹è½½ï¼‰
# Juggernaut-XL-v9-anime

# æˆ–æ‰‹åŠ¨ä¸‹è½½åˆ°æŒ‡å®šç›®å½•
# /vepfs-dev/shawn/vid/fanren/gen_video/models/instantid
```

#### CosyVoice æ¨¡å‹
```bash
# æ¨¡å‹ä¼šè‡ªåŠ¨ä» HuggingFace ä¸‹è½½
# CosyVoice-2.0-0.5B

# æˆ–æ‰‹åŠ¨ä¸‹è½½åˆ°æŒ‡å®šç›®å½•
# /vepfs-dev/shawn/vid/fanren/gen_video/models/cosyvoice
```

#### WhisperX æ¨¡å‹
```bash
# large-v3 æ¨¡å‹ä¼šè‡ªåŠ¨ä¸‹è½½
# å¯¹é½æ¨¡å‹ï¼šZhangCheng/whisperx-align-zh
# VAD æ¨¡å‹ï¼špyannote/segmentation-3.0
```

### 3. æµ‹è¯•éªŒè¯

#### æµ‹è¯• InstantID
```python
from image_generator import ImageGenerator

gen = ImageGenerator("config.yaml")
gen.load_pipeline()  # åº”è¯¥åŠ è½½ InstantID

# æµ‹è¯•ç”Ÿæˆ
image = gen.generate_image(
    "a beautiful landscape",
    Path("test_instantid.png")
)
```

#### æµ‹è¯• CosyVoice
```python
from tts_generator import TTSGenerator

tts = TTSGenerator("config.yaml")
tts.generate("æµ‹è¯•æ–‡æœ¬", "test_cosyvoice.wav")
```

#### æµ‹è¯• WhisperX-large
```python
from subtitle_generator import SubtitleGenerator

sub = SubtitleGenerator("config.yaml")
sub.generate("test_audio.wav", "test_subtitle.srt")
```

### 4. é…ç½®æ–‡ä»¶è°ƒæ•´

æ ¹æ®å®é™…ç¯å¢ƒï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ï¼š

- **InstantID FP8 æ”¯æŒ**ï¼šå¦‚æœ PyTorch < 2.5 æˆ– CUDA < 12.1ï¼Œå°† `quantization: fp8` æ”¹ä¸º `fp16`
- **æ¨¡å‹è·¯å¾„**ï¼šå¦‚æœæ¨¡å‹å·²ä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ›´æ–° `model_path` é…ç½®
- **é¢éƒ¨å‚è€ƒå›¾**ï¼šç¡®è®¤ `face_image_path` æŒ‡å‘æ­£ç¡®çš„é¢éƒ¨å‚è€ƒå›¾åƒ

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. InstantID
- **FP8 è¦æ±‚**ï¼šéœ€è¦ PyTorch 2.5+ å’Œ CUDA 12.1+
- **é¢éƒ¨ç¼“å­˜**ï¼šå¦‚æœ `face_image_path` æ˜¯ç›®å½•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€å¼ å›¾ç‰‡
- **API å…¼å®¹æ€§**ï¼šInstantID çš„ API å¯èƒ½å› ç‰ˆæœ¬è€Œå¼‚ï¼Œå¦‚æœé‡åˆ°é”™è¯¯ï¼Œæ£€æŸ¥ API æ–‡æ¡£

### 2. CosyVoice
- **æƒ…æ„Ÿé¢„æµ‹**ï¼šå¦‚æœ `predict_emotion` API ä¸å­˜åœ¨ï¼Œä¼šä½¿ç”¨é»˜è®¤æƒ…æ„Ÿ
- **é‡åŒ–**ï¼šINT8 é‡åŒ–éœ€è¦æ¨¡å‹æ”¯æŒï¼Œå¦‚æœä¸æ”¯æŒä¼šè‡ªåŠ¨å›é€€
- **é‡‡æ ·ç‡**ï¼šé»˜è®¤ 48000 Hzï¼Œç¡®ä¿éŸ³é¢‘å¤„ç†æµç¨‹æ”¯æŒ

### 3. WhisperX
- **å¯¹é½åŠŸèƒ½**ï¼šéœ€è¦ pyannote.audio æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœå‡ºç°æ®µé”™è¯¯ï¼Œæ›´æ–°ä¾èµ–
- **VAD æ¨¡å‹**ï¼šå¦‚æœåŠ è½½å¤±è´¥ï¼Œä¼šè‡ªåŠ¨ç¦ç”¨ VADï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
- **æ˜¾å­˜å ç”¨**ï¼šlarge-v3 + å¯¹é½çº¦ 14GBï¼Œç¡®ä¿æ˜¾å­˜å……è¶³

---

## ğŸ”„ å›é€€æ–¹æ¡ˆ

å¦‚æœæ–°æ–¹æ¡ˆå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›é€€ï¼š

### å›é€€åˆ° SDXL
```yaml
image:
  engine: sdxl  # æ”¹ä¸º sdxl
```

### å›é€€åˆ° ChatTTS
```yaml
tts:
  engine: chattts  # æ”¹ä¸º chattts
```

### å›é€€åˆ° WhisperX-small
```yaml
subtitle:
  model_size: small  # æ”¹ä¸º small
  align: false  # ç¦ç”¨å¯¹é½
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡
- **å›¾åƒç”Ÿæˆ**ï¼š1536Ã—864ï¼Œçº¦ 1.8 ç§’/å¼ ï¼ˆFP8ï¼‰
- **TTS ç”Ÿæˆ**ï¼š3 ç§’/5 åˆ†é’ŸéŸ³é¢‘ï¼ˆINT8ï¼‰
- **å­—å¹•ç”Ÿæˆ**ï¼š2 åˆ†é’Ÿ/5 åˆ†é’ŸéŸ³é¢‘ï¼ˆlarge-v3 + å¯¹é½ï¼‰

### è´¨é‡æå‡
- **è§’è‰²ä¸€è‡´æ€§**ï¼šInstantID é¢éƒ¨ç¼“å­˜ï¼Œ30 å¼ å›¾åªç®— 1 æ¬¡ç‰¹å¾
- **è¯­éŸ³è´¨é‡**ï¼šCosyVoice MOS 5.53ï¼Œè‡ªåŠ¨æƒ…æ„Ÿé¢„æµ‹
- **å­—å¹•ç²¾åº¦**ï¼šå­—çº§å¯¹é½ï¼Œè¯¯å·® < 50ms

---

## ğŸ“ æµ‹è¯•æ¸…å•

- [ ] InstantID æ¨¡å‹åŠ è½½æˆåŠŸ
- [ ] InstantID å›¾åƒç”ŸæˆæˆåŠŸï¼ˆ1536Ã—864ï¼‰
- [ ] é¢éƒ¨ç¼“å­˜åŠŸèƒ½æ­£å¸¸
- [ ] CosyVoice æ¨¡å‹åŠ è½½æˆåŠŸ
- [ ] CosyVoice è¯­éŸ³ç”ŸæˆæˆåŠŸï¼ˆ48kHz/24bitï¼‰
- [ ] æƒ…æ„Ÿé¢„æµ‹åŠŸèƒ½æ­£å¸¸
- [ ] WhisperX-large-v3 æ¨¡å‹åŠ è½½æˆåŠŸ
- [ ] å¯¹é½åŠŸèƒ½æ­£å¸¸ï¼ˆå­—çº§å¯¹é½ï¼‰
- [ ] VAD åŠŸèƒ½æ­£å¸¸ï¼ˆå¯é€‰ï¼‰
- [ ] å®Œæ•´æµæ°´çº¿æµ‹è¯•ï¼ˆå›¾åƒ â†’ è§†é¢‘ â†’ é…éŸ³ â†’ å­—å¹• â†’ åˆæˆï¼‰

---

**æœ€åæ›´æ–°ï¼š2025-11**

