# 测试图像生成指南

## 🎯 快速开始

你创建了 `lingjie/1.json` 文件，包含 2 个场景。现在可以通过以下方式测试图像生成。

---

## 方法一：使用测试脚本（推荐）⭐

我已经为你创建了一个专门的测试脚本 `test_image_generation.py`，只生成图像，不生成视频和音频。

### 运行命令

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
python test_image_generation.py --script ../lingjie/1.json
```

### 参数说明

- `--script`: JSON 脚本文件路径（必需）
- `--config`: 配置文件路径（可选，默认: config.yaml）
- `--output-dir`: 输出目录（可选，默认: outputs/images/lingjie_1_test）
- `--overwrite`: 覆盖已存在的图像（可选）

### 示例

```bash
# 基本用法
python test_image_generation.py --script ../lingjie/1.json

# 指定输出目录
python test_image_generation.py --script ../lingjie/1.json --output-dir outputs/images/test_output

# 覆盖已存在的图像
python test_image_generation.py --script ../lingjie/1.json --overwrite
```

---

## 方法二：使用 main.py（跳过视频生成）

如果你想使用主程序但只生成图像：

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
python main.py --script ../lingjie/1.json --output lingjie_1_test --skip-video --skip-tts
```

**参数说明**:
- `--script`: JSON 脚本文件路径
- `--output`: 输出名称
- `--skip-video`: 跳过视频生成（只生成图像）
- `--skip-tts`: 跳过配音生成

---

## 📊 测试你的 JSON 文件

你的 `lingjie/1.json` 文件包含：

- **场景 12**: 韩立头颅一偏，胸膛一瘪，吸起一团沙砾
  - 输出路径: `outputs/images/lingjie_ep1_test/scene_013.png`
  
- **场景 13**: 沙砾在他唇边呼啸旋转，怪鸟逼近到十余丈
  - 输出路径: `outputs/images/lingjie_ep1_test/scene_014.png`

### 运行测试

```bash
cd /vepfs-dev/shawn/vid/fanren/gen_video
python test_image_generation.py --script ../lingjie/1.json
```

---

## ✅ 预期结果

运行后，你应该看到：

1. **初始化信息**:
   ```
   🔧 正在初始化图像生成器...
   ✓ 已切换采样器: DPMSolverMultistepScheduler (DPM++，质量更好)
   ✓ 图像生成器初始化成功
   ```

2. **生成进度**:
   ```
   🎨 开始生成图像...
   Scene 12: 正在生成图像...
     图像生成参数: num_inference_steps=40, guidance_scale=7.5, guidance_rescale=0.7
   ✓ 图像已保存: outputs/images/lingjie_1_test/scene_013.png
   ```

3. **完成信息**:
   ```
   ✅ 图像生成完成！
      共生成 2 张图像
   ```

---

## 🔍 检查生成的图像

生成的图像会保存在：

```
outputs/images/lingjie_1_test/
├── scene_013.png  # 场景 12 的图像
└── scene_014.png  # 场景 13 的图像
```

**注意**: JSON 文件中的 `image_path` 会在生成后自动更新为实际路径。

---

## ⚠️ 可能的问题

### 1. 路径问题

如果提示"脚本文件未找到"，请使用绝对路径：

```bash
python test_image_generation.py --script /vepfs-dev/shawn/vid/fanren/lingjie/1.json
```

### 2. 显存不足

如果显存不足（需要 ≥12GB），可以临时降低分辨率：

修改 `config.yaml`:
```yaml
image:
  instantid:
    width: 1536   # 降低分辨率
    height: 864   # 降低分辨率
```

### 3. 依赖版本问题

如果提示采样器导入失败，检查 diffusers 版本：

```bash
pip install --upgrade diffusers>=0.21.0
```

---

## 🎨 验证优化效果

生成图像后，检查以下方面：

1. **质量**: 图像是否更清晰、细节更丰富？
2. **颜色**: 颜色是否更自然（CFG Rescale 的效果）？
3. **分辨率**: 是否达到 1080P（1920x1080）？
4. **生成速度**: 是否比之前快（40 步 vs 60 步）？

---

## 📝 下一步

图像生成成功后，可以：

1. **继续生成视频**: 
   ```bash
   python main.py --script ../lingjie/1.json --output lingjie_1_test
   ```

2. **批量测试**: 测试更多场景

3. **调整参数**: 根据生成效果微调配置

---

*测试完成后，请检查生成图像的文件夹，确认质量提升效果！*











