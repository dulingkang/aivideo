# å®‰è£…æ€»ç»“å’Œä¸‹ä¸€æ­¥æ“ä½œ

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆçš„æ›´æ–°

1. **TTS ç”Ÿæˆå™¨æ›´æ–°** - æ”¯æŒå£°éŸ³å…‹éš†ï¼ˆå‚è€ƒéŸ³é¢‘ï¼‰
2. **é…ç½®æ–‡ä»¶æ›´æ–°** - æ·»åŠ å‚è€ƒéŸ³é¢‘é…ç½®é¡¹
3. **å£°éŸ³å…‹éš†æŒ‡å—** - å®Œæ•´çš„å½•åˆ¶å’Œä½¿ç”¨æŒ‡å—
4. **å½•åˆ¶è„šæœ¬** - å‡†å¤‡å¥½çš„å½•åˆ¶æ–‡æœ¬
5. **é¢„å¤„ç†è„šæœ¬** - éŸ³é¢‘æ ¼å¼è½¬æ¢å·¥å…·
6. **å¿«é€Ÿå¼€å§‹æŒ‡å—** - å£°éŸ³å…‹éš†å¿«é€Ÿå…¥é—¨

### âš ï¸ éœ€è¦å®‰è£…çš„ç»„ä»¶

ç”±äºè™šæ‹Ÿç¯å¢ƒç©ºé—´é™åˆ¶ï¼Œä»¥ä¸‹ç»„ä»¶éœ€è¦å®‰è£…ï¼š

#### 1. FFmpegï¼ˆç³»ç»Ÿçº§ï¼Œæ¨èç«‹å³å®‰è£…ï¼‰

```bash
# æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
which ffmpeg

# å¦‚æœæœªå®‰è£…ï¼Œå®‰è£… FFmpeg
sudo apt update
sudo apt install ffmpeg

# éªŒè¯å®‰è£…
ffmpeg -version
```

#### 2. éŸ³é¢‘å¤„ç†åº“ï¼ˆå°ä½“ç§¯ï¼Œæ¨èå®‰è£…ï¼‰

```bash
source /vepfs-dev/shawn/venv/py312/bin/activate

# å®‰è£…éŸ³é¢‘å¤„ç†åº“
pip install librosa soundfile

# å¦‚æœç©ºé—´ä¸è¶³ï¼Œå°è¯•æ¸…ç†ç¼“å­˜
pip cache purge
pip install --no-cache-dir librosa soundfile
```

#### 3. ChatTTSï¼ˆå£°éŸ³å…‹éš†ï¼Œæ¨èå®‰è£…ï¼‰

```bash
source /vepfs-dev/shawn/venv/py312/bin/activate

# å®‰è£… ChatTTS
pip install chattts

# å¦‚æœç©ºé—´ä¸è¶³
pip cache purge
pip install --no-cache-dir chattts
```

#### 4. WhisperXï¼ˆå­—å¹•ç”Ÿæˆï¼Œå¯é€‰ï¼‰

```bash
source /vepfs-dev/shawn/venv/py312/bin/activate

# å®‰è£… WhisperXï¼ˆè¾ƒå¤§ï¼Œçº¦3GBæ¨¡å‹ï¼‰
pip install whisperx
```

## å£°éŸ³å…‹éš† - å®Œæ•´æµç¨‹

### æ­¥éª¤1: å½•åˆ¶å‚è€ƒéŸ³é¢‘

**å½•åˆ¶å†…å®¹**: ä½¿ç”¨ `å½•åˆ¶è„šæœ¬.txt` ä¸­çš„æ–‡æœ¬

**å½•åˆ¶è¦æ±‚**:
- **æ—¶é•¿**: 30-60ç§’ï¼ˆæ¨èï¼‰
- **æ ¼å¼**: WAV æˆ– MP3ï¼ˆå¯åç»­è½¬æ¢ï¼‰
- **ç¯å¢ƒ**: å®‰é™ï¼Œæ— èƒŒæ™¯å™ªéŸ³
- **é£æ ¼**: å¹³é™ã€å™è¿°å‹ï¼ˆ"äº‘å·ä»™éŸ³"é£æ ¼ï¼‰

**å½•åˆ¶å·¥å…·**:
- Audacityï¼ˆæ¨èï¼‰
- ç³»ç»Ÿå½•éŸ³å·¥å…·
- æ‰‹æœºå½•éŸ³ï¼ˆéœ€è½¬æ¢æ ¼å¼ï¼‰

### æ­¥éª¤2: å¤„ç†å‚è€ƒéŸ³é¢‘

```bash
source /vepfs-dev/shawn/venv/py312/bin/activate
cd /vepfs-dev/shawn/vid/fanren/gen_video

# ä½¿ç”¨é¢„å¤„ç†è„šæœ¬
python prepare_reference_audio.py \
    --input /path/to/your/recording.wav \
    --output assets/voices/yunjuanxianyin_reference.wav

# æˆ–ä½¿ç”¨ FFmpeg æ‰‹åŠ¨å¤„ç†
ffmpeg -i input.wav -ar 24000 -ac 1 -acodec pcm_s16le \
    assets/voices/yunjuanxianyin_reference.wav
```

### æ­¥éª¤3: é…ç½®ç³»ç»Ÿ

ç¼–è¾‘ `config.yaml`:

```yaml
tts:
  engine: "chattts"
  reference_audio: "assets/voices/yunjuanxianyin_reference.wav"
  temperature: 0.7
```

### æ­¥éª¤4: æµ‹è¯•å£°éŸ³å…‹éš†

```bash
# åˆ›å»ºæµ‹è¯•è„šæœ¬
python test_voice_clone.py

# æˆ–ä½¿ç”¨ TTS ç”Ÿæˆå™¨
python tts_generator.py \
    --text "æµ‹è¯•æ–‡æœ¬" \
    --output test.wav
```

## å½•åˆ¶å»ºè®®

### æ¨èå½•åˆ¶æ–‡æœ¬ï¼ˆ60ç§’ç‰ˆæœ¬ï¼‰

```
å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯äº‘å·ä»™éŸ³ã€‚ä»Šå¤©æˆ‘ä»¬è¦ç»§ç»­è®²è¿°å‡¡äººä¿®ä»™ä¼ çš„æ•…äº‹ã€‚

åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼ŒéŸ©ç«‹ç»å†äº†æ— æ•°çš„æŒ‘æˆ˜å’Œæœºé‡ã€‚ä»–ä»ä¸€ä¸ªæ™®é€šçš„å‡¡äººï¼Œé€æ¸æˆé•¿ä¸ºå¼ºå¤§çš„ä¿®å£«ã€‚

æ¯ä¸€æ¬¡çš„çªç ´éƒ½å……æ»¡äº†æƒŠé™©å’Œåˆºæ¿€ã€‚è®©æˆ‘ä»¬ä¸€èµ·è·ŸéšéŸ©ç«‹çš„è„šæ­¥ï¼Œæ¢ç´¢è¿™ä¸ªç¥ç§˜çš„ä¿®ä»™ä¸–ç•Œã€‚

åœ¨è¿™ä¸ªå……æ»¡çµæ°”çš„ä¸–ç•Œé‡Œï¼Œä¿®è¡Œè€…ä»¬è¿½æ±‚é•¿ç”Ÿä¸è€çš„æ¢¦æƒ³ã€‚éŸ©ç«‹æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡¡äººï¼Œä½†ä»–æœ‰ç€ä¸å±ˆçš„æ„å¿—å’Œåšå®šçš„ä¿¡å¿µã€‚

é€šè¿‡ä¸æ–­çš„åŠªåŠ›å’Œæœºç¼˜å·§åˆï¼Œä»–é€æ¸æˆé•¿ä¸ºä¸€åå¼ºå¤§çš„ä¿®å£«ã€‚åœ¨çµç•Œçš„æ—…ç¨‹ä¸­ï¼Œä»–é‡åˆ°äº†è®¸å¤šæŒ‘æˆ˜å’Œæœºé‡ã€‚

æ¯ä¸€æ¬¡çš„çªç ´éƒ½è®©ä»–çš„ä¿®ä¸ºæ›´ä¸Šä¸€å±‚æ¥¼ã€‚è¿™å°±æ˜¯å‡¡äººä¿®ä»™ä¼ çš„æ•…äº‹ï¼Œä¸€ä¸ªå…³äºåšæŒå’Œæˆé•¿çš„æ•…äº‹ã€‚
```

### å½•åˆ¶æŠ€å·§

1. **è¯­é€Ÿ**: è‡ªç„¶ã€æ¸…æ™°ï¼Œä¸è¦è¿‡å¿«æˆ–è¿‡æ…¢
2. **è¯­è°ƒ**: ä¿æŒè‡ªç„¶ï¼Œç¬¦åˆ"äº‘å·ä»™éŸ³"çš„é£æ ¼
3. **åœé¡¿**: é€‚å½“çš„åœé¡¿ï¼Œä¸è¦è¿ç»­ä¸æ–­
4. **å‘éŸ³**: æ¸…æ™°å‡†ç¡®ï¼Œæ³¨æ„å£°è°ƒ
5. **æƒ…æ„Ÿ**: ä¿æŒä¸€è‡´çš„é£æ ¼ï¼ˆæ¸©æŸ”ã€å™è¿°ã€æœ‰ä»™æ°”ï¼‰

### éŸ³é¢‘æ ¼å¼è¦æ±‚

- **é‡‡æ ·ç‡**: 24kHzï¼ˆChatTTS æ ‡å‡†ï¼‰
- **å£°é“**: å•å£°é“ï¼ˆMonoï¼‰
- **æ ¼å¼**: WAV, 16-bit PCM
- **æ—¶é•¿**: 30-60ç§’ï¼ˆæ¨èï¼‰

## å®‰è£…é¡ºåºï¼ˆæ¨èï¼‰

### ä¼˜å…ˆçº§1: å¿…éœ€ç»„ä»¶

1. **FFmpeg** - è§†é¢‘åˆæˆå¿…éœ€
   ```bash
   sudo apt install ffmpeg
   ```

2. **éŸ³é¢‘å¤„ç†åº“** - å£°éŸ³å…‹éš†å¿…éœ€
   ```bash
   pip install librosa soundfile
   ```

### ä¼˜å…ˆçº§2: æ¨èç»„ä»¶

3. **ChatTTS** - å£°éŸ³å…‹éš†
   ```bash
   pip install chattts
   ```

### ä¼˜å…ˆçº§3: å¯é€‰ç»„ä»¶

4. **WhisperX** - å­—å¹•ç”Ÿæˆ
   ```bash
   pip install whisperx
   ```

5. **generative-models** - è§†é¢‘ç”Ÿæˆ
   ```bash
   git clone https://github.com/Stability-AI/generative-models.git
   cd generative-models
   pip install -r requirements/pt2.txt
   pip install .
   ```

## æ•…éšœæ’é™¤

### è™šæ‹Ÿç¯å¢ƒç©ºé—´ä¸è¶³

å¦‚æœè™šæ‹Ÿç¯å¢ƒæ‰€åœ¨åˆ†åŒºç©ºé—´ä¸è¶³ï¼š

1. **æ¸…ç†ç¼“å­˜**:
   ```bash
   pip cache purge
   ```

2. **ä½¿ç”¨ --no-cache-dir**:
   ```bash
   pip install --no-cache-dir chattts
   ```

3. **æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒå¤§å°**:
   ```bash
   du -sh /vepfs-dev/shawn/venv/py312
   ```

4. **æ¸…ç†ä¸éœ€è¦çš„åŒ…**:
   ```bash
   pip list
   pip uninstall <unused_package>
   ```

### å®‰è£…å¤±è´¥

1. **æ£€æŸ¥é”™è¯¯ä¿¡æ¯**:
   ```bash
   pip install -v chattts
   ```

2. **å°è¯•å•ç‹¬å®‰è£…ä¾èµ–**:
   ```bash
   pip install torch transformers
   pip install chattts --no-deps
   ```

3. **ä½¿ç”¨ conda**ï¼ˆå¦‚æœå¯ç”¨ï¼‰:
   ```bash
   conda install -c conda-forge chattts
   ```

## å½“å‰å¯ç”¨åŠŸèƒ½

å³ä½¿æŸäº›ç»„ä»¶æœªå®‰è£…ï¼Œä»¥ä¸‹åŠŸèƒ½ä»å¯ä½¿ç”¨ï¼š

1. âœ… **è„šæœ¬è§£æ** - å·²æµ‹è¯•ï¼Œå¯ä»¥æ­£å¸¸å·¥ä½œ
2. âœ… **é…ç½®æ–‡ä»¶ç®¡ç†** - å¯ä»¥ä½¿ç”¨
3. âœ… **å£°éŸ³å…‹éš†ä»£ç ** - å·²æ›´æ–°ï¼Œæ”¯æŒå‚è€ƒéŸ³é¢‘
4. âš ï¸ **è§†é¢‘åˆæˆ** - éœ€è¦ FFmpeg
5. âš ï¸ **TTS ç”Ÿæˆ** - éœ€è¦ ChatTTS
6. âš ï¸ **å­—å¹•ç”Ÿæˆ** - éœ€è¦ WhisperX
7. âš ï¸ **è§†é¢‘ç”Ÿæˆ** - éœ€è¦ generative-models

## ä¸‹ä¸€æ­¥æ“ä½œ

### ç«‹å³å¯ä»¥åšçš„

1. **å½•åˆ¶å‚è€ƒéŸ³é¢‘**
   - ä½¿ç”¨ `å½•åˆ¶è„šæœ¬.txt` ä¸­çš„æ–‡æœ¬
   - å½•åˆ¶ 30-60 ç§’
   - ä¿å­˜ä¸º WAV æ ¼å¼

2. **å®‰è£… FFmpeg**ï¼ˆç³»ç»Ÿçº§ï¼‰
   ```bash
   sudo apt install ffmpeg
   ```

3. **å®‰è£…éŸ³é¢‘å¤„ç†åº“**
   ```bash
   pip install librosa soundfile
   ```

### å®‰è£…å®Œæˆå

4. **å¤„ç†å‚è€ƒéŸ³é¢‘**
   ```bash
   python prepare_reference_audio.py --input recording.wav --output assets/voices/reference.wav
   ```

5. **å®‰è£… ChatTTS**
   ```bash
   pip install chattts
   ```

6. **æµ‹è¯•å£°éŸ³å…‹éš†**
   ```bash
   python test_voice_clone.py
   ```

7. **è¿è¡Œå®Œæ•´æµæ°´çº¿**
   ```bash
   python run_pipeline.py --markdown ../çµç•Œ/2.md --image-dir ../çµç•Œ/img2/jpgsrc --output lingjie_ep2
   ```

## æ–‡æ¡£ç´¢å¼•

- [å£°éŸ³å…‹éš†æŒ‡å—](å£°éŸ³å…‹éš†æŒ‡å—.md) - è¯¦ç»†çš„å½•åˆ¶å’Œä½¿ç”¨æŒ‡å—
- [å¿«é€Ÿå¼€å§‹-å£°éŸ³å…‹éš†](å¿«é€Ÿå¼€å§‹-å£°éŸ³å…‹éš†.md) - å¿«é€Ÿå…¥é—¨æ•™ç¨‹
- [å®‰è£…æŒ‡å—](å®‰è£…æŒ‡å—.md) - å®Œæ•´çš„å®‰è£…æŒ‡å—
- [ä½¿ç”¨æŒ‡å—](ä½¿ç”¨æŒ‡å—.md) - ç³»ç»Ÿä½¿ç”¨æŒ‡å—
- [README](README.md) - å®Œæ•´æ–‡æ¡£

## æ€»ç»“

ç³»ç»Ÿå·²ç»å‡†å¤‡å¥½æ”¯æŒå£°éŸ³å…‹éš†åŠŸèƒ½ï¼š

1. âœ… **ä»£ç å·²æ›´æ–°** - TTS ç”Ÿæˆå™¨æ”¯æŒå‚è€ƒéŸ³é¢‘
2. âœ… **é…ç½®å·²æ›´æ–°** - é…ç½®æ–‡ä»¶æ”¯æŒå‚è€ƒéŸ³é¢‘è·¯å¾„
3. âœ… **æ–‡æ¡£å·²åˆ›å»º** - å®Œæ•´çš„å½•åˆ¶å’Œä½¿ç”¨æŒ‡å—
4. âœ… **å·¥å…·å·²å‡†å¤‡** - éŸ³é¢‘é¢„å¤„ç†è„šæœ¬

**ä¸‹ä¸€æ­¥**:
1. å½•åˆ¶å‚è€ƒéŸ³é¢‘ï¼ˆ30-60ç§’ï¼‰
2. å®‰è£…å¿…è¦ç»„ä»¶ï¼ˆFFmpeg, librosa, soundfile, ChatTTSï¼‰
3. å¤„ç†å‚è€ƒéŸ³é¢‘
4. æµ‹è¯•å£°éŸ³å…‹éš†
5. åœ¨å®Œæ•´æµæ°´çº¿ä¸­ä½¿ç”¨

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸ™ï¸

