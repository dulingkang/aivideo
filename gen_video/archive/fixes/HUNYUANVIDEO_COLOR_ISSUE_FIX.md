# HunyuanVideo 色彩问题深度分析

## 🔍 问题现象

从终端输出分析：
- **配置分辨率**: 640×480
- **实际输出分辨率**: 544×720（不匹配！）
- **推理步数**: 20步（已从15步增加）
- **色彩调整**: 已禁用（所有因子=1.0）
- **问题**: 视频色彩仍然不对

## ❌ 根本原因分析

### 1. 分辨率不匹配（关键问题）

**现象**：
- 配置：640×480
- 实际输出：544×720

**原因**：
- HunyuanVideo 1.5模型可能根据输入图像自动调整输出分辨率
- 或者模型有固定的输出分辨率（544×720）
- 分辨率不匹配可能导致色彩空间转换问题

### 2. 推理步数可能仍然不足

**当前**: 20步
**问题**: 即使对于蒸馏模型，20步可能仍然不足以生成准确的色彩

### 3. 蒸馏模型可能不适合当前场景

蒸馏模型虽然速度快，但可能在色彩准确性上不如标准版本。

## ✅ 解决方案

### 方案1：增加推理步数到25-30步（立即尝试）

```yaml
num_inference_steps: 25  # 从20增加到25
# 或
num_inference_steps: 30  # 如果需要更高质量
```

**理由**：
- 蒸馏模型虽然可以用更少步数，但至少需要25步才能保证质量
- 20步可能仍然不足以生成准确的色彩

### 方案2：调整guidance_scale（可能改善色彩）

```yaml
guidance_scale: 6.5  # 从7.5降低到6.5-7.0
```

**理由**：
- guidance_scale过高可能导致色彩过饱和
- 降低guidance_scale可能改善色彩准确性

### 方案3：切换到标准版本（如果蒸馏版本质量不足）

```yaml
model_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/HunyuanVideo-1.5-Diffusers-480p_i2v  # 标准版本
num_inference_steps: 30  # 标准版本推荐30步
```

**理由**：
- 标准版本可能在色彩准确性上更好
- 虽然速度慢一些，但质量更稳定

### 方案4：检查并修复分辨率问题

如果模型输出分辨率固定为544×720，需要：
1. 调整配置分辨率匹配模型输出
2. 或者在生成后resize到目标分辨率

## 🎯 推荐操作步骤

### 第一步：增加步数到25步（立即执行）

```yaml
num_inference_steps: 25
```

### 第二步：如果仍然不行，降低guidance_scale

```yaml
guidance_scale: 6.5
```

### 第三步：如果仍然不行，切换到标准版本

```yaml
model_path: /vepfs-dev/shawn/vid/fanren/gen_video/models/HunyuanVideo-1.5-Diffusers-480p_i2v
num_inference_steps: 30
```

## 📊 参数对比

| 参数 | 当前值 | 推荐值 | 说明 |
|------|--------|--------|------|
| num_inference_steps | 20 | 25-30 | 增加步数提升质量 |
| guidance_scale | 7.5 | 6.5-7.0 | 降低可能改善色彩 |
| 模型版本 | 蒸馏版 | 标准版（备选） | 如果蒸馏版质量不足 |

## 📝 总结

**主要问题**：
1. ✅ 推理步数可能不足（20步→25步）
2. ✅ guidance_scale可能过高（7.5→6.5-7.0）
3. ⚠️ 分辨率不匹配（需要进一步检查）

**推荐操作**：
1. 立即增加步数到25步
2. 尝试降低guidance_scale到6.5-7.0
3. 如果仍然不行，考虑切换到标准版本



