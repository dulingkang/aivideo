# Prompt 优化总结（已应用社区最佳实践）

## ✅ 已完成的优化

### 1. 风格标签位置（最关键）
- **位置**：第0位（最前面）
- **原因**：SDXL/Flux 对 prompt 开头更敏感，风格标签在前能显著提升生成质量
- **实现**：使用 `priority_parts.insert(0, style_tag)` 确保风格在最前面

### 2. Prompt 构建顺序（符合社区最佳实践）
```
顺序：风格(0) -> 约束(1) -> 角色(2) -> 场景prompt(3) -> 背景(4) -> 其他
```

### 3. 逗号分隔优化
- 清理多余的逗号和空格
- 确保每个部分用逗号清晰分隔（符合 Flux/SDXL 最佳实践）

### 4. 结构化格式
- 韩立角色使用完整的结构化风格描述
- 格式：`[风格], [质量标签], [细节], [美学]`

## ⚠️ 如果效果仍不好，检查以下方面

### 1. 负面 Prompt
- 检查 `config.yaml` 中的 `image.negative_prompt`
- 确保排除不想要的元素（如：多个头、错误性别、现代元素等）

### 2. 环境描述
- 检查 `scene.visual.environment` 是否正确
- 确保场景背景描述被正确包含

### 3. 权重设置
- 检查各个部分的权重是否合理
- 关键元素（如角色、环境）应该使用较高权重（1.5-2.0）

### 4. 实际 Prompt 内容
- 运行测试时查看实际生成的 prompt
- 确认 prompt 顺序是否符合预期

## 📝 建议的调试步骤

1. 运行测试并查看实际生成的 prompt：
   ```bash
   proxychains4 python test_lingjie_scenes.py --scenes 1 3 4
   ```

2. 检查生成的 prompt 顺序是否符合：
   - 风格标签在最前面
   - 角色描述在风格之后
   - 场景 prompt 在角色之后
   - 环境背景在场景 prompt 之后

3. 如果 prompt 顺序正确但效果仍不好，可能需要：
   - 调整负面 prompt
   - 调整权重设置
   - 检查环境描述是否准确
   - 检查角色描述是否准确
