# 场景来源策略：何时使用AI生成 vs 检索已有视频

## 两种方案对比

### 方案A: 检索已有视频片段（当前已完成）
- **来源**: 从已处理的视频集中检索场景
- **优点**:
  - ✅ 真实视频，质量高
  - ✅ 处理速度快（只需检索和匹配）
  - ✅ 风格统一（来自原番）
  - ✅ 无需生成，节省资源
  - ✅ 包含原声（可选）

- **缺点**:
  - ❌ 受限于已有视频内容
  - ❌ 可能找不到完全匹配的场景
  - ❌ 场景选择受检索准确度影响

### 方案B: AI生成图片 → 生成视频场景
- **来源**: 使用SDXL等模型生成图片，再用SVD生成视频
- **优点**:
  - ✅ 可以生成任意场景
  - ✅ 完全符合narration描述
  - ✅ 可以控制角色、场景、风格

- **缺点**:
  - ❌ 生成时间长（图片+视频生成）
  - ❌ 消耗GPU资源
  - ❌ 可能风格不一致
  - ❌ 质量可能不如原视频

## 使用场景分析

### 场景1: 需要原番视频片段
**适用**: 方案A（检索已有视频）

**情况**:
- 制作解说/剪辑视频，需要原番画面
- narration描述的是原番中已有的场景
- 希望保持原番风格和质量
- 有大量已处理的视频素材库

**示例**:
- "这是我宗的身份令牌" → 可以从已有视频中检索到相关场景
- "韩立来到洞府" → 可以从已有视频中找到洞府场景

### 场景2: 需要全新场景
**适用**: 方案B（AI生成）

**情况**:
- narration描述的场景在原番中不存在
- 需要特定的角色组合或场景配置
- 需要与原番不同的视觉风格
- 创作全新内容

**示例**:
- "主角站在星空下思考" → 原番中可能没有这个场景
- "三个角色同时出现的新场景" → 需要组合生成
- "幻想风格的场景" → 需要特殊视觉效果

### 场景3: 混合方案（推荐）
**适用**: 优先检索，缺失部分用AI生成

**策略**:
1. **优先检索**: 先从已有视频中检索匹配的场景
2. **补充生成**: 如果检索不到合适的场景，再用AI生成
3. **质量评估**: 如果检索到的场景相关性不够高（分数低），考虑生成

## 决策流程

```
narration文本
    ↓
检索已有视频场景
    ↓
找到合适场景？(分数 > 阈值)
    ├─ 是 → 使用检索场景 ✓
    └─ 否 → AI生成新场景 ✓
```

## 阈值建议

### 检索分数阈值
- **分数 >= 0.7**: 直接使用检索结果
- **分数 0.5-0.7**: 可以使用，但可以考虑AI生成更好版本
- **分数 < 0.5**: 建议使用AI生成

### 时长匹配度
- **时长差异 < 10%**: 直接使用
- **时长差异 10%-30%**: 裁剪/拼接后使用
- **时长差异 > 30%**: 考虑AI生成

## 混合工作流设计

### 自动决策脚本

```python
# 伪代码示例
def select_scene_source(narration_text, target_duration):
    # 1. 检索已有场景
    search_results = search_scenes(narration_text, top_k=5)
    best_match = search_results[0]
    
    # 2. 评估匹配度
    score = best_match['score']
    duration_diff = abs(best_match['duration'] - target_duration) / target_duration
    
    # 3. 决策
    if score >= 0.7 and duration_diff < 0.3:
        return {
            'source': 'retrieved',
            'scene_id': best_match['scene_id'],
            'video_path': find_video(best_match)
        }
    else:
        return {
            'source': 'ai_generate',
            'prompt': narration_text,
            'duration': target_duration
        }
```

## 实际建议

### 对于171集制作

**推荐策略: 混合方案**

1. **第一步**: 尝试检索已有场景
   ```bash
   # 对每个narration段落检索
   python3 narration_to_scenes_workflow.py ...
   ```

2. **第二步**: 评估检索结果
   - 如果分数高（>=0.7）且时长合适 → 使用检索结果
   - 如果分数低（<0.5）或时长不合适 → 标记为需要生成

3. **第三步**: 生成缺失场景
   - 对于标记的场景，使用AI生成
   - 使用现有的image_generator.py和video_generator.py

### 具体场景判断

#### 应该检索的场景：
- ✅ "身份令牌"、"洞府"、"战斗" - 原番中常见场景
- ✅ 已有视频集中包含的场景
- ✅ 描述明确的原番内容

#### 应该AI生成的场景：
- ✅ 原番中没有的独特场景
- ✅ 需要特殊视觉效果的场景
- ✅ 检索分数很低的场景（<0.5）

## 成本和质量权衡

### 检索方案
- **成本**: 低（只需检索和复制）
- **质量**: 高（原视频质量）
- **速度**: 快（秒级）

### AI生成方案
- **成本**: 高（GPU资源、时间）
- **质量**: 中等（取决于模型）
- **速度**: 慢（分钟级）

### 建议比例
- **80%检索 + 20%生成**: 适用于有大量素材的情况
- **50%检索 + 50%生成**: 适用于素材较少的情况
- **100%检索**: 适用于纯剪辑/解说视频

## 总结

**优先使用检索的场景:**
1. 检索分数 >= 0.7
2. 时长匹配度好（差异<30%）
3. 原番中常见的场景

**需要AI生成的场景:**
1. 检索分数 < 0.5
2. 原番中不存在的场景
3. 需要特殊视觉效果
4. 检索不到任何相关场景

**混合策略（推荐）:**
- 先检索，评估匹配度
- 高质量匹配直接用
- 低质量或缺失的场景用AI生成

